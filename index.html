<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>משווה משכנתא - Mortgage Comparison Tool</title>
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script>
        // Configure PDF.js
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
    </script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Heebo', sans-serif;
        }
        
        :root {
            /* Light mode colors */
            --bg-primary: linear-gradient(to bottom left, #dbeafe, #e2e8f0, #d1fae5);
            --bg-card: #ffffff;
            --bg-card-hover: #f1f5f9;
            --text-primary: #0f172a;
            --text-secondary: #475569;
            --text-muted: #64748b;
            --border-color: #cbd5e1;
            --border-color-light: #bfdbfe;
            --shadow: rgba(0, 0, 0, 0.1);
            --shadow-hover: rgba(0, 0, 0, 0.15);
            --header-bg: rgba(255, 255, 255, 0.9);
        }

        /* Text utilities */
        p, span, div {
            color: inherit;
        }
        
        .text-primary {
            color: var(--text-primary);
        }
        
        .text-secondary {
            color: var(--text-secondary);
        }
        
        .text-muted {
            color: var(--text-muted);
        }
        
        .fw-500 {
            font-weight: 500;
        }
        
        .fw-600 {
            font-weight: 600;
        }
        
        .fw-700 {
            font-weight: 700;
        }
        
        /* Risk colors */
        .risk-low {
            background: #f0fdf4;
            color: #15803d;
        }

        .risk-medium {
            background: #fef3c7;
            color: #a16207;
        }

        .risk-high {
            background: #fee2e2;
            color: #dc2626;
        }
        
        body {
            background: var(--bg-primary);
            min-height: 100vh;
            color: var(--text-primary);
            transition: background 0.3s, color 0.3s;
        }
        
        /* Header */
        .header {
            background: var(--header-bg);
            backdrop-filter: blur(4px);
            border-bottom: 1px solid var(--border-color-light);
            position: sticky;
            top: 0;
            z-index: 40;
            transition: background 0.3s, border-color 0.3s;
        }
        
        .header-content {
            max-width: 72rem;
            margin: 0 auto;
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .header-logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .logo-icon {
            width: 3rem;
            height: 3rem;
            border-radius: 0.75rem;
            background: linear-gradient(to bottom right, #3b82f6, #2563eb);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 10px 15px -3px rgba(147, 197, 253, 0.4);
        }
        
        .logo-icon span {
            font-size: 1.5rem;
        }
        
        .logo-text h1 {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
        }
        
        .logo-text p {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }
        
        .header-nav {
            display: flex;
            gap: 0.5rem;
        }
        
        .nav-btn {
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: 500;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .nav-btn.active {
            background: #3b82f6;
            color: white;
        }
        
        .nav-btn:not(.active) {
            background: var(--bg-card-hover);
            color: var(--text-secondary);
        }
        
        .nav-btn:not(.active):hover {
            background: #e5e7eb;
        }
        
        /* Main Content */
        .main-content {
            max-width: 72rem;
            margin: 0 auto;
            padding: 2rem 1rem;
        }
        
        .hero {
            text-align: center;
            margin-bottom: 3rem;
            padding: 2rem 1rem;
        }
        
        .hero h2 {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 1rem;
            line-height: 1.2;
        }
        
        @media (max-width: 768px) {
            .hero h2 {
                font-size: 2rem;
            }
        }
        
        .hero p {
            color: var(--text-secondary);
            max-width: 42rem;
            margin: 0 auto;
            line-height: 1.7;
        }
        
        /* Card */
        .card {
            background: white;
            border-radius: 1rem;
            padding: 2rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.15);
            border: 1px solid #e5e7eb;
        }
        
        /* Upload Box */
        .upload-box {
            border: 2px dashed #93c5fd;
            border-radius: 1rem;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.05) 0%, rgba(147, 197, 253, 0.05) 100%);
        }
        
        .upload-box:hover {
            border-color: #3b82f6;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(147, 197, 253, 0.1) 100%);
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(59, 130, 246, 0.15);
        }
        
        .upload-content {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 2rem;
            align-items: center;
            width: 100%;
            max-width: 900px;
            margin: 0 auto;
        }
        
        @media (max-width: 768px) {
            .upload-content {
                grid-template-columns: 1fr;
                gap: 1.5rem;
            }
        }
        
        .divider {
            color: #9ca3af;
            font-weight: 500;
        }
        
        /* Buttons */
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 0.75rem;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1rem;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(59, 130, 246, 0.4);
        }
        
        .btn-secondary {
            background: var(--bg-card-hover);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }
        
        .btn-secondary:hover {
            background: var(--border-color);
            transform: translateY(-1px);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(34, 197, 94, 0.3);
        }
        
        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(34, 197, 94, 0.4);
        }
        
        .btn-danger {
            background: transparent;
            color: #ef4444;
            font-size: 1.25rem;
            padding: 0.25rem 0.5rem;
        }
        
        .btn-danger:hover {
            color: #dc2626;
        }
        
        .btn-edit {
            background: transparent;
            color: #3b82f6;
            font-size: 1.25rem;
            padding: 0.25rem 0.5rem;
            border: none;
            cursor: pointer;
        }
        
        .btn-edit:hover {
            color: #2563eb;
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 50;
            padding: 1rem;
            overflow-y: auto;
        }
        
        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: white;
            border-radius: 1rem;
            padding: 1.5rem;
            max-width: 42rem;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        
        .modal-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--text-primary);
        }
        
        .close-btn {
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 50%;
            border: none;
            background: transparent;
            cursor: pointer;
            font-size: 1.5rem;
        }
        
        .close-btn:hover {
            background: var(--bg-card-hover);
        }
        
        /* Form */
        .form-group {
            margin-bottom: 1rem;
        }
        
        .form-label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }
        
        .form-input, .form-select {
            width: 100%;
            padding: 0.75rem 1rem;
            border-radius: 0.75rem;
            border: 1px solid #e5e7eb;
            outline: none;
            font-size: 1rem;
        }
        
        .form-input:focus, .form-select:focus {
            border-color: #60a5fa;
            box-shadow: 0 0 0 3px rgba(147, 197, 253, 0.1);
        }
        
        /* Track Section */
        .track-section {
            border-top: 1px solid #e5e7eb;
            padding-top: 1rem;
        }
        
        .track-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
        }
        
        .track-card {
            background: var(--bg-card-hover);
            border-radius: 0.75rem;
            padding: 1rem;
            margin-bottom: 0.75rem;
        }
        
        .track-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
        }
        
        .track-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.75rem;
        }
        
        .track-input {
            padding: 0.5rem 0.75rem;
            border-radius: 0.5rem;
            border: 1px solid #e5e7eb;
            font-size: 0.875rem;
        }
        
        /* Best Offer Card */
        .best-offer {
            background: linear-gradient(to right, #22c55e, #10b981);
            color: white;
        }
        
        .best-offer-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 0.5rem;
        }
        
        .best-offer-icon {
            font-size: 1.875rem;
        }
        
        .best-offer-subtitle {
            font-size: 0.875rem;
            opacity: 0.9;
        }
        
        .best-offer-title {
            font-size: 1.5rem;
            font-weight: 700;
        }
        
        .best-offer-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .best-offer-stat-label {
            font-size: 0.875rem;
            opacity: 0.9;
        }
        
        .best-offer-stat-value {
            font-size: 1.25rem;
            font-weight: 700;
            margin-top: 0.25rem;
        }
        
        /* Table */
        .table-wrapper {
            overflow-x: auto;
            border-radius: 1rem;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        thead {
            background: var(--bg-card-hover);
        }
        
        th {
            padding: 1rem 1.5rem;
            text-align: right;
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--text-secondary);
            border-bottom: 1px solid #e5e7eb;
        }
        
        td {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid #f3f4f6;
        }
        
        tr.best-row {
            background: #f0fdf4;
        }
        
        .bank-cell {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .bank-color {
            width: 4px;
            height: 2.5rem;
            border-radius: 2px;
            box-shadow: 0 0 8px rgba(0,0,0,0.15);
        }
        
        .bank-name {
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .bank-tracks {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }
        
        .badge {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            background: #22c55e;
            color: white;
            font-size: 0.75rem;
            border-radius: 9999px;
            margin-right: 0.5rem;
        }
        
        /* Risk Indicator */
        .risk-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .risk-bar {
            width: 4rem;
            height: 0.5rem;
            background: #e5e7eb;
            border-radius: 9999px;
            overflow: hidden;
        }
        
        .risk-bar-fill {
            height: 100%;
            border-radius: 9999px;
        }
        
        .risk-low { background: #22c55e; }
        .risk-medium { background: #eab308; }
        .risk-high { background: #ef4444; }
        
        /* Detail Cards */
        .detail-cards {
            display: grid;
            gap: 1.5rem;
            margin-top: 1.5rem;
        }
        
        @media (min-width: 768px) {
            .detail-cards {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        .detail-card {
            background: white;
            border-radius: 1rem;
            overflow: hidden;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.15);
            border: 1px solid #e5e7eb;
            transition: all 0.3s ease;
        }
        
        .detail-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.15);
        }
        
        .detail-card-header {
            padding: 1.5rem;
            color: white;
        }
        
        .detail-card-bank {
            font-size: 1.25rem;
            font-weight: 700;
            text-shadow: 0 1px 2px rgba(0,0,0,0.2);
        }
        
        .detail-card-amount {
            font-size: 0.875rem;
            opacity: 0.95;
            margin-top: 0.25rem;
        }
        
        .detail-card-body {
            padding: 1rem;
        }
        
        .track-detail {
            background: var(--bg-card-hover);
            border-radius: 0.5rem;
            padding: 0.75rem;
            margin-bottom: 0.75rem;
        }
        
        .track-detail-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }
        
        .track-name {
            font-weight: 500;
            color: var(--text-primary);
        }
        
        .risk-badge {
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 9999px;
        }
        
        .risk-badge-low {
            background: #dcfce7;
            color: #15803d;
        }

        .risk-badge-medium {
            background: #fef3c7;
            color: #a16207;
        }

        .risk-badge-high {
            background: #fee2e2;
            color: #dc2626;
        }
        
        .track-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.5rem;
            font-size: 0.875rem;
        }
        
        .track-stat-label {
            color: var(--text-secondary);
        }
        
        .track-stat-value {
            font-weight: 500;
        }
        
        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 3rem 1rem;
        }
        
        .empty-icon {
            font-size: 3.75rem;
            margin-bottom: 1rem;
        }
        
        .empty-text {
            color: var(--text-secondary);
            font-size: 1.125rem;
        }
        
        /* Section Header */
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .section-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--text-primary);
        }
        
        /* SEO Content */
        .seo-content {
            line-height: 1.6;
        }
        
        .seo-content h3 {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 1rem;
        }
        
        .seo-content h4 {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--text-primary);
            margin: 1rem 0 0.5rem;
        }
        
        .seo-content p {
            color: var(--text-secondary);
            margin-bottom: 1rem;
        }
        
        .seo-content ul {
            list-style-position: inside;
            color: var(--text-secondary);
        }
        
        .seo-content li {
            margin-bottom: 0.5rem;
        }
        
        .seo-content strong {
            font-weight: 600;
            color: var(--text-primary);
        }
        
        /* Footer */
        .footer {
            background: white;
            border-top: 1px solid #e5e7eb;
            margin-top: 3rem;
        }
        
        .footer-content {
            max-width: 72rem;
            margin: 0 auto;
            padding: 2rem 1rem;
            text-align: center;
            color: var(--text-secondary);
            font-size: 0.875rem;
        }
        
        .footer-content p {
            margin-bottom: 0.5rem;
        }
        
        /* Utilities */
        .text-sm { font-size: 0.875rem; }
        .text-xs { font-size: 0.75rem; }
        .text-red { color: #dc2626; }
        .fw-500 { font-weight: 500; }
        .fw-600 { font-weight: 600; }
        .fw-700 { font-weight: 700; }
        
        .add-track-btn {
            background: none;
            border: none;
            color: #2563eb;
            font-size: 0.875rem;
            cursor: pointer;
        }
        
        .add-track-btn:hover {
            color: #1d4ed8;
        }
        
        .remove-track-btn {
            background: none;
            border: none;
            color: #ef4444;
            font-size: 0.875rem;
            cursor: pointer;
        }
        
        .remove-track-btn:hover {
            color: #dc2626;
        }
        
        /* Tooltip */
        .tooltip-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 16px;
            height: 16px;
            background: #3b82f6;
            color: white;
            border-radius: 50%;
            font-size: 11px;
            font-weight: 700;
            cursor: help;
            margin-right: 4px;
            position: relative;
        }
        
        .tooltip-text {
            visibility: hidden;
            opacity: 0;
            position: fixed;
            top: 40%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #1f2937;
            color: white;
            padding: 1.5rem;
            border-radius: 0.75rem;
            font-size: 0.875rem;
            font-weight: 400;
            width: 280px;
            max-width: 90vw;
            z-index: 10000;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
            transition: opacity 0.2s, visibility 0.2s;
            text-align: right;
            line-height: 1.7;
            white-space: normal;
            word-wrap: break-word;
            pointer-events: auto;
            box-sizing: border-box;
        }
        
        .tooltip-icon:hover .tooltip-text,
        .tooltip-text:hover {
            visibility: visible;
            opacity: 1;
        }
        
        @media (max-width: 500px) {
            .tooltip-text {
                width: 240px;
                right: -20px;
            }
        }
        
        /* Mobile Responsive */
        @media (max-width: 768px) {
            .hero h2 {
                font-size: 1.5rem;
            }
            
            .hero p {
                font-size: 0.9rem;
            }
            
            .card {
                padding: 1.25rem;
                margin-bottom: 1rem;
            }
            
            .detail-cards {
                grid-template-columns: 1fr;
            }
            
            .detail-card-header {
                padding: 1rem;
            }
            
            .detail-card-body {
                padding: 0.75rem;
            }
            
            .track-detail {
                padding: 0.75rem;
            }
            
            .track-stats {
                grid-template-columns: 1fr;
                gap: 0.5rem;
            }
            
            .section-header {
                flex-direction: column;
                align-items: stretch;
                gap: 0.75rem;
            }
            
            .section-title {
                font-size: 1.125rem;
            }
            
            .btn {
                width: 100%;
            }
            
            .header-content {
                flex-direction: column;
                gap: 0.75rem;
            }
            
            .header-nav {
                width: 100%;
                flex-direction: column;
            }
            
            .nav-btn {
                width: 100%;
            }
            
            .modal-content {
                padding: 1rem;
                max-width: 95%;
            }
            
            .track-grid {
                grid-template-columns: 1fr;
            }
            
            /* Compact upload on mobile */
            #comparisonView > .card:first-of-type > div {
                flex-direction: column !important;
            }
            
            #comparisonView > .card:first-of-type label,
            #comparisonView > .card:first-of-type button {
                min-width: 100% !important;
            }
        }
        
        .tooltip-text::after {
            content: '';
            position: absolute;
            bottom: -8px;
            right: 20px;
            border: 8px solid transparent;
            border-top: 8px solid #1f2937;
        }
        
        .tooltip-icon:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .fade-in-up {
            animation: fadeInUp 0.6s ease-out;
        }
    </style>
    <script src="common.js"></script>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="header-logo">
                <div class="logo-icon">
                    <span>🏠</span>
                </div>
                <div class="logo-text">
                    <h1>משווה משכנתא</h1>
                    <p>השוואת הצעות משכנתא חכמה</p>
                </div>
            </div>
            <div class="header-nav">
                <button class="nav-btn active" id="navComparison" onclick="setView('comparison')">
                    השוואה חדשה
                </button>
                <button class="nav-btn" id="navSaved" onclick="setView('saved')">
                    השוואות שמורות (<span id="savedCount">0</span>)
                </button>
                <button class="nav-btn" id="navGuide" onclick="setView('guide')">
                    📚 מדריך משכנתאות
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Comparison View -->
        <div id="comparisonView">
            <!-- Hero -->
            <div class="hero">
                <h2>השווה הצעות משכנתא בקליק אחד</h2>
                <p style="font-size: 1.125rem; max-width: 600px; margin: 0.75rem auto 0;">
                    העלה את האישורים שקיבלת מהבנקים - נבדוק עבורך איזו הצעה הכי משתלמת
                </p>
                <div style="display: flex; gap: 0.75rem; justify-content: center; margin-top: 1.5rem; flex-wrap: wrap;">
                    <span style="display: inline-flex; align-items: center; gap: 0.5rem; padding: 0.5rem 1rem; background: rgba(34, 197, 94, 0.1); border-radius: 9999px; font-size: 0.875rem; color: #15803d; font-weight: 500;">
                        <span style="font-size: 1.25rem;">✓</span> חינם לחלוטין
                    </span>
                    <span style="display: inline-flex; align-items: center; gap: 0.5rem; padding: 0.5rem 1rem; background: rgba(59, 130, 246, 0.1); border-radius: 9999px; font-size: 0.875rem; color: #1e40af; font-weight: 500;">
                        <span style="font-size: 1.25rem;">🔒</span> מאובטח ופרטי
                    </span>
                    <span style="display: inline-flex; align-items: center; gap: 0.5rem; padding: 0.5rem 1rem; background: rgba(234, 179, 8, 0.1); border-radius: 9999px; font-size: 0.875rem; color: #a16207; font-weight: 500;">
                        <span style="font-size: 1.25rem;">⚡</span> תוצאות מיידיות
                    </span>
                </div>
            </div>

            <!-- Compact Upload Section -->
            <div class="card" style="max-width: 700px; margin: 0 auto 1.5rem;">
                <div style="display: flex; gap: 1rem; align-items: center; flex-wrap: wrap;">
                    <label for="pdfUpload" style="flex: 1; min-width: 250px; cursor: pointer;">
                        <input type="file" id="pdfUpload" accept=".pdf" multiple style="display: none;" onchange="handleFileUpload(event)">
                        <div style="border: 2px dashed #93c5fd; border-radius: 0.75rem; padding: 1.5rem; text-align: center; transition: all 0.3s; background: linear-gradient(135deg, #eff6ff 0%, #e0f2fe 100%);">
                            <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">📄</div>
                            <p style="font-weight: 600; color: var(--text-primary); margin-bottom: 0.25rem;">העלה PDF</p>
                            <p style="font-size: 0.875rem; color: var(--text-secondary);">גרור או לחץ להעלאה</p>
                        </div>
                    </label>
                    
                    <div style="text-align: center;">
                        <div style="color: var(--text-muted); font-weight: 500; margin-bottom: 0.5rem;">או</div>
                    </div>
                    
                    <button class="btn btn-secondary" onclick="openModal()" style="flex: 1; min-width: 200px; padding: 1.5rem 1rem; display: flex; flex-direction: column; align-items: center; gap: 0.5rem;">
                        <div style="font-size: 2rem;">✏️</div>
                        <div style="font-weight: 600;">הזנה ידנית</div>
                    </button>
                </div>
            </div>

            <!-- Processing Indicator -->
            <div id="processingIndicator" style="display: none;" class="card">
                <div style="text-align: center; padding: 2rem;">
                    <div style="width: 60px; height: 60px; margin: 0 auto 1rem; border: 4px solid #e5e7eb; border-top-color: #3b82f6; border-radius: 50%; animation: spin 1s linear infinite;"></div>
                    <p style="font-weight: 600; color: var(--text-primary); margin-bottom: 0.5rem;">מעבד קבצים...</p>
                    <p style="color: var(--text-secondary); font-size: 0.875rem;" id="processingFileName"></p>
                </div>
            </div>

            <!-- Best Offer Card -->
            <!-- Offers Section -->
            <div id="offersSection" style="display: none;">
                <div class="section-header">
                    <h3 class="section-title" id="offersTitle">הצעות להשוואה</h3>
                    <button class="btn btn-success" onclick="saveComparison()">
                        <span>💾</span> שמור השוואה
                    </button>
                </div>

                <!-- Detail Cards -->
                <div class="detail-cards" id="detailCards">
                </div>
            </div>

            <!-- How It Works -->
            <div id="howItWorks" style="max-width: 900px; margin: 3rem auto 2rem;">
                <div class="card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 3rem 2rem;">
                    <h3 style="font-size: 2rem; font-weight: 700; text-align: center; margin-bottom: 2rem; color: white;">איך זה עובד?</h3>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 2rem; margin-top: 2rem;">
                        <div style="text-align: center;">
                            <div style="width: 80px; height: 80px; background: rgba(255,255,255,0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem; font-size: 2.5rem;">
                                📤
                            </div>
                            <h4 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 0.5rem; color: white;">1. העלה</h4>
                            <p style="opacity: 0.95; line-height: 1.6;">העלה את האישורים העקרוניים מהבנקים בפורמט PDF</p>
                        </div>
                        
                        <div style="text-align: center;">
                            <div style="width: 80px; height: 80px; background: rgba(255,255,255,0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem; font-size: 2.5rem;">
                                🤖
                            </div>
                            <h4 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 0.5rem; color: white;">2. ניתוח חכם</h4>
                            <p style="opacity: 0.95; line-height: 1.6;">המערכת מנתחת את כל הנתונים: ריביות, מסלולים, תקופות</p>
                        </div>
                        
                        <div style="text-align: center;">
                            <div style="width: 80px; height: 80px; background: rgba(255,255,255,0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem; font-size: 2.5rem;">
                                📊
                            </div>
                            <h4 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 0.5rem; color: white;">3. השוואה מלאה</h4>
                            <p style="opacity: 0.95; line-height: 1.6;">קבל השוואה מפורטת עם המלצה ברורה איזו הצעה משתלמת</p>
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin-top: 3rem; padding-top: 2rem; border-top: 1px solid rgba(255,255,255,0.3);">
                        <p style="font-size: 1.125rem; opacity: 0.95; max-width: 600px; margin: 0 auto;">
                            💡 <strong>טיפ חשוב:</strong> ההצעות משתנות כל הזמן - כדאי להשוות לפני שחותמים!
                        </p>
                    </div>
                </div>
            </div>

            <!-- Empty State -->
            <div id="emptyState" class="card empty-state">
                <div class="empty-icon">📊</div>
                <p class="empty-text">העלה אישורים עקרוניים כדי להתחיל בהשוואה</p>
            </div>

            <!-- SEO Content -->
            <div class="card seo-content" style="margin-top: 1.5rem;">
                <h3>למה לסמוך עלינו?</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 2rem; margin-top: 2rem;">
                    <div>
                        <div style="font-size: 2.5rem; margin-bottom: 0.75rem;">🔒</div>
                        <h4 style="margin-bottom: 0.5rem;">פרטיות מלאה</h4>
                        <p style="line-height: 1.7;">הקבצים שלך לא נשמרים בשרתים שלנו. כל הניתוח מתבצע במכשיר שלך בלבד.</p>
                    </div>
                    
                    <div>
                        <div style="font-size: 2.5rem; margin-bottom: 0.75rem;">🎯</div>
                        <h4 style="margin-bottom: 0.5rem;">ניתוח מדויק</h4>
                        <p style="line-height: 1.7;">המערכת בודקת כל פרט: החזר חודשי, עלות כוללת, רמת סיכון, ותקנות בנק ישראל.</p>
                    </div>
                    
                    <div>
                        <div style="font-size: 2.5rem; margin-bottom: 0.75rem;">💰</div>
                        <h4 style="margin-bottom: 0.5rem;">חינם לגמרי</h4>
                        <p style="line-height: 1.7;">אין עלויות נסתרות, אין מכירת מידע. רק כלי שעוזר לך לקבל החלטה נכונה.</p>
                    </div>
                </div>
                
                <div style="margin-top: 3rem; padding-top: 2rem; border-top: 1px solid var(--border-color);">
                    <h3>איך להשוות הצעות משכנתא?</h3>
                    <p>
                        כשלוקחים משכנתא, חשוב להשוות בין מספר בנקים. כל בנק מציע תמהיל שונה של מסלולים,
                        ריביות שונות, ותנאים שונים. ההבדל בין הצעה טובה לפחות טובה יכול להגיע למאות אלפי שקלים
                        לאורך חיי ההלוואה.
                    </p>
                    <h4>מה חשוב לבדוק?</h4>
                    <ul>
                        <li><strong>עלות כוללת</strong> - כמה תשלמו בסך הכל (קרן + ריבית + עמלות)</li>
                        <li><strong>החזר חודשי</strong> - האם ההחזר מתאים לתקציב שלכם</li>
                        <li><strong>רמת הסיכון</strong> - כמה מהמשכנתא צמודה למדד או בריבית משתנה</li>
                        <li><strong>גמישות</strong> - תנאים לפירעון מוקדם ומחזור</li>
                    </ul>
                    
                    <div style="background: #eff6ff; padding: 1.5rem; border-radius: 0.75rem; border-right: 4px solid #3b82f6; margin-top: 1.5rem;">
                        <p style="margin: 0; line-height: 1.8;"><strong>💡 טיפ מקצועי:</strong> לא תמיד ההצעה עם החזר חודשי הכי נמוך היא הכי משתלמת! חשוב לבדוק את העלות הכוללת לאורך כל תקופת ההלוואה.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Saved Comparisons View -->
        <div id="savedView" style="display: none;">
            <h2 class="section-title" style="margin-bottom: 1.5rem;">השוואות שמורות</h2>
            <div id="savedList">
            </div>
        </div>

        <!-- Guide View -->
        <div id="guideView" style="display: none;">
            <div style="max-width: 900px; margin: 0 auto;">
                <button onclick="setView('comparison')" style="display: inline-flex; align-items: center; gap: 0.5rem; padding: 0.75rem 1.5rem; background: #3b82f6; color: white; border: none; border-radius: 0.5rem; font-weight: 500; margin-bottom: 2rem; cursor: pointer; font-size: 1rem; transition: all 0.3s;">
                    ← חזרה להשוואה
                </button>

                <div style="background: var(--bg-card); border-radius: 1rem; padding: 3rem; border: 1px solid var(--border-color);">
                    <h1 style="font-size: 2.5rem; margin-bottom: 1rem; color: var(--text-primary);">🎯 מסלול פריים</h1>
                    
                    <h2 style="font-size: 1.75rem; margin: 2rem 0 1rem; color: var(--text-primary); border-bottom: 2px solid var(--border-color); padding-bottom: 0.5rem;">
                        📚 מה זה מסלול פריים?
                    </h2>
                    
                    <p style="font-size: 1.05rem; color: var(--text-secondary); line-height: 1.8; margin-bottom: 1.5rem;">
                        מסלול פריים (Prime) הוא מסלול משכנתא עם <strong>ריבית משתנה</strong> שמתעדכנת באופן חודשי. 
                        הריבית קשורה ישירות לריבית בנק ישראל (הריבית המטרה) ומשתנה בהתאם לשינויים שלה.
                    </p>

                    <div style="background: #dbeafe; border-right: 4px solid #3b82f6; padding: 1.5rem; border-radius: 0.75rem; margin: 2rem 0;">
                        <h3 style="color: #1e40af; margin-bottom: 0.75rem; font-size: 1.15rem;">🔢 איך מחושבת הריבית?</h3>
                        
                        <p style="color: #1e40af; line-height: 1.7; margin-bottom: 1rem;">
                            <strong>שלב 1 - ריבית הפריים הבסיסית:</strong><br>
                            בנק ישראל קובע את "ריבית הפריים" הרשמית. זו ריבית אחידה שכל הבנקים משתמשים בה כבסיס.
                        </p>
                        
                        <p style="color: #1e40af; line-height: 1.7; margin-bottom: 1rem;">
                            <strong>שלב 2 - התמחור של הבנק:</strong><br>
                            כל בנק נותן לכל לקוח <strong>הנחה או תוספת</strong> על הפריים הבסיסי, בהתאם לפרופיל הלקוח, הון עצמי, יכולת החזר וכו'.
                        </p>
                        
                        <p style="color: #1e40af; line-height: 1.7; margin-bottom: 1rem;">
                            <strong>הנוסחה הסופית:</strong><br>
                            הריבית שלך = ריבית הפריים ± ההנחה/התוספת של הבנק
                        </p>
                        
                        <div style="background: rgba(255,255,255,0.5); padding: 1rem; border-radius: 0.5rem; margin-top: 1rem;">
                            <p style="color: #1e40af; line-height: 1.7; margin-bottom: 0.5rem;">
                                <strong>דוגמאות מעשיות:</strong>
                            </p>
                            <ul style="color: #1e40af; line-height: 1.8; margin-right: 2rem;">
                                <li style="margin-bottom: 0.5rem;">ריבית פריים היום: 5.5%</li>
                                <li style="margin-bottom: 0.5rem;">לקוח א' קיבל: <strong>פריים מינוס 0.5%</strong> = הריבית שלו היום 5%</li>
                                <li style="margin-bottom: 0.5rem;">לקוח ב' קיבל: <strong>פריים מינוס 0.3%</strong> = הריבית שלו היום 5.2%</li>
                                <li style="margin-bottom: 0.5rem;">לקוח ג' קיבל: <strong>פריים פלוס 0.2%</strong> = הריבית שלו היום 5.7%</li>
                            </ul>
                        </div>
                        
                        <p style="color: #1e40af; line-height: 1.7; margin-top: 1rem;">
                            <strong>חשוב לדעת:</strong> ההנחה או התוספת נשארים <strong>קבועים</strong> לכל תקופת ההלוואה. 
                            מה שמשתנה זה רק ריבית הפריים הבסיסית של בנק ישראל.
                        </p>
                        
                        <p style="color: #1e40af; line-height: 1.7; margin-top: 1rem;">
                            <strong>לדוגמה:</strong> אם קיבלת "פריים מינוס 0.5%" - אתה תמיד תקבל חצי אחוז פחות מהפריים, 
                            גם אם הפריים יעלה ל-6% או ירד ל-4%.
                        </p>
                    </div>

                    <h2 style="font-size: 1.75rem; margin: 2.5rem 0 1rem; color: var(--text-primary); border-bottom: 2px solid var(--border-color); padding-bottom: 0.5rem;">
                        ✅ יתרונות מסלול פריים
                    </h2>

                    <div style="background: #d1fae5; border-right: 4px solid #10b981; padding: 1.5rem; border-radius: 0.75rem; margin: 2rem 0;">
                        <ul style="color: #065f46; line-height: 1.8; margin-right: 2rem;">
                            <li style="margin-bottom: 1rem;">
                                <strong>✅ גמישות כלפי מטה:</strong> אם ריבית הפריים יורדת - גם ההחזר שלך יורד מיד
                            </li>
                            <li style="margin-bottom: 1rem;">
                                <strong>✅ אין הצמדה למדד:</strong> המסלול לא צמוד למדד המחירים לצרכן, כך שהקרן לא גדלה
                            </li>
                            <li style="margin-bottom: 1rem;">
                                <strong>✅ פירעון מוקדם זול:</strong> בדרך כלל עמלות הפירעון המוקדם נמוכות יותר מאשר במסלולים קבועים
                            </li>
                            <li style="margin-bottom: 1rem;">
                                <strong>✅ מתאים לטווח קצר-בינוני:</strong> אם אתה מתכנן לסגור את המשכנתא תוך מספר שנים, זה יכול להיות משתלם
                            </li>
                        </ul>
                    </div>

                    <h2 style="font-size: 1.75rem; margin: 2.5rem 0 1rem; color: var(--text-primary); border-bottom: 2px solid var(--border-color); padding-bottom: 0.5rem;">
                        ❌ חסרונות מסלול פריים
                    </h2>

                    <div style="background: #fee2e2; border-right: 4px solid #ef4444; padding: 1.5rem; border-radius: 0.75rem; margin: 2rem 0;">
                        <ul style="color: #991b1b; line-height: 1.8; margin-right: 2rem;">
                            <li style="margin-bottom: 1rem;">
                                <strong>❌ אי-ודאות גבוהה:</strong> אי אפשר לדעת מראש כמה תשלם בעוד שנה או שנתיים - זה תלוי בהחלטות בנק ישראל
                            </li>
                            <li style="margin-bottom: 1rem;">
                                <strong>❌ סיכון לעליות חדות:</strong> אם הריבית עולה, ההחזר החודשי שלך יכול לעלות משמעותית ופתאום
                            </li>
                            <li style="margin-bottom: 1rem;">
                                <strong>❌ קושי בתכנון תקציב:</strong> קשה לתכנן תקציב משפחתי כשההחזר משתנה כל הזמן
                            </li>
                            <li style="margin-bottom: 1rem;">
                                <strong>❌ לחץ פסיכולוגי:</strong> המעקב הקבוע אחר שינויים בריבית יכול ליצור מתח וחוסר שקט נפשי
                            </li>
                            <li style="margin-bottom: 1rem;">
                                <strong>❌ תלות במדיניות כלכלית:</strong> אתה תלוי בהחלטות בנק ישראל שאין לך שליטה עליהן
                            </li>
                            <li style="margin-bottom: 1rem;">
                                <strong>❌ מסוכן בסביבה אינפלציונית:</strong> כשיש אינפלציה גבוהה, בנק ישראל מעלה את הריבית - וההחזר שלך מזנק
                            </li>
                        </ul>
                    </div>

                    <h2 style="font-size: 1.75rem; margin: 2.5rem 0 1rem; color: var(--text-primary); border-bottom: 2px solid var(--border-color); padding-bottom: 0.5rem;">
                        📋 תקנת בנק ישראל
                    </h2>

                    <div style="background: #fee2e2; border-right: 4px solid #ef4444; padding: 1.5rem; border-radius: 0.75rem; margin: 2rem 0;">
                        <h3 style="color: #991b1b; margin-bottom: 0.75rem; font-size: 1.15rem;">⚠️ חובה לפי חוק</h3>
                        <p style="color: #991b1b; line-height: 1.8; margin-bottom: 0.5rem;">
                            <strong>לפי תקנות בנק ישראל:</strong> לפחות <strong>שליש (33.3%)</strong> מהמשכנתא חייב להיות במסלול קבוע - 
                            קבועה לא צמודה או קבועה צמודה למדד.
                        </p>
                        <p style="color: #991b1b; line-height: 1.8;">
                            <strong>משמעות:</strong> אתה לא יכול לקחת יותר מ-66.6% במסלולים משתנים (פריים, משתנה וכו').
                        </p>
                    </div>

                    <div style="margin-top: 3rem; padding-top: 2rem; border-top: 1px solid var(--border-color); text-align: center;">
                        <button onclick="setView('comparison')" style="padding: 1rem 2rem; background: #3b82f6; color: white; border: none; border-radius: 0.5rem; font-size: 1.15rem; font-weight: 600; cursor: pointer; transition: all 0.3s;">
                            חזור להשוואה שלך ובדוק את ההצעות →
                        </button>
                    </div>

                    <div style="margin-top: 2rem; padding-top: 2rem; border-top: 1px solid var(--border-color);">
                        <p style="color: var(--text-secondary); font-size: 0.875rem; line-height: 1.6;">
                            <strong>הערה:</strong> המידע כאן הוא למטרות חינוכיות בלבד ואינו מהווה ייעוץ פיננסי. 
                            מומלץ להתייעץ עם יועץ משכנתאות מוסמך לפני קבלת החלטות.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content" style="padding: 3rem 1rem;">
            <div style="max-width: 900px; margin: 0 auto;">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 2rem; margin-bottom: 2rem;">
                    <div>
                        <h4 style="font-weight: 700; margin-bottom: 1rem; color: var(--text-primary); font-size: 1.125rem;">משווה משכנתא</h4>
                        <p style="line-height: 1.7;">כלי חינמי להשוואת הצעות משכנתא מבנקים שונים. עוזר לך לקבל החלטה נכונה ולחסוך אלפי שקלים.</p>
                    </div>
                    
                    <div>
                        <h4 style="font-weight: 700; margin-bottom: 1rem; color: var(--text-primary); font-size: 1.125rem;">למה אנחנו?</h4>
                        <ul style="list-style: none; padding: 0; line-height: 2;">
                            <li>✓ ניתוח אוטומטי מדויק</li>
                            <li>✓ חינם לחלוטין</li>
                            <li>✓ ללא שמירת מידע</li>
                            <li>✓ תוצאות מיידיות</li>
                        </ul>
                    </div>
                    
                    <div>
                        <h4 style="font-weight: 700; margin-bottom: 1rem; color: var(--text-primary); font-size: 1.125rem;">שימושי לדעת</h4>
                        <ul style="list-style: none; padding: 0; line-height: 2;">
                            <li><a href="#" onclick="setView('guide'); return false;" style="color: var(--text-secondary); text-decoration: none;">מדריך משכנתאות</a></li>
                            <li><a href="#howItWorks" style="color: var(--text-secondary); text-decoration: none;">איך זה עובד?</a></li>
                            <li><a href="#" onclick="setView('comparison'); return false;" style="color: var(--text-secondary); text-decoration: none;">התחל השוואה</a></li>
                        </ul>
                    </div>
                </div>
                
                <div style="text-align: center; padding-top: 2rem; border-top: 1px solid var(--border-color);">
                    <p style="margin-bottom: 0.5rem;">© 2025 משווה משכנתא. כל הזכויות שמורות.</p>
                    <p style="font-size: 0.875rem;">
                        הכלי מיועד להשוואה בלבד ואינו מהווה ייעוץ פיננסי. מומלץ להתייעץ עם יועץ משכנתאות מוסמך.
                    </p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Modal -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">הזנת הצעה ידנית</h3>
                <button class="close-btn" onclick="closeModal()">✕</button>
            </div>

            <div class="form-group">
                <label class="form-label">בנק</label>
                <select id="bankSelect" class="form-select">
                    <option value="">בחר בנק</option>
                    <option value="בנק הפועלים">בנק הפועלים</option>
                    <option value="בנק לאומי">בנק לאומי</option>
                    <option value="בנק דיסקונט">בנק דיסקונט</option>
                    <option value="מזרחי טפחות">מזרחי טפחות</option>
                    <option value="הבינלאומי">הבינלאומי</option>
                    <option value="בנק יהב">בנק יהב</option>
                    <option value="מרכנתיל">מרכנתיל</option>
                    <option value="בנק ירושלים">בנק ירושלים</option>
                    <option value="משכנתא ישירה">משכנתא ישירה</option>
                    <option value="אחר">אחר</option>
                </select>
            </div>

            <div class="form-group">
                <label class="form-label">סכום כולל (₪)</label>
                <input type="number" id="totalAmount" class="form-input" placeholder="1,000,000">
                <div id="amountError" style="display: none; margin-top: 0.5rem; padding: 0.75rem; background: #fee2e2; border: 1px solid #dc2626; border-radius: 0.5rem; color: #dc2626; font-size: 0.875rem; font-weight: 600;">
                </div>
            </div>

            <div class="track-section">
                <div class="track-header">
                    <label class="form-label" style="margin: 0;">מסלולים</label>
                    <button class="add-track-btn" onclick="addTrack()">+ הוסף מסלול</button>
                </div>
                <div id="tracksContainer">
                    <!-- Tracks will be added here -->
                </div>
            </div>

            <button class="btn btn-primary" style="width: 100%; margin-top: 1rem;" onclick="submitOffer()">
                הוסף הצעה
            </button>
        </div>
    </div>

    <script>
        const TRACK_TYPES = {
            'prime': { 
                name: 'פריים', 
                risk: 'high',
                description: 'הריבית משתנה חודשית לפי בנק ישראל.\n\n🔴 אי-ודאות גבוהה - ההחזר יכול להשתנות בכל חודש\n✅ גמישות - נהנה מהורדות ריבית מיד\n⚠️ קשה לתכנן תקציב ארוך טווח'
            },
            'fixed_unlinked': { 
                name: 'קבועה לא צמודה (קל"צ)', 
                risk: 'low',
                description: 'הריבית והקרן קבועות לכל התקופה.\n\n✅ וודאות מלאה - ההחזר לא משתנה לעולם\n✅ הקרן פוחתת בהתמדה\n⚠️ פירעון מוקדם יקר'
            },
            'fixed_linked': { 
                name: 'קבועה צמודה למדד (ק"צ)', 
                risk: 'medium',
                description: 'הריבית קבועה, הקרן צמודה למדד.\n\n✅ הריבית לא משתנה\n🔴 ההחזר משתנה לפי האינפלציה\n📊 מתאים למי שההכנסה צמודה למדד'
            },
            'variable_1_linked': { 
                name: 'משתנה צמודה כל שנה', 
                risk: 'high',
                description: 'הריבית משתנה כל שנה + צמוד למדד.\n\n🔴 סיכון כפול - ריבית ומדד\n🔴 ההחזר יכול להשתנות משמעותית\n⚠️ אי-ודאות גבוהה מאוד'
            },
            'variable_unlinked_18m': { 
                name: 'משתנה כל 18 חודשים', 
                risk: 'medium',
                description: 'הריבית משתנה כל שנה וחצי.\n\n🟡 איזון בין יציבות לגמישות\n✅ הקרן פוחתת\n📊 שינוי כל 18 חודשים'
            },
            'variable_unlinked_2y': { 
                name: 'משתנה כל שנתיים', 
                risk: 'medium',
                description: 'הריבית משתנה כל שנתיים.\n\n🟡 יציבות לשנתיים, אז עדכון\n✅ הקרן פוחתת\n📊 איזון סביר'
            },
            'variable_2_5_linked': { 
                name: 'משתנה צמודה כל 2.5 שנים', 
                risk: 'high',
                description: 'הריבית משתנה כל 2.5 שנים + צמוד למדד.\n\n🔴 סיכון כפול - ריבית ומדד\n🔴 הקרן גדלה באינפלציה\n📊 מתאים רק למי שההכנסה צמודה למדד'
            },
            'variable_unlinked_3y': { 
                name: 'משתנה כל 3 שנים', 
                risk: 'medium',
                description: 'הריבית משתנה כל 3 שנים.\n\n🟡 יציבות ל-3 שנים\n✅ הקרן פוחתת\n📊 סיכון בינוני'
            },
            'variable_linked_3y': { 
                name: 'משתנה צמודה כל 3 שנים', 
                risk: 'high',
                description: 'הריבית משתנה כל 3 שנים + צמוד למדד.\n\n🔴 סיכון כפול - ריבית ומדד\n🔴 הקרן גדלה באינפלציה\n⚠️ קשה לחזות את ההחזר'
            },
            'variable_unlinked_5y': { 
                name: 'משתנה כל 5 שנים', 
                risk: 'medium',
                description: 'הריבית משתנה כל 5 שנים.\n\n✅ איזון מעולה - 5 שנים יציבות\n✅ הקרן פוחתת\n📊 המסלול הנפוץ ביותר\n⚠️ הריבית יכולה לעלות/לרדת כל 5 שנים'
            },
            'variable_5': { 
                name: 'משתנה כל 5 שנים', 
                risk: 'medium',
                description: 'הריבית משתנה כל 5 שנים.\n\n✅ איזון מעולה - 5 שנים יציבות\n✅ הקרן פוחתת\n📊 המסלול הנפוץ ביותר\n⚠️ הריבית יכולה לעלות/לרדת כל 5 שנים'
            },
            'variable_linked_5y': { 
                name: 'משתנה צמודה כל 5 שנים', 
                risk: 'high',
                description: 'הריבית משתנה כל 5 שנים + צמוד למדד.\n\n🔴 הקרן גדלה באינפלציה\n🟡 5 שנים יציבות בריבית\n📊 מתאים למי שההכנסה צמודה למדד'
            },
            'variable_5_linked': { 
                name: 'משתנה צמודה כל 5 שנים', 
                risk: 'high',
                description: 'הריבית משתנה כל 5 שנים + צמוד למדד.\n\n🔴 הקרן גדלה באינפלציה\n🟡 5 שנים יציבות בריבית\n📊 מתאים למי שההכנסה צמודה למדד'
            },
            'variable_unlinked_10y': { 
                name: 'משתנה כל 10 שנים', 
                risk: 'low',
                description: 'הריבית משתנה כל 10 שנים.\n\n✅ עשור שלם של יציבות\n✅ כמעט כמו קבועה\n📊 סיכון נמוך מאוד'
            },
            'variable_10': { 
                name: 'משתנה כל 10 שנים', 
                risk: 'low',
                description: 'הריבית משתנה כל 10 שנים.\n\n✅ עשור שלם של יציבות\n✅ כמעט כמו קבועה\n📊 סיכון נמוך מאוד'
            },
            'variable_linked_10y': { 
                name: 'משתנה צמודה כל 10 שנים', 
                risk: 'medium',
                description: 'הריבית משתנה כל 10 שנים + צמוד למדד.\n\n🟡 עשור יציבות בריבית\n🔴 הקרן גדלה באינפלציה\n📊 מתאים למי שההכנסה צמודה למדד'
            },
            'variable_10_linked': { 
                name: 'משתנה צמודה כל 10 שנים', 
                risk: 'medium',
                description: 'הריבית משתנה כל 10 שנים + צמוד למדד.\n\n🟡 עשור יציבות בריבית\n🔴 הקרן גדלה באינפלציה\n📊 מתאים למי שההכנסה צמודה למדד'
            },
        };

        // Unified gradient for all banks - clean and professional
        const UNIFIED_GRADIENT = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
        
        const BANKS = {
            'בנק הפועלים': UNIFIED_GRADIENT,
            'בנק לאומי': UNIFIED_GRADIENT,
            'בנק דיסקונט': UNIFIED_GRADIENT,
            'מזרחי טפחות': UNIFIED_GRADIENT,
            'הבינלאומי': UNIFIED_GRADIENT,
            'בנק יהב': UNIFIED_GRADIENT,
            'מרכנתיל': UNIFIED_GRADIENT,
            'בנק ירושלים': UNIFIED_GRADIENT,
            'משכנתא ישירה': UNIFIED_GRADIENT,
            'אחר': UNIFIED_GRADIENT
        };

        let offers = [];
        let savedComparisons = [];
        let currentView = 'comparison';
        let trackCount = 0;
        let editingOfferId = null; // Track which offer is being edited
        
        // Save offers to localStorage and session
        function saveOffers() {
            localStorage.setItem('mortgage_offers', JSON.stringify(offers));
            if (window.mortgageSession) {
                window.mortgageSession.saveOffers(offers);
            }
        }
        
        // Load offers from localStorage
        function loadOffers() {
            const saved = localStorage.getItem('mortgage_offers');
            if (saved) {
                offers = JSON.parse(saved);
                updateUI();
            }
        }
        
        // Alias for updateUI (used by file upload)
        function renderOffers() {
            updateUI();
        }
        
        // Get track name by type
        function getTrackName(type) {
            const trackNames = {
                'prime': 'פריים',
                'fixed_unlinked': 'קבועה לא צמודה (קל"צ)',
                'fixed_linked': 'קבועה צמודה (ק"צ)',
                'variable_1_linked': 'משתנה כל שנה צמודה',
                'variable_2_5_linked': 'משתנה כל 2.5 שנים צמודה',
                'variable_5': 'משתנה כל 5 שנים',
                'variable_5_linked': 'משתנה כל 5 שנים צמודה',
                'variable_10': 'משתנה כל 10 שנים',
                'variable_10_linked': 'משתנה כל 10 שנים צמודה',
                'variable_linked': 'משתנה צמודה',
                'variable_unlinked': 'משתנה לא צמודה',
                'variable_every_5y_unlinked': 'משתנה כל 5 שנים לא צמודה',
                'variable_every_5y_linked': 'משתנה כל 5 שנים צמודה',
                'prime_for_business': 'פריים עסקי',
                'eligibility': 'זכאות'
            };
            return trackNames[type] || type;
        }
        
        // Theme management
        
        // Load offers from localStorage
        loadOffers();
        
        // Re-position tooltips on resize
        window.addEventListener('resize', function() {
            document.querySelectorAll('.tooltip-text').forEach(tooltip => {
                tooltip.style.visibility = 'hidden';
                tooltip.style.opacity = '0';
            });
        });

        // Load saved comparisons from localStorage
        function loadSavedComparisons() {
            const saved = localStorage.getItem('mortgage_comparisons');
            if (saved) {
                savedComparisons = JSON.parse(saved);
                document.getElementById('savedCount').textContent = savedComparisons.length;
            }
        }

        function formatCurrency(num) {
            return new Intl.NumberFormat('he-IL', { 
                style: 'currency', 
                currency: 'ILS', 
                maximumFractionDigits: 0 
            }).format(num);
        }

        function calculateMonthlyPayment(principal, annualRate, years) {
            const monthlyRate = annualRate / 100 / 12;
            const numPayments = years * 12;
            if (monthlyRate === 0) return principal / numPayments;
            return principal * (monthlyRate * Math.pow(1 + monthlyRate, numPayments)) / 
                   (Math.pow(1 + monthlyRate, numPayments) - 1);
        }

        function calculateTotalInterest(principal, monthlyPayment, years) {
            return (monthlyPayment * years * 12) - principal;
        }

        function calculateRiskScore(tracks) {
            if (!tracks || tracks.length === 0) return 0;
            
            let totalAmount = 0, weightedRisk = 0;
            
            tracks.forEach(track => {
                const riskValue = calculateTrackRiskScore(track.type);
                totalAmount += track.amount;
                weightedRisk += track.amount * riskValue;
            });
            
            return totalAmount > 0 ? Math.round(weightedRisk / totalAmount) : 0;
        }
        
        function calculateTrackRiskScore(trackType) {
            // Returns risk score for a single track type
            switch(trackType) {
                case 'prime': return 85;
                case 'fixed_unlinked': return 20;
                case 'fixed_linked': return 55;
                case 'variable_unlinked_18m': return 60;
                case 'variable_unlinked_2y': return 50;
                case 'variable_unlinked_3y': return 45;
                case 'variable_unlinked_5y': return 35;
                case 'variable_unlinked_10y': return 25;
                case 'variable_linked_3y': return 80;
                case 'variable_linked_5y': return 75;
                case 'variable_linked_10y': return 60;
                default: return 50;
            }
        }

        function setView(view) {
            currentView = view;
            document.getElementById('navComparison').classList.toggle('active', view === 'comparison');
            document.getElementById('navSaved').classList.toggle('active', view === 'saved');
            const guideBtn = document.getElementById('navGuide');
            if (guideBtn) guideBtn.classList.toggle('active', view === 'guide');
            
            document.getElementById('comparisonView').style.display = view === 'comparison' ? 'block' : 'none';
            document.getElementById('savedView').style.display = view === 'saved' ? 'block' : 'none';
            document.getElementById('guideView').style.display = view === 'guide' ? 'block' : 'none';
            
            if (view === 'saved') {
                renderSavedComparisons();
            }
        }

        // ✨ COST OPTIMIZATION: Extract text from PDF using PDF.js (10x cheaper!)
        async function extractTextFromPDF(file) {
            try {
                console.log('📄 Attempting text extraction from PDF...');
                const arrayBuffer = await file.arrayBuffer();
                const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
                
                let fullText = '';
                const numPages = pdf.numPages;
                console.log(`📄 PDF has ${numPages} pages`);
                
                // Extract text from all pages
                for (let i = 1; i <= numPages; i++) {
                    const page = await pdf.getPage(i);
                    const textContent = await page.getTextContent();
                    const pageText = textContent.items.map(item => item.str).join(' ');
                    fullText += `\n\n=== עמוד ${i} ===\n${pageText}`;
                }
                
                console.log(`✅ Text extracted: ${fullText.length} characters`);
                return fullText;
            } catch (error) {
                console.error('❌ Error extracting text from PDF:', error);
                return null;
            }
        }

        // Get parsing prompt (reusable for both text and PDF modes)
        function getParsingPrompt() {
            return `חלץ את המידע הבא בפורמט JSON בלבד, ללא טקסט נוסף:

{
  "bank": "שם הבנק",
  "totalAmount": סכום_כולל_במספר,
  "totalMonthlyPayment": החזר_חודשי_כולל_במספר,
  "loanPurpose": "מטרת ההלוואה",
  "tracks": [
    {
      "type": "סוג_המסלול",
      "name": "שם המסלול בעברית - קצר וברור, ללא 'על בסיס אג\\"ח ממשלתי'",
      "amount": סכום_במספר,
      "interestRate": ריבית_סופית_במספר,
      "spread": תוספת_או_הנחה_במספר_או_null,
      "years": תקופה_בשנים,
      "monthlyPayment": החזר_חודשי_של_מסלול
    }
  ]
}

הוראות ספציפיות למזרחי טפחות:
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

1. סכום כולל: חפש "יתרה לסילוק בתיק" או "סכום הביצוע"
2. החזר חודשי כולל: חפש "ההחזר החודשי" בטבלה הראשית
3. מטרת הלוואה: חפש "מטרת הלוואה:" (דיור, כל מטרה, מיחזור וכו')

לכל מסלול:
━━━━━━━━━━
- סכום: חפש "יתרת הקרן:" (לא "סכום חלק זה בעת הביצוע")
- החזר חודשי: חפש "סכום החיוב החודשי בגין חלק זה:"
- תקופה: חשב מ"תאריך סיום חלק זה של ההלוואה"

זיהוי סוג מסלול (type):
━━━━━━━━━━━━━━━━━━━━━
"ריבית קבועה צמודה למדד" → fixed_linked
"קבועה צמודה" → fixed_linked
"לא צמוד, ריבית פריים" → prime
"פריים" → prime
"קבועה לא צמודה" → fixed_unlinked

למסלולים משתנים - חפש "תדירות שינוי הריבית: XX חודשים":
- 12 חודשים → variable_1_linked (אם צמוד)
- 30 חודשים → variable_2_5_linked (אם צמוד)
- 60 חודשים → variable_5_linked (אם צמוד) או variable_5 (אם לא צמוד)
- 120 חודשים → variable_10_linked (אם צמוד) או variable_10 (אם לא צמוד)

אם לא מצאת "תדירות שינוי הריבית", השתמש בשם המסלול:
"משתנה צמודה כל 5 שנים" → variable_5_linked
"משתנה צמודה כל 3 שנים" → variable_linked_3y
"משתנה כל 5 שנים" → variable_5
"משתנה כל 10 שנים" → variable_10

**חשוב:** התעלם מהביטוי "על בסיס אג"ח ממשלתי" - זה רק הסבר טכני.
"משתנה צמודה כל 3 שנים על בסיס אג"ח ממשלתי" = variable_linked_3y

**שמות מסלולים (name):**
תמיד החזר שם קצר וברור ללא "על בסיס אג"ח ממשלתי":
✅ נכון: "משתנה צמודה כל 3 שנים"
❌ לא נכון: "משתנה צמודה כל 3 שנים על בסיס אג"ח ממשלתי"

ריבית - קריטי מאוד!
━━━━━━━━━━━━━━━━━━━
למסלולים קבועים: 
- קח את "שיעור הריבית בחלק זה:"
- זו הריבית הסופית והיחידה

לפריים ומשתנה יש 2 ערכים:
1. הריבית הסופית (interestRate): חפש "שיעור הריבית:" במועד החישוב
   - זו הריבית שהלקוח משלם היום בפועל
   
2. התוספת/הנחה (spread): חפש "שיעור התוספת לעוגן:"
   - אם יש סימן מינוס (-) בצד ימין → מספר שלילי
     דוגמה: "% 0.300000 - 0.300000% -" → -0.3
   - אם סימן פלוס (+) בצד ימין → מספר חיובי
     דוגמה: "% 2.900000 + 2.900000% +" → 2.9

דוגמאות:
- פריים: אם "שיעור הריבית: 5.45%" ו"שיעור התוספת לעוגן: -0.3%" 
  → interestRate: 5.45, spread: -0.3
  
- משתנה: אם "שיעור הריבית: 6.61%" ו"שיעור התוספת לעוגן: +2.9%"
  → interestRate: 6.61, spread: 2.9
  
- קבועה: אם "שיעור הריבית בחלק זה: 3.3%"
  → interestRate: 3.3, spread: null

חשוב: אם לא מצאת מידע - השתמש ב-null או 0 בהתאם.
החזר רק JSON, ללא טקסט מקדים או backticks.`;
        }

        // File upload handler
        async function handleFileUpload(event) {
            const files = event.target.files;
            if (!files || files.length === 0) return;

            const processingIndicator = document.getElementById('processingIndicator');
            const processingFileName = document.getElementById('processingFileName');
            
            processingIndicator.style.display = 'block';

            for (let file of files) {
                processingFileName.textContent = `מעבד את ${file.name}...`;
                
                try {
                    const startTime = performance.now();
                    
                    // Show extraction phase
                    processingFileName.textContent = `מעבד את ${file.name}...`;
                    
                    // ✨ NEW: Try to extract text first (cheaper & faster!)
                    let extractedText = await extractTextFromPDF(file);
                    
                    let apiContent;
                    let costEstimate = '';
                    
                    if (extractedText && extractedText.length > 100) {
                        // Success! Use text-only (10x cheaper!)
                        console.log('✅ Using text extraction (cost-effective)');
                        console.log(`📊 Text length: ${extractedText.length} chars (~${Math.ceil(extractedText.length / 4)} tokens)`);
                        costEstimate = 'זול (טקסט בלבד)';
                        processingFileName.textContent = `מעבד את ${file.name}...`;
                        
                        apiContent = [
                            {
                                type: "text",
                                text: `אתה מנתח מסמכי משכנתא ישראליים. להלן הטקסט שחולץ מה-PDF:\n\n${extractedText}\n\n` + getParsingPrompt()
                            }
                        ];
                    } else {
                        // Fallback: use full PDF (more expensive but works for scanned docs)
                        console.log('⚠️ Text extraction failed, using full PDF');
                        costEstimate = 'יקר (PDF מלא)';
                        processingFileName.textContent = `מעבד את ${file.name}...`;
                        
                        const base64 = await fileToBase64(file);
                        console.log(`📊 PDF size: ${Math.round(base64.length / 1024)}KB`);
                        
                        apiContent = [
                            {
                                type: "document",
                                source: {
                                    type: "base64",
                                    media_type: "application/pdf",
                                    data: base64
                                }
                            },
                            {
                                type: "text",
                                text: `אתה מנתח מסמכי משכנתא ישראליים (פירוט יתרות או אישורים עקרוניים).\n\n` + getParsingPrompt()
                            }
                        ];
                    }
                    
                    console.log(`💰 Cost estimate: ${costEstimate}`);
                    
                    // Call Claude API
                    const response = await fetch("https://api.anthropic.com/v1/messages", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                        },
                        body: JSON.stringify({
                            model: "claude-sonnet-4-20250514",
                            max_tokens: 2000,
                            messages: [
                                {
                                    role: "user",
                                    content: apiContent
                                }
                            ],
                        })
                    });

                    const data = await response.json();
                    const responseText = data.content[0]?.text || '';
                    
                    const endTime = performance.now();
                    const processingTime = ((endTime - startTime) / 1000).toFixed(2);
                    console.log(`⏱️ Processing time: ${processingTime}s`);
                    console.log(`💰 Method: ${costEstimate}`);
                    
                    // Extract JSON
                    const jsonMatch = responseText.match(/\{[\s\S]*\}/);
                    if (jsonMatch) {
                        const parsedData = JSON.parse(jsonMatch[0]);
                        addOfferFromParsedData(parsedData, file.name);
                        
                        console.log(`✅ Successfully processed ${file.name} in ${processingTime}s using ${costEstimate} method`);
                    } else {
                        alert(`לא הצלחתי לקרוא את הקובץ ${file.name}. נסה הזנה ידנית.`);
                    }
                } catch (error) {
                    console.error('Error processing file:', file.name, error);
                    alert(`שגיאה בקריאת ${file.name}. נסה הזנה ידנית.`);
                }
            }

            processingIndicator.style.display = 'none';
            event.target.value = ''; // Reset input
        }

        // Convert file to base64
        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => {
                    const base64 = reader.result.split(',')[1];
                    resolve(base64);
                };
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }
        
        // Extract text from PDF using PDF.js
        async function extractTextFromPDF(file) {
            try {
                const arrayBuffer = await file.arrayBuffer();
                const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
                
                let fullText = '';
                const numPages = pdf.numPages;
                
                // Extract text from all pages
                for (let i = 1; i <= numPages; i++) {
                    const page = await pdf.getPage(i);
                    const textContent = await page.getTextContent();
                    const pageText = textContent.items.map(item => item.str).join(' ');
                    fullText += `\n--- עמוד ${i} ---\n${pageText}\n`;
                }
                
                return fullText;
            } catch (error) {
                console.error('Error extracting text from PDF:', error);
                return null;
            }
        }

        // Add offer from parsed data
        function addOfferFromParsedData(parsedData, fileName) {
            const tracks = parsedData.tracks.map(track => {
                const amount = parseFloat(track.amount) || 0;
                const rate = parseFloat(track.interestRate) || 0;
                const spread = track.spread !== undefined && track.spread !== null ? parseFloat(track.spread) : null;
                const years = parseInt(track.years) || 20;
                
                // Use monthly payment from document if available, otherwise calculate
                let monthly = parseFloat(track.monthlyPayment) || 0;
                if (monthly === 0) {
                    monthly = calculateMonthlyPayment(amount, rate, years);
                }
                
                const interest = calculateTotalInterest(amount, monthly, years);
                
                return {
                    type: track.type,
                    name: track.name || getTrackName(track.type),
                    amount: amount,
                    interestRate: rate,
                    spread: spread,
                    years: years,
                    monthlyPayment: Math.round(monthly),
                    totalInterest: Math.round(interest)
                };
            });

            const totalAmount = parseFloat(parsedData.totalAmount) || tracks.reduce((sum, t) => sum + t.amount, 0);
            
            // Use total monthly payment from document if available
            let totalMonthlyPayment = parseFloat(parsedData.totalMonthlyPayment) || 0;
            if (totalMonthlyPayment === 0) {
                totalMonthlyPayment = tracks.reduce((sum, t) => sum + t.monthlyPayment, 0);
            }
            
            const totalInterest = tracks.reduce((sum, t) => sum + t.totalInterest, 0);

            const offer = {
                id: Date.now() + Math.random(),
                fileName: fileName,
                bank: parsedData.bank || 'לא זוהה',
                bankColor: BANKS[parsedData.bank] || UNIFIED_GRADIENT,
                totalAmount: totalAmount,
                tracks: tracks,
                loanPurpose: parsedData.loanPurpose || '',
                totalMonthlyPayment: Math.round(totalMonthlyPayment),
                totalInterest: Math.round(totalInterest),
                totalCost: Math.round(totalAmount + totalInterest),
                riskScore: calculateRiskScore(tracks),
                uploadedAt: new Date().toISOString()
            };

            offers.push(offer);
            saveOffers();
            renderOffers();
        }

        function openModal(editMode = false) {
            document.getElementById('modal').classList.add('show');
            
            if (!editMode) {
                // Clear form for new entry
                editingOfferId = null;
                document.getElementById('bankSelect').value = '';
                document.getElementById('totalAmount').value = '';
                document.getElementById('tracksContainer').innerHTML = '';
                trackCount = 0;
                addTrack();
                document.querySelector('.modal-title').textContent = 'הזנת הצעה ידנית';
                document.querySelector('.modal-content button[onclick="submitOffer()"]').textContent = 'הוסף הצעה';
            } else {
                // Edit mode - form will be populated by editOffer function
                document.querySelector('.modal-title').textContent = 'עריכת הצעה';
                document.querySelector('.modal-content button[onclick="submitOffer()"]').textContent = 'עדכן הצעה';
            }
        }

        function closeModal() {
            document.getElementById('modal').classList.remove('show');
        }

        function addTrack() {
            trackCount++;
            const trackId = `track_${trackCount}`;
            const tracksContainer = document.getElementById('tracksContainer');
            
            const trackHtml = `
                <div class="track-card" id="${trackId}">
                    <div class="track-card-header">
                        <span class="text-sm fw-500" style="color: var(--text-secondary);">מסלול ${trackCount}</span>
                        ${trackCount > 1 ? `<button class="remove-track-btn" onclick="removeTrack('${trackId}')">הסר</button>` : ''}
                    </div>
                    <div class="track-grid">
                        <select class="track-input track-type" onchange="updateYearsPlaceholder(this)">
                            <option value="prime">פריים</option>
                            <option value="fixed_unlinked">קבועה לא צמודה</option>
                            <option value="fixed_linked">קבועה צמודה</option>
                            <optgroup label="משתנה לא צמודה">
                                <option value="variable_unlinked_18m">משתנה כל 18 חודשים</option>
                                <option value="variable_unlinked_2y">משתנה כל שנתיים</option>
                                <option value="variable_unlinked_3y">משתנה כל 3 שנים</option>
                                <option value="variable_5">משתנה כל 5 שנים</option>
                                <option value="variable_10">משתנה כל 10 שנים</option>
                            </optgroup>
                            <optgroup label="משתנה צמודה">
                                <option value="variable_1_linked">משתנה צמודה כל שנה</option>
                                <option value="variable_2_5_linked">משתנה צמודה כל 2.5 שנים</option>
                                <option value="variable_linked_3y">משתנה צמודה כל 3 שנים</option>
                                <option value="variable_5_linked">משתנה צמודה כל 5 שנים</option>
                                <option value="variable_10_linked">משתנה צמודה כל 10 שנים</option>
                            </optgroup>
                        </select>
                        <input type="number" class="track-input track-amount" placeholder="סכום (₪)">
                        <input type="number" step="0.5" class="track-input track-rate" placeholder="ריבית (%)">
                        <input type="number" step="0.5" class="track-input track-years" placeholder="שנים">
                    </div>
                </div>
            `;
            
            tracksContainer.insertAdjacentHTML('beforeend', trackHtml);
        }

        function removeTrack(trackId) {
            document.getElementById(trackId).remove();
        }

        function updateYearsPlaceholder(selectElement) {
            const trackCard = selectElement.closest('.track-card');
            const yearsInput = trackCard.querySelector('.track-years');
            const selectedType = selectElement.value;
            
            const periodRequirements = {
                'variable_unlinked_18m': { 
                    placeholder: 'שנים (1.5, 3, 4.5, 6, 7.5...)', 
                    title: 'כל 18 חודשים - הזן תקופה כך שמספר החודשים יתחלק ב-18' 
                },
                'variable_unlinked_2y': { 
                    placeholder: 'שנים (2, 4, 6, 8, 10...)', 
                    title: 'כל שנתיים (24 חודשים) - הזן תקופה זוגית' 
                },
                'variable_unlinked_3y': { 
                    placeholder: 'שנים (3, 6, 9, 12, 15...)', 
                    title: 'כל 3 שנים (36 חודשים) - מספר החודשים חייב להתחלק ב-36' 
                },
                'variable_linked_3y': { 
                    placeholder: 'שנים (3, 6, 9, 12, 15...)', 
                    title: 'כל 3 שנים (36 חודשים) - מספר החודשים חייב להתחלק ב-36' 
                },
                'variable_5': { 
                    placeholder: 'שנים (5, 10, 15, 20, 25...)', 
                    title: 'כל 5 שנים (60 חודשים) - מספר החודשים חייב להתחלק ב-60' 
                },
                'variable_5_linked': { 
                    placeholder: 'שנים (5, 10, 15, 20, 25...)', 
                    title: 'כל 5 שנים (60 חודשים) - מספר החודשים חייב להתחלק ב-60' 
                },
                'variable_10': { 
                    placeholder: 'שנים (10, 20, 30...)', 
                    title: 'כל 10 שנים (120 חודשים) - מספר החודשים חייב להתחלק ב-120' 
                },
                'variable_10_linked': { 
                    placeholder: 'שנים (10, 20, 30...)', 
                    title: 'כל 10 שנים (120 חודשים) - מספר החודשים חייב להתחלק ב-120' 
                },
                'variable_1_linked': { 
                    placeholder: 'שנים (1, 2, 3, 4, 5...)', 
                    title: 'כל שנה (12 חודשים)' 
                },
                'variable_2_5_linked': { 
                    placeholder: 'שנים (2.5, 5, 7.5, 10, 12.5...)', 
                    title: 'כל 2.5 שנים (30 חודשים) - מספר החודשים חייב להתחלק ב-30' 
                },
            };
            
            if (periodRequirements[selectedType]) {
                yearsInput.placeholder = periodRequirements[selectedType].placeholder;
                yearsInput.style.borderColor = '#f59e0b';
                yearsInput.title = periodRequirements[selectedType].title;
            } else {
                yearsInput.placeholder = 'שנים';
                yearsInput.style.borderColor = '#e5e7eb';
                yearsInput.title = '';
            }
        }

        function submitOffer() {
            const bank = document.getElementById('bankSelect').value;
            const totalAmount = parseFloat(document.getElementById('totalAmount').value) || 0;
            
            if (!bank) {
                alert('אנא בחר בנק');
                return;
            }

            const trackElements = document.querySelectorAll('.track-card');
            const tracks = [];
            let hasValidTrack = false;
            let validationErrors = [];

            trackElements.forEach((trackEl, index) => {
                const type = trackEl.querySelector('.track-type').value;
                const amount = parseFloat(trackEl.querySelector('.track-amount').value) || 0;
                const rate = parseFloat(trackEl.querySelector('.track-rate').value) || 0;
                const years = parseInt(trackEl.querySelector('.track-years').value) || 20;

                if (amount > 0) {
                    // Validate track period based on type - check months, not years
                    let periodError = null;
                    const totalMonths = years * 12;
                    
                    if (type === 'variable_unlinked_18m') {
                        // 18 months
                        if (totalMonths % 18 !== 0) {
                            periodError = `מסלול "משתנה כל 18 חודשים" דורש תקופה שמספר החודשים שלה מתחלק ב-18 (למשל: 18 חודשים/1.5 שנים, 36 חודשים/3 שנים, 54 חודשים/4.5 שנים, 72 חודשים/6 שנים). התקופה שהוזנה: ${years} שנים = ${totalMonths} חודשים.`;
                        }
                    } else if (type === 'variable_unlinked_2y') {
                        // 24 months (2 years)
                        if (totalMonths % 24 !== 0) {
                            periodError = `מסלול "משתנה כל שנתיים" דורש תקופה שמספר החודשים שלה מתחלק ב-24 (למשל: 2, 4, 6, 8, 10 שנים). התקופה שהוזנה: ${years} שנים = ${totalMonths} חודשים.`;
                        }
                    } else if (type === 'variable_unlinked_3y' || type === 'variable_linked_3y') {
                        // 36 months (3 years)
                        if (totalMonths % 36 !== 0) {
                            periodError = `מסלול "משתנה כל 3 שנים" דורש תקופה שמספר החודשים שלה מתחלק ב-36 (למשל: 3, 6, 9, 12, 15 שנים). התקופה שהוזנה: ${years} שנים = ${totalMonths} חודשים.`;
                        }
                    } else if (type === 'variable_unlinked_5y' || type === 'variable_linked_5y') {
                        // 60 months (5 years)
                        if (totalMonths % 60 !== 0) {
                            periodError = `מסלול "משתנה כל 5 שנים" דורש תקופה שמספר החודשים שלה מתחלק ב-60 (למשל: 5, 10, 15, 20, 25, 30 שנים). התקופה שהוזנה: ${years} שנים = ${totalMonths} חודשים.`;
                        }
                    } else if (type === 'variable_unlinked_10y' || type === 'variable_linked_10y') {
                        // 120 months (10 years)
                        if (totalMonths % 120 !== 0) {
                            periodError = `מסלול "משתנה כל 10 שנים" דורש תקופה שמספר החודשים שלה מתחלק ב-120 (למשל: 10, 20, 30 שנים). התקופה שהוזנה: ${years} שנים = ${totalMonths} חודשים.`;
                        }
                    }
                    
                    if (periodError) {
                        validationErrors.push(`מסלול ${index + 1}: ${periodError}`);
                    }
                    
                    hasValidTrack = true;
                    const monthly = calculateMonthlyPayment(amount, rate, years);
                    const totalInterest = (monthly * years * 12) - amount;
                    
                    tracks.push({
                        type,
                        name: TRACK_TYPES[type]?.name || type,
                        amount,
                        interestRate: rate,
                        years,
                        monthlyPayment: Math.round(monthly),
                        totalInterest: Math.round(totalInterest)
                    });
                }
            });

            // Show validation errors
            if (validationErrors.length > 0) {
                alert('⚠️ שגיאות בתמהיל:\n\n' + validationErrors.join('\n\n'));
                return;
            }

            if (!hasValidTrack) {
                alert('אנא הזן לפחות מסלול אחד עם סכום');
                return;
            }

            const sumAmount = tracks.reduce((sum, t) => sum + t.amount, 0);
            
            // Validate that total amount matches sum of tracks (if total amount was entered)
            const errorDiv = document.getElementById('amountError');
            if (totalAmount > 0 && Math.abs(totalAmount - sumAmount) > 1) {
                const difference = sumAmount - totalAmount;
                const diffText = difference > 0 ? 
                    `יותר ב-₪${Math.abs(difference).toLocaleString('he-IL')}` : 
                    `פחות ב-₪${Math.abs(difference).toLocaleString('he-IL')}`;
                
                errorDiv.innerHTML = `
                    <strong>⚠️ אי-התאמה בסכומים!</strong><br><br>
                    סכום כולל שהוזן: ₪${totalAmount.toLocaleString('he-IL')}<br>
                    סכום המסלולים: ₪${sumAmount.toLocaleString('he-IL')}<br>
                    <strong>הפרש: ${diffText}</strong><br><br>
                    אנא תקן את הסכומים לפני המשך.
                `;
                errorDiv.style.display = 'block';
                
                // Scroll to error
                errorDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
                return;
            }
            
            // Clear error if exists
            errorDiv.style.display = 'none';
            const totalMonthlyPayment = tracks.reduce((sum, t) => sum + t.monthlyPayment, 0);
            const totalInterest = tracks.reduce((sum, t) => sum + t.totalInterest, 0);

            const offer = {
                id: editingOfferId || Date.now(), // Keep existing ID if editing
                bank,
                bankColor: BANKS[bank] || UNIFIED_GRADIENT,
                totalAmount: totalAmount || sumAmount,
                tracks,
                totalMonthlyPayment,
                totalInterest,
                totalCost: (totalAmount || sumAmount) + totalInterest,
                riskScore: calculateRiskScore(tracks)
            };

            if (editingOfferId) {
                // Update existing offer
                const index = offers.findIndex(o => o.id === editingOfferId);
                if (index !== -1) {
                    offers[index] = offer;
                }
                editingOfferId = null;
            } else {
                // Add new offer
                offers.push(offer);
            }

            updateUI();
            closeModal();
        }

        function deleteOffer(id) {
            offers = offers.filter(o => o.id !== id);
            updateUI();
        }

        function editOffer(id) {
            const offer = offers.find(o => o.id === id);
            if (!offer) return;
            
            editingOfferId = id;
            
            // Open modal in edit mode
            openModal(true);
            
            // Populate form with offer data
            document.getElementById('bankSelect').value = offer.bank;
            document.getElementById('totalAmount').value = offer.totalAmount;
            
            // Clear and populate tracks
            document.getElementById('tracksContainer').innerHTML = '';
            trackCount = 0;
            
            offer.tracks.forEach(track => {
                addTrack();
                const trackElement = document.querySelectorAll('.track-card')[trackCount - 1];
                trackElement.querySelector('.track-type').value = track.type;
                trackElement.querySelector('.track-amount').value = track.amount;
                trackElement.querySelector('.track-rate').value = track.interestRate;
                trackElement.querySelector('.track-years').value = track.years;
            });
        }

        function updateUI() {
            if (offers.length === 0) {
                document.getElementById('emptyState').style.display = 'block';
                document.getElementById('offersSection').style.display = 'none';
                return;
            }

            document.getElementById('emptyState').style.display = 'none';
            document.getElementById('offersSection').style.display = 'block';

            // Update offers title
            document.getElementById('offersTitle').textContent = `${offers.length} הצעות להשוואה`;

            // Update detail cards
            const detailCards = document.getElementById('detailCards');
            detailCards.innerHTML = '';

            offers.forEach(offer => {
                // Calculate index exposure
                let indexLinkedAmount = 0;
                
                offer.tracks.forEach(track => {
                    if (track.type === 'fixed_linked' || track.type.includes('linked')) {
                        indexLinkedAmount += track.amount;
                    }
                });
                
                const indexExposure = Math.round((indexLinkedAmount / offer.totalAmount) * 100);
                
                const cardHtml = `
                    <div class="detail-card">
                        <div class="detail-card-header" style="background: ${offer.bankColor};">
                            <div style="display: flex; justify-content: space-between; align-items: start;">
                                <div style="flex: 1;">
                                    <h4 class="detail-card-bank">${offer.bank}</h4>
                                    <p class="detail-card-amount">סכום: ${formatCurrency(offer.totalAmount)}</p>
                                    <div style="margin-top: 0.5rem; display: inline-flex; align-items: center; gap: 0.5rem; background: rgba(255,255,255,0.2); padding: 0.25rem 0.75rem; border-radius: 9999px; font-size: 0.875rem;">
                                        <span>ציון סיכון:</span>
                                        <span style="font-weight: 700;">${offer.riskScore}</span>
                                        <div style="width: 40px; height: 6px; background: rgba(255,255,255,0.3); border-radius: 9999px; overflow: hidden;">
                                            <div style="width: ${offer.riskScore}%; height: 100%; background: ${offer.riskScore < 40 ? '#22c55e' : offer.riskScore < 60 ? '#eab308' : '#ef4444'}; border-radius: 9999px;"></div>
                                        </div>
                                    </div>
                                </div>
                                <button onclick="editOffer(${offer.id})" style="background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3); color: white; padding: 0.5rem 1rem; border-radius: 0.5rem; cursor: pointer; font-size: 0.875rem; font-weight: 500;">
                                    ✏️ ערוך
                                </button>
                            </div>
                        </div>
                        <div class="detail-card-body">
                            <!-- Financial Summary -->
                            <div style="background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%); border-radius: 0.75rem; padding: 1.25rem; margin-bottom: 1rem; border: 1px solid #bae6fd;">
                                <h4 style="font-weight: 600; margin-bottom: 1rem; color: #0369a1; font-size: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                                    <span>💰</span>
                                    <span>סיכום כלכלי</span>
                                </h4>
                                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem;">
                                    <div style="background: white; padding: 0.875rem; border-radius: 0.5rem;">
                                        <span style="color: #64748b; font-size: 0.8125rem;">החזר חודשי</span>
                                        <div style="font-weight: 700; font-size: 1.25rem; color: #0f172a; margin-top: 0.25rem;">${formatCurrency(offer.totalMonthlyPayment)}</div>
                                    </div>
                                    <div style="background: white; padding: 0.875rem; border-radius: 0.5rem;">
                                        <span style="color: #64748b; font-size: 0.8125rem;">עלות כוללת</span>
                                        <div style="font-weight: 700; font-size: 1.25rem; color: #0f172a; margin-top: 0.25rem;">${formatCurrency(offer.totalCost)}</div>
                                    </div>
                                    <div style="background: #fef2f2; padding: 0.875rem; border-radius: 0.5rem; grid-column: 1 / -1; border: 1px solid #fecaca;">
                                        <div style="display: flex; justify-content: space-between; align-items: center;">
                                            <div>
                                                <span style="color: #991b1b; font-size: 0.8125rem; font-weight: 500;">סה"כ ריבית (מעל הקרן)</span>
                                                <div style="font-weight: 700; font-size: 1.25rem; color: #dc2626; margin-top: 0.25rem;">${formatCurrency(offer.totalInterest)}</div>
                                            </div>
                                            <div style="text-align: left;">
                                                <div style="font-size: 2rem; font-weight: 700; color: #dc2626;">${Math.round((offer.totalInterest / offer.totalAmount) * 100)}%</div>
                                                <div style="font-size: 0.75rem; color: #991b1b;">מהקרן</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Index Exposure -->
                            <div style="background: ${indexExposure > 50 ? '#fef2f2' : '#f0fdf4'}; border-radius: 0.75rem; padding: 1rem; margin-bottom: 1rem; border: 1px solid ${indexExposure > 50 ? '#fecaca' : '#bbf7d0'};">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <div>
                                        <div style="font-size: 0.875rem; color: ${indexExposure > 50 ? '#991b1b' : '#15803d'}; margin-bottom: 0.25rem; font-weight: 500;">📈 חשיפה למדד</div>
                                        <div style="font-size: 0.75rem; color: ${indexExposure > 50 ? '#b91c1c' : '#166534'}; margin-top: 0.25rem;">${indexExposure > 50 ? '⚠️ חשיפה גבוהה - הקרן תגדל עם המדד' : '✅ חשיפה סבירה'}</div>
                                    </div>
                                    <div style="text-align: left;">
                                        <div style="font-weight: 700; font-size: 2rem; color: ${indexExposure > 50 ? '#dc2626' : '#22c55e'};">${indexExposure}%</div>
                                        <div style="font-size: 0.75rem; color: ${indexExposure > 50 ? '#991b1b' : '#15803d'};">${formatCurrency(indexLinkedAmount)}</div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Track Breakdown -->
                            <h4 style="font-weight: 600; margin-bottom: 0.75rem; color: #0f172a; font-size: 0.95rem;">📊 פירוט תמהיל (${offer.tracks.length} מסלולים)</h4>
                            ${offer.tracks.map(track => {
                                const trackPercent = Math.round((track.amount / offer.totalAmount) * 100);
                                return `
                                    <div class="track-detail">
                                        <div class="track-detail-header">
                                            <span class="track-name">
                                                <strong>${trackPercent}%</strong> - ${track.name}
                                                <span class="tooltip-icon">
                                                    ?
                                                    <span class="tooltip-text">${TRACK_TYPES[track.type]?.description || 'מסלול משכנתא - פנה ליועץ משכנתאות למידע מפורט על מסלול זה.'}</span>
                                                </span>
                                            </span>
                                        </div>
                                        <!-- Progress bar -->
                                        <div style="width: 100%; height: 8px; background: #e5e7eb; border-radius: 9999px; margin: 0.5rem 0; overflow: hidden;">
                                            <div style="width: ${trackPercent}%; height: 100%; background: linear-gradient(90deg, #3b82f6, #8b5cf6); border-radius: 9999px;"></div>
                                        </div>
                                        <div class="track-stats">
                                            <div>
                                                <span class="track-stat-label">סכום: </span>
                                                <span class="track-stat-value">${formatCurrency(track.amount)}</span>
                                            </div>
                                            <div>
                                                <span class="track-stat-label">ריבית: </span>
                                                <span class="track-stat-value">${track.interestRate}%${track.spread !== null && track.spread !== undefined ? 
                                                    ` (${track.type === 'prime' ? 'פריים' : 'עוגן'} ${track.spread > 0 ? '+' : ''}${track.spread}%)` : ''}</span>
                                            </div>
                                            <div>
                                                <span class="track-stat-label">תקופה: </span>
                                                <span class="track-stat-value">${track.years} שנים</span>
                                            </div>
                                            <div>
                                                <span class="track-stat-label">החזר: </span>
                                                <span class="track-stat-value">${formatCurrency(track.monthlyPayment)}</span>
                                            </div>
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                            
                            <div style="display: flex; gap: 0.75rem; margin-top: 1.5rem;">
                                <button onclick="showAmortizationSchedule(${offer.id})" style="flex: 1; padding: 0.75rem; background: #10b981; color: white; border: none; border-radius: 0.75rem; font-weight: 600; cursor: pointer; transition: all 0.3s; display: flex; align-items: center; justify-content: center; gap: 0.5rem;">
                                    <span style="font-size: 1.25rem;">📋</span>
                                    <span>לוח סילוקין</span>
                                </button>
                                <button onclick="deleteOffer(${offer.id})" style="padding: 0.75rem 1rem; background: #ef4444; color: white; border: none; border-radius: 0.75rem; font-weight: 600; cursor: pointer; transition: all 0.3s;">
                                    🗑️
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                detailCards.insertAdjacentHTML('beforeend', cardHtml);
            });
        }

        function saveComparison() {
            if (offers.length === 0) return;
            
            const comparison = {
                id: Date.now(),
                savedAt: new Date().toISOString(),
                offers: offers
            };
            
            savedComparisons.unshift(comparison);
            localStorage.setItem('mortgage_comparisons', JSON.stringify(savedComparisons));
            document.getElementById('savedCount').textContent = savedComparisons.length;
            alert('ההשוואה נשמרה בהצלחה!');
        }

        function renderSavedComparisons() {
            const savedList = document.getElementById('savedList');
            
            if (savedComparisons.length === 0) {
                savedList.innerHTML = `
                    <div class="card empty-state">
                        <div class="empty-icon">📋</div>
                        <p class="empty-text">אין השוואות שמורות</p>
                        <button class="btn btn-primary" style="margin-top: 1rem;" onclick="setView('comparison')">
                            צור השוואה חדשה
                        </button>
                    </div>
                `;
                return;
            }

            savedList.innerHTML = savedComparisons.map(comp => `
                <div class="card" style="padding: 1.5rem;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div style="font-size: 1.125rem; font-weight: 600; color: var(--text-primary);">
                                ${comp.offers.length} הצעות
                            </div>
                            <div class="text-sm" style="color: var(--text-secondary); margin-top: 0.25rem;">
                                ${new Date(comp.savedAt).toLocaleDateString('he-IL')} • 
                                ${comp.offers.map(o => o.bank).join(', ')}
                            </div>
                        </div>
                        <div style="display: flex; gap: 0.5rem;">
                            <button class="btn btn-secondary" onclick="loadComparison(${comp.id})">
                                טען
                            </button>
                            <button class="btn btn-danger" onclick="deleteComparison(${comp.id})">
                                מחק
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function loadComparison(id) {
            const comparison = savedComparisons.find(c => c.id === id);
            if (comparison) {
                offers = comparison.offers;
                setView('comparison');
                updateUI();
            }
        }

        function deleteComparison(id) {
            savedComparisons = savedComparisons.filter(c => c.id !== id);
            localStorage.setItem('mortgage_comparisons', JSON.stringify(savedComparisons));
            document.getElementById('savedCount').textContent = savedComparisons.length;
            renderSavedComparisons();
        }

        // Initialize
        loadSavedComparisons();
        updateUI();
        
        // Amortization Schedule Function
        function showAmortizationSchedule(offerId) {
            const offer = offers.find(o => o.id === offerId);
            if (!offer) return;
            
            document.getElementById('scheduleBank').textContent = offer.bank;
            document.getElementById('scheduleModal').style.display = 'block';
            document.body.style.overflow = 'hidden';
            
            renderAmortizationSchedule(offer);
        }
        
        function closeScheduleModal() {
            document.getElementById('scheduleModal').style.display = 'none';
            document.body.style.overflow = 'auto';
        }
        
        function renderAmortizationSchedule(offer) {
            const content = document.getElementById('scheduleContent');
            let html = '';
            
            offer.tracks.forEach((track, trackIndex) => {
                html += `
                    <div style="margin-bottom: 2rem;">
                        <h3 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 1rem; color: var(--text-primary);">${track.name} - ${formatCurrency(track.amount)}</h3>
                        <div style="overflow-x: auto; border-radius: 0.75rem; border: 1px solid var(--border-color);">
                            <table style="width: 100%; border-collapse: collapse;">
                                <thead style="background: var(--bg-primary);">
                                    <tr>
                                        <th style="padding: 0.75rem; text-align: center; border-bottom: 1px solid var(--border-color); font-weight: 600;">חודש</th>
                                        <th style="padding: 0.75rem; text-align: center; border-bottom: 1px solid var(--border-color); font-weight: 600;">תשלום</th>
                                        <th style="padding: 0.75rem; text-align: center; border-bottom: 1px solid var(--border-color); font-weight: 600;">קרן</th>
                                        <th style="padding: 0.75rem; text-align: center; border-bottom: 1px solid var(--border-color); font-weight: 600;">ריבית</th>
                                        <th style="padding: 0.75rem; text-align: center; border-bottom: 1px solid var(--border-color); font-weight: 600;">יתרה</th>
                                    </tr>
                                </thead>
                                <tbody>
                `;
                
                let balance = track.amount;
                const monthlyRate = track.interestRate / 100 / 12;
                const numPayments = track.years * 12;
                const monthlyPayment = track.monthlyPayment;
                
                // Show first 12 months, then yearly summary
                for (let month = 1; month <= numPayments; month++) {
                    const interestPayment = balance * monthlyRate;
                    const principalPayment = monthlyPayment - interestPayment;
                    balance = balance - principalPayment;
                    
                    if (month <= 12 || month % 12 === 0) {
                        html += `
                            <tr style="border-bottom: 1px solid var(--border-color);">
                                <td style="padding: 0.75rem; text-align: center;">${month}</td>
                                <td style="padding: 0.75rem; text-align: center; font-weight: 600;">${formatCurrency(monthlyPayment)}</td>
                                <td style="padding: 0.75rem; text-align: center; color: #3b82f6;">${formatCurrency(principalPayment)}</td>
                                <td style="padding: 0.75rem; text-align: center; color: #ef4444;">${formatCurrency(interestPayment)}</td>
                                <td style="padding: 0.75rem; text-align: center; font-weight: 600;">${formatCurrency(Math.max(0, balance))}</td>
                            </tr>
                        `;
                    }
                }
                
                html += `
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
            });
            
            content.innerHTML = html;
        }
    </script>
    
    <!-- Amortization Schedule Modal -->
    <div id="scheduleModal" onclick="closeScheduleModal()" style="display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.7); z-index: 9999; padding: 1rem; overflow-y: auto;">
        <div onclick="event.stopPropagation()" style="max-width: 1000px; margin: 2rem auto; background: var(--bg-card); border-radius: 1.5rem; box-shadow: 0 20px 60px rgba(0,0,0,0.3);">
            <div style="padding: 2rem; border-bottom: 1px solid var(--border-color);">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <h2 style="font-size: 1.75rem; font-weight: 700; color: var(--text-primary);">📋 לוח סילוקין</h2>
                        <div id="scheduleBank" style="margin-top: 0.5rem; font-size: 1.125rem; color: var(--text-secondary);"></div>
                    </div>
                    <button onclick="closeScheduleModal()" style="width: 40px; height: 40px; border-radius: 50%; border: none; background: var(--bg-primary); color: var(--text-primary); cursor: pointer; font-size: 1.5rem; display: flex; align-items: center; justify-content: center; transition: all 0.3s;">
                        ✕
                    </button>
                </div>
            </div>
            
            <div id="scheduleContent" style="padding: 2rem;">
            </div>
        </div>
    </div>
</body>
</html>
