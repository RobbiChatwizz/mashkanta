<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>××©×•×•×” ××©×›× ×ª× - Mortgage Comparison Tool</title>
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script>
        // Configure PDF.js
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
    </script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Heebo', sans-serif;
        }
        
        :root {
            /* Light mode colors */
            --bg-primary: linear-gradient(to bottom left, #dbeafe, #e2e8f0, #d1fae5);
            --bg-card: #ffffff;
            --bg-card-hover: #f1f5f9;
            --text-primary: #0f172a;
            --text-secondary: #475569;
            --text-muted: #64748b;
            --border-color: #cbd5e1;
            --border-color-light: #bfdbfe;
            --shadow: rgba(0, 0, 0, 0.1);
            --shadow-hover: rgba(0, 0, 0, 0.15);
            --header-bg: rgba(255, 255, 255, 0.9);
        }
        
        [data-theme="dark"] {
            /* Dark mode colors */
            --bg-primary: linear-gradient(to bottom left, #1e293b, #0f172a, #1e3a3a);
            --bg-card: #1e293b;
            --bg-card-hover: #334155;
            --text-primary: #f1f5f9;
            --text-secondary: #cbd5e1;
            --text-muted: #94a3b8;
            --border-color: #334155;
            --border-color-light: #475569;
            --shadow: rgba(0, 0, 0, 0.3);
            --shadow-hover: rgba(0, 0, 0, 0.5);
            --header-bg: rgba(30, 41, 59, 0.8);
        }
        
        /* Dark mode overrides */
        [data-theme="dark"] .card,
        [data-theme="dark"] .modal-content,
        [data-theme="dark"] .best-offer {
            background: var(--bg-card);
            color: var(--text-primary);
        }
        
        [data-theme="dark"] .comparison-table,
        [data-theme="dark"] table {
            background: var(--bg-card);
        }
        
        [data-theme="dark"] .comparison-table th,
        [data-theme="dark"] table thead {
            background: var(--bg-card-hover);
            color: var(--text-secondary);
            border-color: var(--border-color);
        }
        
        [data-theme="dark"] .comparison-table td,
        [data-theme="dark"] table td {
            color: var(--text-primary);
            border-color: var(--border-color);
        }
        
        [data-theme="dark"] .comparison-table tr:hover,
        [data-theme="dark"] table tr:hover {
            background: var(--bg-card-hover);
        }
        
        [data-theme="dark"] .form-input,
        [data-theme="dark"] .form-select,
        [data-theme="dark"] .track-input {
            background: #0f172a;
            border-color: var(--border-color);
            color: var(--text-primary);
        }
        
        [data-theme="dark"] .form-input:focus,
        [data-theme="dark"] .form-select:focus,
        [data-theme="dark"] .track-input:focus {
            border-color: #3b82f6;
            background: #1e293b;
        }
        
        [data-theme="dark"] .form-label {
            color: var(--text-secondary);
        }
        
        [data-theme="dark"] .track-card {
            background: #0f172a;
            border-color: var(--border-color);
        }
        
        [data-theme="dark"] .hero h2,
        [data-theme="dark"] .modal-title {
            color: var(--text-primary);
        }
        
        [data-theme="dark"] .hero p {
            color: var(--text-secondary);
        }
        
        [data-theme="dark"] .upload-box {
            border-color: #475569;
            background: #0f172a;
        }
        
        [data-theme="dark"] .upload-box:hover {
            border-color: #3b82f6;
            background: #1e293b;
        }
        
        [data-theme="dark"] .divider {
            color: var(--text-muted);
        }
        
        [data-theme="dark"] .btn-secondary {
            background: #334155;
            color: var(--text-primary);
            border-color: var(--border-color);
        }
        
        [data-theme="dark"] .btn-secondary:hover {
            background: #475569;
        }
        
        [data-theme="dark"] .close-btn {
            color: var(--text-secondary);
        }
        
        [data-theme="dark"] .close-btn:hover {
            background: var(--bg-card-hover);
            color: var(--text-primary);
        }
        
        [data-theme="dark"] .text-sm,
        [data-theme="dark"] .text-xs {
            color: var(--text-secondary);
        }
        
        [data-theme="dark"] select option {
            background: #1e293b;
            color: var(--text-primary);
        }
        
        [data-theme="dark"] .tooltip-text {
            background: #0f172a;
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }
        
        [data-theme="dark"] .tooltip-text::after {
            border-top-color: #0f172a;
        }
        
        [data-theme="dark"] .empty-state {
            color: var(--text-secondary);
        }
        
        [data-theme="dark"] .footer {
            background: var(--bg-card);
            border-color: var(--border-color);
            color: var(--text-secondary);
        }
        
        /* Bank detail cards in dark mode - keep bank colors but adjust */
        [data-theme="dark"] .detail-card {
            background: var(--bg-card);
            border-color: var(--border-color);
        }
        
        [data-theme="dark"] .detail-card-header {
            opacity: 0.95;
        }
        
        [data-theme="dark"] .detail-track {
            background: #0f172a;
        }
        
        [data-theme="dark"] .detail-track-name {
            color: var(--text-primary);
        }
        
        [data-theme="dark"] .detail-track-info {
            color: var(--text-secondary);
        }
        
        /* Best offer card - keep the green gradient but adjust for dark mode */
        [data-theme="dark"] .best-offer {
            opacity: 0.95;
        }
        
        /* Error messages */
        [data-theme="dark"] #amountError {
            background: #991b1b;
            border-color: #dc2626;
            color: #fecaca;
        }
        
        /* Text utilities that respect dark mode */
        p, span, div {
            color: inherit;
        }
        
        .text-primary {
            color: var(--text-primary);
        }
        
        .text-secondary {
            color: var(--text-secondary);
        }
        
        .text-muted {
            color: var(--text-muted);
        }
        
        .fw-500 {
            font-weight: 500;
        }
        
        .fw-600 {
            font-weight: 600;
        }
        
        .fw-700 {
            font-weight: 700;
        }
        
        /* Risk colors - adjust for dark mode */
        .risk-low {
            background: #f0fdf4;
            color: #15803d;
        }
        
        [data-theme="dark"] .risk-low {
            background: #14532d;
            color: #86efac;
        }
        
        .risk-medium {
            background: #fef3c7;
            color: #a16207;
        }
        
        [data-theme="dark"] .risk-medium {
            background: #713f12;
            color: #fde047;
        }
        
        .risk-high {
            background: #fee2e2;
            color: #dc2626;
        }
        
        [data-theme="dark"] .risk-high {
            background: #7f1d1d;
            color: #fca5a5;
        }
        
        /* Risk breakdown tooltip */
        
        body {
            background: var(--bg-primary);
            min-height: 100vh;
            color: var(--text-primary);
            transition: background 0.3s, color 0.3s;
        }
        
        /* Header */
        .header {
            background: var(--header-bg);
            backdrop-filter: blur(4px);
            border-bottom: 1px solid var(--border-color-light);
            position: sticky;
            top: 0;
            z-index: 40;
            transition: background 0.3s, border-color 0.3s;
        }
        
        .header-content {
            max-width: 72rem;
            margin: 0 auto;
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .header-logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .logo-icon {
            width: 3rem;
            height: 3rem;
            border-radius: 0.75rem;
            background: linear-gradient(to bottom right, #3b82f6, #2563eb);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 10px 15px -3px rgba(147, 197, 253, 0.4);
        }
        
        .logo-icon span {
            font-size: 1.5rem;
        }
        
        .logo-text h1 {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
        }
        
        .logo-text p {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }
        
        .header-nav {
            display: flex;
            gap: 0.5rem;
        }
        
        .nav-btn {
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: 500;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .nav-btn.active {
            background: #3b82f6;
            color: white;
        }
        
        .nav-btn:not(.active) {
            background: var(--bg-card-hover);
            color: var(--text-secondary);
        }
        
        .nav-btn:not(.active):hover {
            background: #e5e7eb;
        }
        
        /* Main Content */
        .main-content {
            max-width: 72rem;
            margin: 0 auto;
            padding: 2rem 1rem;
        }
        
        .hero {
            text-align: center;
            margin-bottom: 3rem;
            padding: 2rem 1rem;
        }
        
        .hero h2 {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 1rem;
            line-height: 1.2;
        }
        
        @media (max-width: 768px) {
            .hero h2 {
                font-size: 2rem;
            }
        }
        
        .hero p {
            color: var(--text-secondary);
            max-width: 42rem;
            margin: 0 auto;
            line-height: 1.7;
        }
        
        /* Card */
        .card {
            background: white;
            border-radius: 1rem;
            padding: 2rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.15);
            border: 1px solid #e5e7eb;
        }
        
        /* Upload Box */
        .upload-box {
            border: 2px dashed #93c5fd;
            border-radius: 1rem;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.05) 0%, rgba(147, 197, 253, 0.05) 100%);
        }
        
        .upload-box:hover {
            border-color: #3b82f6;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(147, 197, 253, 0.1) 100%);
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(59, 130, 246, 0.15);
        }
        
        .upload-content {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 2rem;
            align-items: center;
            width: 100%;
            max-width: 900px;
            margin: 0 auto;
        }
        
        @media (max-width: 768px) {
            .upload-content {
                grid-template-columns: 1fr;
                gap: 1.5rem;
            }
        }
        
        .divider {
            color: #9ca3af;
            font-weight: 500;
        }
        
        /* Buttons */
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 0.75rem;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1rem;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(59, 130, 246, 0.4);
        }
        
        .btn-secondary {
            background: var(--bg-card-hover);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }
        
        .btn-secondary:hover {
            background: var(--border-color);
            transform: translateY(-1px);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(34, 197, 94, 0.3);
        }
        
        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(34, 197, 94, 0.4);
        }
        
        .btn-danger {
            background: transparent;
            color: #ef4444;
            font-size: 1.25rem;
            padding: 0.25rem 0.5rem;
        }
        
        .btn-danger:hover {
            color: #dc2626;
        }
        
        .btn-edit {
            background: transparent;
            color: #3b82f6;
            font-size: 1.25rem;
            padding: 0.25rem 0.5rem;
            border: none;
            cursor: pointer;
        }
        
        .btn-edit:hover {
            color: #2563eb;
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 50;
            padding: 1rem;
            overflow-y: auto;
        }
        
        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: white;
            border-radius: 1rem;
            padding: 1.5rem;
            max-width: 42rem;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        
        .modal-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--text-primary);
        }
        
        .close-btn {
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 50%;
            border: none;
            background: transparent;
            cursor: pointer;
            font-size: 1.5rem;
        }
        
        .close-btn:hover {
            background: var(--bg-card-hover);
        }
        
        /* Form */
        .form-group {
            margin-bottom: 1rem;
        }
        
        .form-label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }
        
        .form-input, .form-select {
            width: 100%;
            padding: 0.75rem 1rem;
            border-radius: 0.75rem;
            border: 1px solid #e5e7eb;
            outline: none;
            font-size: 1rem;
        }
        
        .form-input:focus, .form-select:focus {
            border-color: #60a5fa;
            box-shadow: 0 0 0 3px rgba(147, 197, 253, 0.1);
        }
        
        /* Track Section */
        .track-section {
            border-top: 1px solid #e5e7eb;
            padding-top: 1rem;
        }
        
        .track-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
        }
        
        .track-card {
            background: var(--bg-card-hover);
            border-radius: 0.75rem;
            padding: 1rem;
            margin-bottom: 0.75rem;
        }
        
        .track-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
        }
        
        .track-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.75rem;
        }
        
        .track-input {
            padding: 0.5rem 0.75rem;
            border-radius: 0.5rem;
            border: 1px solid #e5e7eb;
            font-size: 0.875rem;
        }
        
        /* Best Offer Card */
        .best-offer {
            background: linear-gradient(to right, #22c55e, #10b981);
            color: white;
        }
        
        .best-offer-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 0.5rem;
        }
        
        .best-offer-icon {
            font-size: 1.875rem;
        }
        
        .best-offer-subtitle {
            font-size: 0.875rem;
            opacity: 0.9;
        }
        
        .best-offer-title {
            font-size: 1.5rem;
            font-weight: 700;
        }
        
        .best-offer-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .best-offer-stat-label {
            font-size: 0.875rem;
            opacity: 0.9;
        }
        
        .best-offer-stat-value {
            font-size: 1.25rem;
            font-weight: 700;
            margin-top: 0.25rem;
        }
        
        /* Table */
        .table-wrapper {
            overflow-x: auto;
            border-radius: 1rem;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        thead {
            background: var(--bg-card-hover);
        }
        
        th {
            padding: 1rem 1.5rem;
            text-align: right;
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--text-secondary);
            border-bottom: 1px solid #e5e7eb;
        }
        
        td {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid #f3f4f6;
        }
        
        tr.best-row {
            background: #f0fdf4;
        }
        
        .bank-cell {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .bank-color {
            width: 4px;
            height: 2.5rem;
            border-radius: 2px;
            box-shadow: 0 0 8px rgba(0,0,0,0.15);
        }
        
        .bank-name {
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .bank-tracks {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }
        
        .badge {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            background: #22c55e;
            color: white;
            font-size: 0.75rem;
            border-radius: 9999px;
            margin-right: 0.5rem;
        }
        
        /* Risk Indicator */
        .risk-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .risk-bar {
            width: 4rem;
            height: 0.5rem;
            background: #e5e7eb;
            border-radius: 9999px;
            overflow: hidden;
        }
        
        .risk-bar-fill {
            height: 100%;
            border-radius: 9999px;
        }
        
        .risk-low { background: #22c55e; }
        .risk-medium { background: #eab308; }
        .risk-high { background: #ef4444; }
        
        /* Detail Cards */
        .detail-cards {
            display: grid;
            gap: 1.5rem;
            margin-top: 1.5rem;
        }
        
        @media (min-width: 768px) {
            .detail-cards {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        .detail-card {
            background: white;
            border-radius: 1rem;
            overflow: hidden;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.15);
            border: 1px solid #e5e7eb;
            transition: all 0.3s ease;
        }
        
        .detail-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.15);
        }
        
        .detail-card-header {
            padding: 1.5rem;
            color: white;
        }
        
        .detail-card-bank {
            font-size: 1.25rem;
            font-weight: 700;
            text-shadow: 0 1px 2px rgba(0,0,0,0.2);
        }
        
        .detail-card-amount {
            font-size: 0.875rem;
            opacity: 0.95;
            margin-top: 0.25rem;
        }
        
        .detail-card-body {
            padding: 1rem;
        }
        
        .track-detail {
            background: var(--bg-card-hover);
            border-radius: 0.5rem;
            padding: 0.75rem;
            margin-bottom: 0.75rem;
        }
        
        .track-detail-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }
        
        .track-name {
            font-weight: 500;
            color: var(--text-primary);
        }
        
        .risk-badge {
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 9999px;
        }
        
        .risk-badge-low {
            background: #dcfce7;
            color: #15803d;
        }
        
        [data-theme="dark"] .risk-badge-low {
            background: #14532d;
            color: #86efac;
        }
        
        .risk-badge-medium {
            background: #fef3c7;
            color: #a16207;
        }
        
        [data-theme="dark"] .risk-badge-medium {
            background: #713f12;
            color: #fde047;
        }
        
        .risk-badge-high {
            background: #fee2e2;
            color: #dc2626;
        }
        
        [data-theme="dark"] .risk-badge-high {
            background: #7f1d1d;
            color: #fca5a5;
        }
        
        .track-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.5rem;
            font-size: 0.875rem;
        }
        
        .track-stat-label {
            color: var(--text-secondary);
        }
        
        .track-stat-value {
            font-weight: 500;
        }
        
        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 3rem 1rem;
        }
        
        .empty-icon {
            font-size: 3.75rem;
            margin-bottom: 1rem;
        }
        
        .empty-text {
            color: var(--text-secondary);
            font-size: 1.125rem;
        }
        
        /* Section Header */
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .section-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--text-primary);
        }
        
        /* SEO Content */
        .seo-content {
            line-height: 1.6;
        }
        
        .seo-content h3 {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 1rem;
        }
        
        .seo-content h4 {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--text-primary);
            margin: 1rem 0 0.5rem;
        }
        
        .seo-content p {
            color: var(--text-secondary);
            margin-bottom: 1rem;
        }
        
        .seo-content ul {
            list-style-position: inside;
            color: var(--text-secondary);
        }
        
        .seo-content li {
            margin-bottom: 0.5rem;
        }
        
        .seo-content strong {
            font-weight: 600;
            color: var(--text-primary);
        }
        
        /* Footer */
        .footer {
            background: white;
            border-top: 1px solid #e5e7eb;
            margin-top: 3rem;
        }
        
        .footer-content {
            max-width: 72rem;
            margin: 0 auto;
            padding: 2rem 1rem;
            text-align: center;
            color: var(--text-secondary);
            font-size: 0.875rem;
        }
        
        .footer-content p {
            margin-bottom: 0.5rem;
        }
        
        /* Utilities */
        .text-sm { font-size: 0.875rem; }
        .text-xs { font-size: 0.75rem; }
        .text-red { color: #dc2626; }
        .fw-500 { font-weight: 500; }
        .fw-600 { font-weight: 600; }
        .fw-700 { font-weight: 700; }
        
        .add-track-btn {
            background: none;
            border: none;
            color: #2563eb;
            font-size: 0.875rem;
            cursor: pointer;
        }
        
        .add-track-btn:hover {
            color: #1d4ed8;
        }
        
        .remove-track-btn {
            background: none;
            border: none;
            color: #ef4444;
            font-size: 0.875rem;
            cursor: pointer;
        }
        
        .remove-track-btn:hover {
            color: #dc2626;
        }
        
        /* Tooltip */
        .tooltip-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 16px;
            height: 16px;
            background: #3b82f6;
            color: white;
            border-radius: 50%;
            font-size: 11px;
            font-weight: 700;
            cursor: help;
            margin-right: 4px;
            position: relative;
        }
        
        .tooltip-text {
            visibility: hidden;
            opacity: 0;
            position: fixed;
            top: 40%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #1f2937;
            color: white;
            padding: 1.5rem;
            border-radius: 0.75rem;
            font-size: 0.875rem;
            font-weight: 400;
            width: 280px;
            max-width: 90vw;
            z-index: 10000;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
            transition: opacity 0.2s, visibility 0.2s;
            text-align: right;
            line-height: 1.7;
            white-space: normal;
            word-wrap: break-word;
            pointer-events: auto;
            box-sizing: border-box;
        }
        
        .tooltip-icon:hover .tooltip-text,
        .tooltip-text:hover {
            visibility: visible;
            opacity: 1;
        }
        
        @media (max-width: 500px) {
            .tooltip-text {
                width: 240px;
                right: -20px;
            }
        }
        
        .tooltip-text::after {
            content: '';
            position: absolute;
            bottom: -8px;
            right: 20px;
            border: 8px solid transparent;
            border-top: 8px solid #1f2937;
        }
        
        .tooltip-icon:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .fade-in-up {
            animation: fadeInUp 0.6s ease-out;
        }
    </style>
    <script src="common.js"></script>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="header-logo">
                <div class="logo-icon">
                    <span>ğŸ </span>
                </div>
                <div class="logo-text">
                    <h1>××©×•×•×” ××©×›× ×ª×</h1>
                    <p>×”×©×•×•××ª ×”×¦×¢×•×ª ××©×›× ×ª× ×—×›××”</p>
                </div>
            </div>
            <div class="header-nav">
                <button class="nav-btn active" id="navComparison" onclick="setView('comparison')">
                    ×”×©×•×•××” ×—×“×©×”
                </button>
                <button class="nav-btn" id="navSaved" onclick="setView('saved')">
                    ×”×©×•×•××•×ª ×©××•×¨×•×ª (<span id="savedCount">0</span>)
                </button>
                <button class="nav-btn" id="navGuide" onclick="setView('guide')">
                    ğŸ“š ××“×¨×™×š ××©×›× ×ª××•×ª
                </button>
                <button id="themeToggle" onclick="toggleTheme()" style="background: white; border: 1px solid #e5e7eb; border-radius: 0.5rem; padding: 0.5rem 1rem; cursor: pointer; font-size: 1.25rem; transition: all 0.3s; margin-right: 0.5rem;">
                    <span id="themeIcon">ğŸŒ™</span>
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Comparison View -->
        <div id="comparisonView">
            <!-- Hero -->
            <div class="hero">
                <h2>×”×©×•×•×” ×”×¦×¢×•×ª ××©×›× ×ª× ×‘×§×œ×™×§ ××—×“</h2>
                <p style="font-size: 1.125rem; max-width: 600px; margin: 0.75rem auto 0;">
                    ×”×¢×œ×” ××ª ×”××™×©×•×¨×™× ×©×§×™×‘×œ×ª ××”×‘× ×§×™× - × ×‘×“×•×§ ×¢×‘×•×¨×š ××™×–×• ×”×¦×¢×” ×”×›×™ ××©×ª×œ××ª
                </p>
                <div style="display: flex; gap: 0.75rem; justify-content: center; margin-top: 1.5rem; flex-wrap: wrap;">
                    <span style="display: inline-flex; align-items: center; gap: 0.5rem; padding: 0.5rem 1rem; background: rgba(34, 197, 94, 0.1); border-radius: 9999px; font-size: 0.875rem; color: #15803d; font-weight: 500;">
                        <span style="font-size: 1.25rem;">âœ“</span> ×—×™× × ×œ×—×œ×•×˜×™×Ÿ
                    </span>
                    <span style="display: inline-flex; align-items: center; gap: 0.5rem; padding: 0.5rem 1rem; background: rgba(59, 130, 246, 0.1); border-radius: 9999px; font-size: 0.875rem; color: #1e40af; font-weight: 500;">
                        <span style="font-size: 1.25rem;">ğŸ”’</span> ×××•×‘×˜×— ×•×¤×¨×˜×™
                    </span>
                    <span style="display: inline-flex; align-items: center; gap: 0.5rem; padding: 0.5rem 1rem; background: rgba(234, 179, 8, 0.1); border-radius: 9999px; font-size: 0.875rem; color: #a16207; font-weight: 500;">
                        <span style="font-size: 1.25rem;">âš¡</span> ×ª×•×¦××•×ª ××™×™×“×™×•×ª
                    </span>
                </div>
            </div>

            <!-- Upload Section -->
            <div class="card" style="max-width: 800px; margin: 0 auto 1.5rem;">
                <div style="text-align: center; margin-bottom: 2rem;">
                    <h3 style="font-size: 1.5rem; font-weight: 700; color: var(--text-primary); margin-bottom: 0.5rem;">×”×¢×œ×” ××™×©×•×¨×™× ×¢×§×¨×•× ×™×™×</h3>
                    <p style="color: var(--text-secondary); font-size: 1rem;">×§×‘×¦×™ PDF ××”×‘× ×§×™× ×©×œ×š</p>
                </div>
                
                <label for="pdfUpload" style="cursor: pointer; width: 100%; display: block;">
                    <input type="file" id="pdfUpload" accept=".pdf" multiple style="display: none;" onchange="handleFileUpload(event)">
                    <div class="upload-box" style="border-width: 3px; padding: 3rem 2rem;">
                        <div style="font-size: 4rem; margin-bottom: 1rem;">ğŸ“„</div>
                        <p style="font-weight: 600; font-size: 1.25rem; color: var(--text-primary); margin-bottom: 0.5rem;">×’×¨×•×¨ ×§×‘×¦×™× ×œ×›××Ÿ ××• ×œ×—×¥ ×œ×”×¢×œ××”</p>
                        <p class="text-sm" style="color: var(--text-secondary); margin-top: 0.5rem;">×ª×•××š ×‘××¡×¤×¨ ×§×‘×¦×™× ×‘×•-×–×× ×™×ª</p>
                        <div style="margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid var(--border-color);">
                            <p style="font-size: 0.875rem; color: var(--text-muted); margin-bottom: 0.75rem;">ğŸ’¡ <strong>×˜×™×¤:</strong> ××¤×©×¨ ×œ×”×¢×œ×•×ª ××™×©×•×¨×™× ×××¡×¤×¨ ×‘× ×§×™× ×‘×™×—×“</p>
                        </div>
                    </div>
                </label>
                
                <div style="text-align: center; margin-top: 2rem; padding-top: 2rem; border-top: 1px solid var(--border-color);">
                    <p style="color: var(--text-secondary); margin-bottom: 1rem; font-size: 0.95rem;">××™×Ÿ ×œ×š PDF? ××™×Ÿ ×‘×¢×™×”</p>
                    <button class="btn btn-secondary" onclick="openModal()" style="padding: 0.875rem 2rem; font-size: 1rem;">
                        âœï¸ ×”×–×Ÿ ×¤×¨×˜×™× ×™×“× ×™×ª
                    </button>
                </div>
            </div>

            <!-- Processing Indicator -->
            <div id="processingIndicator" style="display: none;" class="card">
                <div style="text-align: center; padding: 2rem;">
                    <div style="width: 60px; height: 60px; margin: 0 auto 1rem; border: 4px solid #e5e7eb; border-top-color: #3b82f6; border-radius: 50%; animation: spin 1s linear infinite;"></div>
                    <p style="font-weight: 600; color: var(--text-primary); margin-bottom: 0.5rem;">××¢×‘×“ ×§×‘×¦×™×...</p>
                    <p style="color: var(--text-secondary); font-size: 0.875rem;" id="processingFileName"></p>
                </div>
            </div>

            <!-- Best Offer Card -->
            <!-- Offers Section -->
            <div id="offersSection" style="display: none;">
                <div class="section-header">
                    <h3 class="section-title" id="offersTitle">×”×¦×¢×•×ª ×œ×”×©×•×•××”</h3>
                    <button class="btn btn-success" onclick="saveComparison()">
                        <span>ğŸ’¾</span> ×©××•×¨ ×”×©×•×•××”
                    </button>
                </div>

                <!-- Detail Cards -->
                <div class="detail-cards" id="detailCards">
                </div>
            </div>

            <!-- How It Works -->
            <div id="howItWorks" style="max-width: 900px; margin: 3rem auto 2rem;">
                <div class="card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 3rem 2rem;">
                    <h3 style="font-size: 2rem; font-weight: 700; text-align: center; margin-bottom: 2rem; color: white;">××™×š ×–×” ×¢×•×‘×“?</h3>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 2rem; margin-top: 2rem;">
                        <div style="text-align: center;">
                            <div style="width: 80px; height: 80px; background: rgba(255,255,255,0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem; font-size: 2.5rem;">
                                ğŸ“¤
                            </div>
                            <h4 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 0.5rem; color: white;">1. ×”×¢×œ×”</h4>
                            <p style="opacity: 0.95; line-height: 1.6;">×”×¢×œ×” ××ª ×”××™×©×•×¨×™× ×”×¢×§×¨×•× ×™×™× ××”×‘× ×§×™× ×‘×¤×•×¨××˜ PDF</p>
                        </div>
                        
                        <div style="text-align: center;">
                            <div style="width: 80px; height: 80px; background: rgba(255,255,255,0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem; font-size: 2.5rem;">
                                ğŸ¤–
                            </div>
                            <h4 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 0.5rem; color: white;">2. × ×™×ª×•×— ×—×›×</h4>
                            <p style="opacity: 0.95; line-height: 1.6;">×”××¢×¨×›×ª ×× ×ª×—×ª ××ª ×›×œ ×”× ×ª×•× ×™×: ×¨×™×‘×™×•×ª, ××¡×œ×•×œ×™×, ×ª×§×•×¤×•×ª</p>
                        </div>
                        
                        <div style="text-align: center;">
                            <div style="width: 80px; height: 80px; background: rgba(255,255,255,0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem; font-size: 2.5rem;">
                                ğŸ“Š
                            </div>
                            <h4 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 0.5rem; color: white;">3. ×”×©×•×•××” ××œ××”</h4>
                            <p style="opacity: 0.95; line-height: 1.6;">×§×‘×œ ×”×©×•×•××” ××¤×•×¨×˜×ª ×¢× ×”××œ×¦×” ×‘×¨×•×¨×” ××™×–×• ×”×¦×¢×” ××©×ª×œ××ª</p>
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin-top: 3rem; padding-top: 2rem; border-top: 1px solid rgba(255,255,255,0.3);">
                        <p style="font-size: 1.125rem; opacity: 0.95; max-width: 600px; margin: 0 auto;">
                            ğŸ’¡ <strong>×˜×™×¤ ×—×©×•×‘:</strong> ×”×”×¦×¢×•×ª ××©×ª× ×•×ª ×›×œ ×”×–××Ÿ - ×›×“××™ ×œ×”×©×•×•×ª ×œ×¤× ×™ ×©×—×•×ª××™×!
                        </p>
                    </div>
                </div>
            </div>

            <!-- Empty State -->
            <div id="emptyState" class="card empty-state">
                <div class="empty-icon">ğŸ“Š</div>
                <p class="empty-text">×”×¢×œ×” ××™×©×•×¨×™× ×¢×§×¨×•× ×™×™× ×›×“×™ ×œ×”×ª×—×™×œ ×‘×”×©×•×•××”</p>
            </div>

            <!-- SEO Content -->
            <div class="card seo-content" style="margin-top: 1.5rem;">
                <h3>×œ××” ×œ×¡××•×š ×¢×œ×™× ×•?</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 2rem; margin-top: 2rem;">
                    <div>
                        <div style="font-size: 2.5rem; margin-bottom: 0.75rem;">ğŸ”’</div>
                        <h4 style="margin-bottom: 0.5rem;">×¤×¨×˜×™×•×ª ××œ××”</h4>
                        <p style="line-height: 1.7;">×”×§×‘×¦×™× ×©×œ×š ×œ× × ×©××¨×™× ×‘×©×¨×ª×™× ×©×œ× ×•. ×›×œ ×”× ×™×ª×•×— ××ª×‘×¦×¢ ×‘××›×©×™×¨ ×©×œ×š ×‘×œ×‘×“.</p>
                    </div>
                    
                    <div>
                        <div style="font-size: 2.5rem; margin-bottom: 0.75rem;">ğŸ¯</div>
                        <h4 style="margin-bottom: 0.5rem;">× ×™×ª×•×— ××“×•×™×§</h4>
                        <p style="line-height: 1.7;">×”××¢×¨×›×ª ×‘×•×“×§×ª ×›×œ ×¤×¨×˜: ×”×—×–×¨ ×—×•×“×©×™, ×¢×œ×•×ª ×›×•×œ×œ×ª, ×¨××ª ×¡×™×›×•×Ÿ, ×•×ª×§× ×•×ª ×‘× ×§ ×™×©×¨××œ.</p>
                    </div>
                    
                    <div>
                        <div style="font-size: 2.5rem; margin-bottom: 0.75rem;">ğŸ’°</div>
                        <h4 style="margin-bottom: 0.5rem;">×—×™× × ×œ×’××¨×™</h4>
                        <p style="line-height: 1.7;">××™×Ÿ ×¢×œ×•×™×•×ª × ×¡×ª×¨×•×ª, ××™×Ÿ ××›×™×¨×ª ××™×“×¢. ×¨×§ ×›×œ×™ ×©×¢×•×–×¨ ×œ×š ×œ×§×‘×œ ×”×—×œ×˜×” × ×›×•× ×”.</p>
                    </div>
                </div>
                
                <div style="margin-top: 3rem; padding-top: 2rem; border-top: 1px solid var(--border-color);">
                    <h3>××™×š ×œ×”×©×•×•×ª ×”×¦×¢×•×ª ××©×›× ×ª×?</h3>
                    <p>
                        ×›×©×œ×•×§×—×™× ××©×›× ×ª×, ×—×©×•×‘ ×œ×”×©×•×•×ª ×‘×™×Ÿ ××¡×¤×¨ ×‘× ×§×™×. ×›×œ ×‘× ×§ ××¦×™×¢ ×ª××”×™×œ ×©×•× ×” ×©×œ ××¡×œ×•×œ×™×,
                        ×¨×™×‘×™×•×ª ×©×•× ×•×ª, ×•×ª× ××™× ×©×•× ×™×. ×”×”×‘×“×œ ×‘×™×Ÿ ×”×¦×¢×” ×˜×•×‘×” ×œ×¤×—×•×ª ×˜×•×‘×” ×™×›×•×œ ×œ×”×’×™×¢ ×œ×××•×ª ××œ×¤×™ ×©×§×œ×™×
                        ×œ××•×¨×š ×—×™×™ ×”×”×œ×•×•××”.
                    </p>
                    <h4>××” ×—×©×•×‘ ×œ×‘×“×•×§?</h4>
                    <ul>
                        <li><strong>×¢×œ×•×ª ×›×•×œ×œ×ª</strong> - ×›××” ×ª×©×œ××• ×‘×¡×š ×”×›×œ (×§×¨×Ÿ + ×¨×™×‘×™×ª + ×¢××œ×•×ª)</li>
                        <li><strong>×”×—×–×¨ ×—×•×“×©×™</strong> - ×”×× ×”×”×—×–×¨ ××ª××™× ×œ×ª×§×¦×™×‘ ×©×œ×›×</li>
                        <li><strong>×¨××ª ×”×¡×™×›×•×Ÿ</strong> - ×›××” ××”××©×›× ×ª× ×¦××•×“×” ×œ××“×“ ××• ×‘×¨×™×‘×™×ª ××©×ª× ×”</li>
                        <li><strong>×’××™×©×•×ª</strong> - ×ª× ××™× ×œ×¤×™×¨×¢×•×Ÿ ××•×§×“× ×•××—×–×•×¨</li>
                    </ul>
                    
                    <div style="background: #eff6ff; padding: 1.5rem; border-radius: 0.75rem; border-right: 4px solid #3b82f6; margin-top: 1.5rem;">
                        <p style="margin: 0; line-height: 1.8;"><strong>ğŸ’¡ ×˜×™×¤ ××§×¦×•×¢×™:</strong> ×œ× ×ª××™×“ ×”×”×¦×¢×” ×¢× ×”×—×–×¨ ×—×•×“×©×™ ×”×›×™ × ××•×š ×”×™× ×”×›×™ ××©×ª×œ××ª! ×—×©×•×‘ ×œ×‘×“×•×§ ××ª ×”×¢×œ×•×ª ×”×›×•×œ×œ×ª ×œ××•×¨×š ×›×œ ×ª×§×•×¤×ª ×”×”×œ×•×•××”.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Saved Comparisons View -->
        <div id="savedView" style="display: none;">
            <h2 class="section-title" style="margin-bottom: 1.5rem;">×”×©×•×•××•×ª ×©××•×¨×•×ª</h2>
            <div id="savedList">
            </div>
        </div>

        <!-- Guide View -->
        <div id="guideView" style="display: none;">
            <div style="max-width: 900px; margin: 0 auto;">
                <button onclick="setView('comparison')" style="display: inline-flex; align-items: center; gap: 0.5rem; padding: 0.75rem 1.5rem; background: #3b82f6; color: white; border: none; border-radius: 0.5rem; font-weight: 500; margin-bottom: 2rem; cursor: pointer; font-size: 1rem; transition: all 0.3s;">
                    â† ×—×–×¨×” ×œ×”×©×•×•××”
                </button>

                <div style="background: var(--bg-card); border-radius: 1rem; padding: 3rem; border: 1px solid var(--border-color);">
                    <h1 style="font-size: 2.5rem; margin-bottom: 1rem; color: var(--text-primary);">ğŸ¯ ××¡×œ×•×œ ×¤×¨×™×™×</h1>
                    
                    <h2 style="font-size: 1.75rem; margin: 2rem 0 1rem; color: var(--text-primary); border-bottom: 2px solid var(--border-color); padding-bottom: 0.5rem;">
                        ğŸ“š ××” ×–×” ××¡×œ×•×œ ×¤×¨×™×™×?
                    </h2>
                    
                    <p style="font-size: 1.05rem; color: var(--text-secondary); line-height: 1.8; margin-bottom: 1.5rem;">
                        ××¡×œ×•×œ ×¤×¨×™×™× (Prime) ×”×•× ××¡×œ×•×œ ××©×›× ×ª× ×¢× <strong>×¨×™×‘×™×ª ××©×ª× ×”</strong> ×©××ª×¢×“×›× ×ª ×‘××•×¤×Ÿ ×—×•×“×©×™. 
                        ×”×¨×™×‘×™×ª ×§×©×•×¨×” ×™×©×™×¨×•×ª ×œ×¨×™×‘×™×ª ×‘× ×§ ×™×©×¨××œ (×”×¨×™×‘×™×ª ×”××˜×¨×”) ×•××©×ª× ×” ×‘×”×ª×× ×œ×©×™× ×•×™×™× ×©×œ×”.
                    </p>

                    <div style="background: #dbeafe; border-right: 4px solid #3b82f6; padding: 1.5rem; border-radius: 0.75rem; margin: 2rem 0;">
                        <h3 style="color: #1e40af; margin-bottom: 0.75rem; font-size: 1.15rem;">ğŸ”¢ ××™×š ××—×•×©×‘×ª ×”×¨×™×‘×™×ª?</h3>
                        
                        <p style="color: #1e40af; line-height: 1.7; margin-bottom: 1rem;">
                            <strong>×©×œ×‘ 1 - ×¨×™×‘×™×ª ×”×¤×¨×™×™× ×”×‘×¡×™×¡×™×ª:</strong><br>
                            ×‘× ×§ ×™×©×¨××œ ×§×•×‘×¢ ××ª "×¨×™×‘×™×ª ×”×¤×¨×™×™×" ×”×¨×©××™×ª. ×–×• ×¨×™×‘×™×ª ××—×™×“×” ×©×›×œ ×”×‘× ×§×™× ××©×ª××©×™× ×‘×” ×›×‘×¡×™×¡.
                        </p>
                        
                        <p style="color: #1e40af; line-height: 1.7; margin-bottom: 1rem;">
                            <strong>×©×œ×‘ 2 - ×”×ª××—×•×¨ ×©×œ ×”×‘× ×§:</strong><br>
                            ×›×œ ×‘× ×§ × ×•×ª×Ÿ ×œ×›×œ ×œ×§×•×— <strong>×”× ×—×” ××• ×ª×•×¡×¤×ª</strong> ×¢×œ ×”×¤×¨×™×™× ×”×‘×¡×™×¡×™, ×‘×”×ª×× ×œ×¤×¨×•×¤×™×œ ×”×œ×§×•×—, ×”×•×Ÿ ×¢×¦××™, ×™×›×•×œ×ª ×”×—×–×¨ ×•×›×•'.
                        </p>
                        
                        <p style="color: #1e40af; line-height: 1.7; margin-bottom: 1rem;">
                            <strong>×”× ×•×¡×—×” ×”×¡×•×¤×™×ª:</strong><br>
                            ×”×¨×™×‘×™×ª ×©×œ×š = ×¨×™×‘×™×ª ×”×¤×¨×™×™× Â± ×”×”× ×—×”/×”×ª×•×¡×¤×ª ×©×œ ×”×‘× ×§
                        </p>
                        
                        <div style="background: rgba(255,255,255,0.5); padding: 1rem; border-radius: 0.5rem; margin-top: 1rem;">
                            <p style="color: #1e40af; line-height: 1.7; margin-bottom: 0.5rem;">
                                <strong>×“×•×’×××•×ª ××¢×©×™×•×ª:</strong>
                            </p>
                            <ul style="color: #1e40af; line-height: 1.8; margin-right: 2rem;">
                                <li style="margin-bottom: 0.5rem;">×¨×™×‘×™×ª ×¤×¨×™×™× ×”×™×•×: 5.5%</li>
                                <li style="margin-bottom: 0.5rem;">×œ×§×•×— ×' ×§×™×‘×œ: <strong>×¤×¨×™×™× ××™× ×•×¡ 0.5%</strong> = ×”×¨×™×‘×™×ª ×©×œ×• ×”×™×•× 5%</li>
                                <li style="margin-bottom: 0.5rem;">×œ×§×•×— ×‘' ×§×™×‘×œ: <strong>×¤×¨×™×™× ××™× ×•×¡ 0.3%</strong> = ×”×¨×™×‘×™×ª ×©×œ×• ×”×™×•× 5.2%</li>
                                <li style="margin-bottom: 0.5rem;">×œ×§×•×— ×’' ×§×™×‘×œ: <strong>×¤×¨×™×™× ×¤×œ×•×¡ 0.2%</strong> = ×”×¨×™×‘×™×ª ×©×œ×• ×”×™×•× 5.7%</li>
                            </ul>
                        </div>
                        
                        <p style="color: #1e40af; line-height: 1.7; margin-top: 1rem;">
                            <strong>×—×©×•×‘ ×œ×“×¢×ª:</strong> ×”×”× ×—×” ××• ×”×ª×•×¡×¤×ª × ×©××¨×™× <strong>×§×‘×•×¢×™×</strong> ×œ×›×œ ×ª×§×•×¤×ª ×”×”×œ×•×•××”. 
                            ××” ×©××©×ª× ×” ×–×” ×¨×§ ×¨×™×‘×™×ª ×”×¤×¨×™×™× ×”×‘×¡×™×¡×™×ª ×©×œ ×‘× ×§ ×™×©×¨××œ.
                        </p>
                        
                        <p style="color: #1e40af; line-height: 1.7; margin-top: 1rem;">
                            <strong>×œ×“×•×’××”:</strong> ×× ×§×™×‘×œ×ª "×¤×¨×™×™× ××™× ×•×¡ 0.5%" - ××ª×” ×ª××™×“ ×ª×§×‘×œ ×—×¦×™ ××—×•×– ×¤×—×•×ª ××”×¤×¨×™×™×, 
                            ×’× ×× ×”×¤×¨×™×™× ×™×¢×œ×” ×œ-6% ××• ×™×¨×“ ×œ-4%.
                        </p>
                    </div>

                    <h2 style="font-size: 1.75rem; margin: 2.5rem 0 1rem; color: var(--text-primary); border-bottom: 2px solid var(--border-color); padding-bottom: 0.5rem;">
                        âœ… ×™×ª×¨×•× ×•×ª ××¡×œ×•×œ ×¤×¨×™×™×
                    </h2>

                    <div style="background: #d1fae5; border-right: 4px solid #10b981; padding: 1.5rem; border-radius: 0.75rem; margin: 2rem 0;">
                        <ul style="color: #065f46; line-height: 1.8; margin-right: 2rem;">
                            <li style="margin-bottom: 1rem;">
                                <strong>âœ… ×’××™×©×•×ª ×›×œ×¤×™ ××˜×”:</strong> ×× ×¨×™×‘×™×ª ×”×¤×¨×™×™× ×™×•×¨×“×ª - ×’× ×”×”×—×–×¨ ×©×œ×š ×™×•×¨×“ ××™×“
                            </li>
                            <li style="margin-bottom: 1rem;">
                                <strong>âœ… ××™×Ÿ ×”×¦××“×” ×œ××“×“:</strong> ×”××¡×œ×•×œ ×œ× ×¦××•×“ ×œ××“×“ ×”××—×™×¨×™× ×œ×¦×¨×›×Ÿ, ×›×š ×©×”×§×¨×Ÿ ×œ× ×’×“×œ×”
                            </li>
                            <li style="margin-bottom: 1rem;">
                                <strong>âœ… ×¤×™×¨×¢×•×Ÿ ××•×§×“× ×–×•×œ:</strong> ×‘×“×¨×š ×›×œ×œ ×¢××œ×•×ª ×”×¤×™×¨×¢×•×Ÿ ×”××•×§×“× × ××•×›×•×ª ×™×•×ª×¨ ×××©×¨ ×‘××¡×œ×•×œ×™× ×§×‘×•×¢×™×
                            </li>
                            <li style="margin-bottom: 1rem;">
                                <strong>âœ… ××ª××™× ×œ×˜×•×•×— ×§×¦×¨-×‘×™× ×•× ×™:</strong> ×× ××ª×” ××ª×›× ×Ÿ ×œ×¡×’×•×¨ ××ª ×”××©×›× ×ª× ×ª×•×š ××¡×¤×¨ ×©× ×™×, ×–×” ×™×›×•×œ ×œ×”×™×•×ª ××©×ª×œ×
                            </li>
                        </ul>
                    </div>

                    <h2 style="font-size: 1.75rem; margin: 2.5rem 0 1rem; color: var(--text-primary); border-bottom: 2px solid var(--border-color); padding-bottom: 0.5rem;">
                        âŒ ×—×¡×¨×•× ×•×ª ××¡×œ×•×œ ×¤×¨×™×™×
                    </h2>

                    <div style="background: #fee2e2; border-right: 4px solid #ef4444; padding: 1.5rem; border-radius: 0.75rem; margin: 2rem 0;">
                        <ul style="color: #991b1b; line-height: 1.8; margin-right: 2rem;">
                            <li style="margin-bottom: 1rem;">
                                <strong>âŒ ××™-×•×“××•×ª ×’×‘×•×”×”:</strong> ××™ ××¤×©×¨ ×œ×“×¢×ª ××¨××© ×›××” ×ª×©×œ× ×‘×¢×•×“ ×©× ×” ××• ×©× ×ª×™×™× - ×–×” ×ª×œ×•×™ ×‘×”×—×œ×˜×•×ª ×‘× ×§ ×™×©×¨××œ
                            </li>
                            <li style="margin-bottom: 1rem;">
                                <strong>âŒ ×¡×™×›×•×Ÿ ×œ×¢×œ×™×•×ª ×—×“×•×ª:</strong> ×× ×”×¨×™×‘×™×ª ×¢×•×œ×”, ×”×”×—×–×¨ ×”×—×•×“×©×™ ×©×œ×š ×™×›×•×œ ×œ×¢×œ×•×ª ××©××¢×•×ª×™×ª ×•×¤×ª××•×
                            </li>
                            <li style="margin-bottom: 1rem;">
                                <strong>âŒ ×§×•×©×™ ×‘×ª×›× ×•×Ÿ ×ª×§×¦×™×‘:</strong> ×§×©×” ×œ×ª×›× ×Ÿ ×ª×§×¦×™×‘ ××©×¤×—×ª×™ ×›×©×”×”×—×–×¨ ××©×ª× ×” ×›×œ ×”×–××Ÿ
                            </li>
                            <li style="margin-bottom: 1rem;">
                                <strong>âŒ ×œ×—×¥ ×¤×¡×™×›×•×œ×•×’×™:</strong> ×”××¢×§×‘ ×”×§×‘×•×¢ ××—×¨ ×©×™× ×•×™×™× ×‘×¨×™×‘×™×ª ×™×›×•×œ ×œ×™×¦×•×¨ ××ª×— ×•×—×•×¡×¨ ×©×§×˜ × ×¤×©×™
                            </li>
                            <li style="margin-bottom: 1rem;">
                                <strong>âŒ ×ª×œ×•×ª ×‘××“×™× ×™×•×ª ×›×œ×›×œ×™×ª:</strong> ××ª×” ×ª×œ×•×™ ×‘×”×—×œ×˜×•×ª ×‘× ×§ ×™×©×¨××œ ×©××™×Ÿ ×œ×š ×©×œ×™×˜×” ×¢×œ×™×”×Ÿ
                            </li>
                            <li style="margin-bottom: 1rem;">
                                <strong>âŒ ××¡×•×›×Ÿ ×‘×¡×‘×™×‘×” ××™× ×¤×œ×¦×™×•× ×™×ª:</strong> ×›×©×™×© ××™× ×¤×œ×¦×™×” ×’×‘×•×”×”, ×‘× ×§ ×™×©×¨××œ ××¢×œ×” ××ª ×”×¨×™×‘×™×ª - ×•×”×”×—×–×¨ ×©×œ×š ××–× ×§
                            </li>
                        </ul>
                    </div>

                    <h2 style="font-size: 1.75rem; margin: 2.5rem 0 1rem; color: var(--text-primary); border-bottom: 2px solid var(--border-color); padding-bottom: 0.5rem;">
                        ğŸ“‹ ×ª×§× ×ª ×‘× ×§ ×™×©×¨××œ
                    </h2>

                    <div style="background: #fee2e2; border-right: 4px solid #ef4444; padding: 1.5rem; border-radius: 0.75rem; margin: 2rem 0;">
                        <h3 style="color: #991b1b; margin-bottom: 0.75rem; font-size: 1.15rem;">âš ï¸ ×—×•×‘×” ×œ×¤×™ ×—×•×§</h3>
                        <p style="color: #991b1b; line-height: 1.8; margin-bottom: 0.5rem;">
                            <strong>×œ×¤×™ ×ª×§× ×•×ª ×‘× ×§ ×™×©×¨××œ:</strong> ×œ×¤×—×•×ª <strong>×©×œ×™×© (33.3%)</strong> ××”××©×›× ×ª× ×—×™×™×‘ ×œ×”×™×•×ª ×‘××¡×œ×•×œ ×§×‘×•×¢ - 
                            ×§×‘×•×¢×” ×œ× ×¦××•×“×” ××• ×§×‘×•×¢×” ×¦××•×“×” ×œ××“×“.
                        </p>
                        <p style="color: #991b1b; line-height: 1.8;">
                            <strong>××©××¢×•×ª:</strong> ××ª×” ×œ× ×™×›×•×œ ×œ×§×—×ª ×™×•×ª×¨ ×-66.6% ×‘××¡×œ×•×œ×™× ××©×ª× ×™× (×¤×¨×™×™×, ××©×ª× ×” ×•×›×•').
                        </p>
                    </div>

                    <div style="margin-top: 3rem; padding-top: 2rem; border-top: 1px solid var(--border-color); text-align: center;">
                        <button onclick="setView('comparison')" style="padding: 1rem 2rem; background: #3b82f6; color: white; border: none; border-radius: 0.5rem; font-size: 1.15rem; font-weight: 600; cursor: pointer; transition: all 0.3s;">
                            ×—×–×•×¨ ×œ×”×©×•×•××” ×©×œ×š ×•×‘×“×•×§ ××ª ×”×”×¦×¢×•×ª â†’
                        </button>
                    </div>

                    <div style="margin-top: 2rem; padding-top: 2rem; border-top: 1px solid var(--border-color);">
                        <p style="color: var(--text-secondary); font-size: 0.875rem; line-height: 1.6;">
                            <strong>×”×¢×¨×”:</strong> ×”××™×“×¢ ×›××Ÿ ×”×•× ×œ××˜×¨×•×ª ×—×™× ×•×›×™×•×ª ×‘×œ×‘×“ ×•××™× ×• ××”×•×•×” ×™×™×¢×•×¥ ×¤×™× × ×¡×™. 
                            ××•××œ×¥ ×œ×”×ª×™×™×¢×¥ ×¢× ×™×•×¢×¥ ××©×›× ×ª××•×ª ××•×¡××š ×œ×¤× ×™ ×§×‘×œ×ª ×”×—×œ×˜×•×ª.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content" style="padding: 3rem 1rem;">
            <div style="max-width: 900px; margin: 0 auto;">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 2rem; margin-bottom: 2rem;">
                    <div>
                        <h4 style="font-weight: 700; margin-bottom: 1rem; color: var(--text-primary); font-size: 1.125rem;">××©×•×•×” ××©×›× ×ª×</h4>
                        <p style="line-height: 1.7;">×›×œ×™ ×—×™× ××™ ×œ×”×©×•×•××ª ×”×¦×¢×•×ª ××©×›× ×ª× ××‘× ×§×™× ×©×•× ×™×. ×¢×•×–×¨ ×œ×š ×œ×§×‘×œ ×”×—×œ×˜×” × ×›×•× ×” ×•×œ×—×¡×•×š ××œ×¤×™ ×©×§×œ×™×.</p>
                    </div>
                    
                    <div>
                        <h4 style="font-weight: 700; margin-bottom: 1rem; color: var(--text-primary); font-size: 1.125rem;">×œ××” ×× ×—× ×•?</h4>
                        <ul style="list-style: none; padding: 0; line-height: 2;">
                            <li>âœ“ × ×™×ª×•×— ××•×˜×•××˜×™ ××“×•×™×§</li>
                            <li>âœ“ ×—×™× × ×œ×—×œ×•×˜×™×Ÿ</li>
                            <li>âœ“ ×œ×œ× ×©××™×¨×ª ××™×“×¢</li>
                            <li>âœ“ ×ª×•×¦××•×ª ××™×™×“×™×•×ª</li>
                        </ul>
                    </div>
                    
                    <div>
                        <h4 style="font-weight: 700; margin-bottom: 1rem; color: var(--text-primary); font-size: 1.125rem;">×©×™××•×©×™ ×œ×“×¢×ª</h4>
                        <ul style="list-style: none; padding: 0; line-height: 2;">
                            <li><a href="#" onclick="setView('guide'); return false;" style="color: var(--text-secondary); text-decoration: none;">××“×¨×™×š ××©×›× ×ª××•×ª</a></li>
                            <li><a href="#howItWorks" style="color: var(--text-secondary); text-decoration: none;">××™×š ×–×” ×¢×•×‘×“?</a></li>
                            <li><a href="#" onclick="setView('comparison'); return false;" style="color: var(--text-secondary); text-decoration: none;">×”×ª×—×œ ×”×©×•×•××”</a></li>
                        </ul>
                    </div>
                </div>
                
                <div style="text-align: center; padding-top: 2rem; border-top: 1px solid var(--border-color);">
                    <p style="margin-bottom: 0.5rem;">Â© 2025 ××©×•×•×” ××©×›× ×ª×. ×›×œ ×”×–×›×•×™×•×ª ×©××•×¨×•×ª.</p>
                    <p style="font-size: 0.875rem;">
                        ×”×›×œ×™ ××™×•×¢×“ ×œ×”×©×•×•××” ×‘×œ×‘×“ ×•××™× ×• ××”×•×•×” ×™×™×¢×•×¥ ×¤×™× × ×¡×™. ××•××œ×¥ ×œ×”×ª×™×™×¢×¥ ×¢× ×™×•×¢×¥ ××©×›× ×ª××•×ª ××•×¡××š.
                    </p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Modal -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">×”×–× ×ª ×”×¦×¢×” ×™×“× ×™×ª</h3>
                <button class="close-btn" onclick="closeModal()">âœ•</button>
            </div>

            <div class="form-group">
                <label class="form-label">×‘× ×§</label>
                <select id="bankSelect" class="form-select">
                    <option value="">×‘×—×¨ ×‘× ×§</option>
                    <option value="×‘× ×§ ×”×¤×•×¢×œ×™×">×‘× ×§ ×”×¤×•×¢×œ×™×</option>
                    <option value="×‘× ×§ ×œ××•××™">×‘× ×§ ×œ××•××™</option>
                    <option value="×‘× ×§ ×“×™×¡×§×•× ×˜">×‘× ×§ ×“×™×¡×§×•× ×˜</option>
                    <option value="××–×¨×—×™ ×˜×¤×—×•×ª">××–×¨×—×™ ×˜×¤×—×•×ª</option>
                    <option value="×”×‘×™× ×œ××•××™">×”×‘×™× ×œ××•××™</option>
                    <option value="×‘× ×§ ×™×”×‘">×‘× ×§ ×™×”×‘</option>
                    <option value="××¨×›× ×ª×™×œ">××¨×›× ×ª×™×œ</option>
                    <option value="×‘× ×§ ×™×¨×•×©×œ×™×">×‘× ×§ ×™×¨×•×©×œ×™×</option>
                    <option value="××©×›× ×ª× ×™×©×™×¨×”">××©×›× ×ª× ×™×©×™×¨×”</option>
                    <option value="××—×¨">××—×¨</option>
                </select>
            </div>

            <div class="form-group">
                <label class="form-label">×¡×›×•× ×›×•×œ×œ (â‚ª)</label>
                <input type="number" id="totalAmount" class="form-input" placeholder="1,000,000">
                <div id="amountError" style="display: none; margin-top: 0.5rem; padding: 0.75rem; background: #fee2e2; border: 1px solid #dc2626; border-radius: 0.5rem; color: #dc2626; font-size: 0.875rem; font-weight: 600;">
                </div>
            </div>

            <div class="track-section">
                <div class="track-header">
                    <label class="form-label" style="margin: 0;">××¡×œ×•×œ×™×</label>
                    <button class="add-track-btn" onclick="addTrack()">+ ×”×•×¡×£ ××¡×œ×•×œ</button>
                </div>
                <div id="tracksContainer">
                    <!-- Tracks will be added here -->
                </div>
            </div>

            <button class="btn btn-primary" style="width: 100%; margin-top: 1rem;" onclick="submitOffer()">
                ×”×•×¡×£ ×”×¦×¢×”
            </button>
        </div>
    </div>

    <script>
        const TRACK_TYPES = {
            'prime': { 
                name: '×¤×¨×™×™×', 
                risk: 'high',
                description: '×”×¨×™×‘×™×ª ××©×ª× ×” ×—×•×“×©×™×ª ×œ×¤×™ ×‘× ×§ ×™×©×¨××œ.\n\nğŸ”´ ××™-×•×“××•×ª ×’×‘×•×”×” - ×”×”×—×–×¨ ×™×›×•×œ ×œ×”×©×ª× ×•×ª ×‘×›×œ ×—×•×“×©\nâœ… ×’××™×©×•×ª - × ×”× ×” ××”×•×¨×“×•×ª ×¨×™×‘×™×ª ××™×“\nâš ï¸ ×§×©×” ×œ×ª×›× ×Ÿ ×ª×§×¦×™×‘ ××¨×•×š ×˜×•×•×—'
            },
            'fixed_unlinked': { 
                name: '×§×‘×•×¢×” ×œ× ×¦××•×“×” (×§×œ"×¦)', 
                risk: 'low',
                description: '×”×¨×™×‘×™×ª ×•×”×§×¨×Ÿ ×§×‘×•×¢×•×ª ×œ×›×œ ×”×ª×§×•×¤×”.\n\nâœ… ×•×•×“××•×ª ××œ××” - ×”×”×—×–×¨ ×œ× ××©×ª× ×” ×œ×¢×•×œ×\nâœ… ×”×§×¨×Ÿ ×¤×•×—×ª×ª ×‘×”×ª××“×”\nâš ï¸ ×¤×™×¨×¢×•×Ÿ ××•×§×“× ×™×§×¨'
            },
            'fixed_linked': { 
                name: '×§×‘×•×¢×” ×¦××•×“×” ×œ××“×“ (×§"×¦)', 
                risk: 'medium',
                description: '×”×¨×™×‘×™×ª ×§×‘×•×¢×”, ×”×§×¨×Ÿ ×¦××•×“×” ×œ××“×“.\n\nâœ… ×”×¨×™×‘×™×ª ×œ× ××©×ª× ×”\nğŸ”´ ×”×”×—×–×¨ ××©×ª× ×” ×œ×¤×™ ×”××™× ×¤×œ×¦×™×”\nğŸ“Š ××ª××™× ×œ××™ ×©×”×”×›× ×¡×” ×¦××•×“×” ×œ××“×“'
            },
            'variable_1_linked': { 
                name: '××©×ª× ×” ×¦××•×“×” ×›×œ ×©× ×”', 
                risk: 'high',
                description: '×”×¨×™×‘×™×ª ××©×ª× ×” ×›×œ ×©× ×” + ×¦××•×“ ×œ××“×“.\n\nğŸ”´ ×¡×™×›×•×Ÿ ×›×¤×•×œ - ×¨×™×‘×™×ª ×•××“×“\nğŸ”´ ×”×”×—×–×¨ ×™×›×•×œ ×œ×”×©×ª× ×•×ª ××©××¢×•×ª×™×ª\nâš ï¸ ××™-×•×“××•×ª ×’×‘×•×”×” ×××•×“'
            },
            'variable_unlinked_18m': { 
                name: '××©×ª× ×” ×›×œ 18 ×—×•×“×©×™×', 
                risk: 'medium',
                description: '×”×¨×™×‘×™×ª ××©×ª× ×” ×›×œ ×©× ×” ×•×—×¦×™.\n\nğŸŸ¡ ××™×–×•×Ÿ ×‘×™×Ÿ ×™×¦×™×‘×•×ª ×œ×’××™×©×•×ª\nâœ… ×”×§×¨×Ÿ ×¤×•×—×ª×ª\nğŸ“Š ×©×™× ×•×™ ×›×œ 18 ×—×•×“×©×™×'
            },
            'variable_unlinked_2y': { 
                name: '××©×ª× ×” ×›×œ ×©× ×ª×™×™×', 
                risk: 'medium',
                description: '×”×¨×™×‘×™×ª ××©×ª× ×” ×›×œ ×©× ×ª×™×™×.\n\nğŸŸ¡ ×™×¦×™×‘×•×ª ×œ×©× ×ª×™×™×, ××– ×¢×“×›×•×Ÿ\nâœ… ×”×§×¨×Ÿ ×¤×•×—×ª×ª\nğŸ“Š ××™×–×•×Ÿ ×¡×‘×™×¨'
            },
            'variable_2_5_linked': { 
                name: '××©×ª× ×” ×¦××•×“×” ×›×œ 2.5 ×©× ×™×', 
                risk: 'high',
                description: '×”×¨×™×‘×™×ª ××©×ª× ×” ×›×œ 2.5 ×©× ×™× + ×¦××•×“ ×œ××“×“.\n\nğŸ”´ ×¡×™×›×•×Ÿ ×›×¤×•×œ - ×¨×™×‘×™×ª ×•××“×“\nğŸ”´ ×”×§×¨×Ÿ ×’×“×œ×” ×‘××™× ×¤×œ×¦×™×”\nğŸ“Š ××ª××™× ×¨×§ ×œ××™ ×©×”×”×›× ×¡×” ×¦××•×“×” ×œ××“×“'
            },
            'variable_unlinked_3y': { 
                name: '××©×ª× ×” ×›×œ 3 ×©× ×™×', 
                risk: 'medium',
                description: '×”×¨×™×‘×™×ª ××©×ª× ×” ×›×œ 3 ×©× ×™×.\n\nğŸŸ¡ ×™×¦×™×‘×•×ª ×œ-3 ×©× ×™×\nâœ… ×”×§×¨×Ÿ ×¤×•×—×ª×ª\nğŸ“Š ×¡×™×›×•×Ÿ ×‘×™× ×•× ×™'
            },
            'variable_linked_3y': { 
                name: '××©×ª× ×” ×¦××•×“×” ×›×œ 3 ×©× ×™×', 
                risk: 'high',
                description: '×”×¨×™×‘×™×ª ××©×ª× ×” ×›×œ 3 ×©× ×™× + ×¦××•×“ ×œ××“×“.\n\nğŸ”´ ×¡×™×›×•×Ÿ ×›×¤×•×œ - ×¨×™×‘×™×ª ×•××“×“\nğŸ”´ ×”×§×¨×Ÿ ×’×“×œ×” ×‘××™× ×¤×œ×¦×™×”\nâš ï¸ ×§×©×” ×œ×—×–×•×ª ××ª ×”×”×—×–×¨'
            },
            'variable_unlinked_5y': { 
                name: '××©×ª× ×” ×›×œ 5 ×©× ×™×', 
                risk: 'medium',
                description: '×”×¨×™×‘×™×ª ××©×ª× ×” ×›×œ 5 ×©× ×™×.\n\nâœ… ××™×–×•×Ÿ ××¢×•×œ×” - 5 ×©× ×™× ×™×¦×™×‘×•×ª\nâœ… ×”×§×¨×Ÿ ×¤×•×—×ª×ª\nğŸ“Š ×”××¡×œ×•×œ ×”× ×¤×•×¥ ×‘×™×•×ª×¨\nâš ï¸ ×”×¨×™×‘×™×ª ×™×›×•×œ×” ×œ×¢×œ×•×ª/×œ×¨×“×ª ×›×œ 5 ×©× ×™×'
            },
            'variable_5': { 
                name: '××©×ª× ×” ×›×œ 5 ×©× ×™×', 
                risk: 'medium',
                description: '×”×¨×™×‘×™×ª ××©×ª× ×” ×›×œ 5 ×©× ×™×.\n\nâœ… ××™×–×•×Ÿ ××¢×•×œ×” - 5 ×©× ×™× ×™×¦×™×‘×•×ª\nâœ… ×”×§×¨×Ÿ ×¤×•×—×ª×ª\nğŸ“Š ×”××¡×œ×•×œ ×”× ×¤×•×¥ ×‘×™×•×ª×¨\nâš ï¸ ×”×¨×™×‘×™×ª ×™×›×•×œ×” ×œ×¢×œ×•×ª/×œ×¨×“×ª ×›×œ 5 ×©× ×™×'
            },
            'variable_linked_5y': { 
                name: '××©×ª× ×” ×¦××•×“×” ×›×œ 5 ×©× ×™×', 
                risk: 'high',
                description: '×”×¨×™×‘×™×ª ××©×ª× ×” ×›×œ 5 ×©× ×™× + ×¦××•×“ ×œ××“×“.\n\nğŸ”´ ×”×§×¨×Ÿ ×’×“×œ×” ×‘××™× ×¤×œ×¦×™×”\nğŸŸ¡ 5 ×©× ×™× ×™×¦×™×‘×•×ª ×‘×¨×™×‘×™×ª\nğŸ“Š ××ª××™× ×œ××™ ×©×”×”×›× ×¡×” ×¦××•×“×” ×œ××“×“'
            },
            'variable_5_linked': { 
                name: '××©×ª× ×” ×¦××•×“×” ×›×œ 5 ×©× ×™×', 
                risk: 'high',
                description: '×”×¨×™×‘×™×ª ××©×ª× ×” ×›×œ 5 ×©× ×™× + ×¦××•×“ ×œ××“×“.\n\nğŸ”´ ×”×§×¨×Ÿ ×’×“×œ×” ×‘××™× ×¤×œ×¦×™×”\nğŸŸ¡ 5 ×©× ×™× ×™×¦×™×‘×•×ª ×‘×¨×™×‘×™×ª\nğŸ“Š ××ª××™× ×œ××™ ×©×”×”×›× ×¡×” ×¦××•×“×” ×œ××“×“'
            },
            'variable_unlinked_10y': { 
                name: '××©×ª× ×” ×›×œ 10 ×©× ×™×', 
                risk: 'low',
                description: '×”×¨×™×‘×™×ª ××©×ª× ×” ×›×œ 10 ×©× ×™×.\n\nâœ… ×¢×©×•×¨ ×©×œ× ×©×œ ×™×¦×™×‘×•×ª\nâœ… ×›××¢×˜ ×›××• ×§×‘×•×¢×”\nğŸ“Š ×¡×™×›×•×Ÿ × ××•×š ×××•×“'
            },
            'variable_10': { 
                name: '××©×ª× ×” ×›×œ 10 ×©× ×™×', 
                risk: 'low',
                description: '×”×¨×™×‘×™×ª ××©×ª× ×” ×›×œ 10 ×©× ×™×.\n\nâœ… ×¢×©×•×¨ ×©×œ× ×©×œ ×™×¦×™×‘×•×ª\nâœ… ×›××¢×˜ ×›××• ×§×‘×•×¢×”\nğŸ“Š ×¡×™×›×•×Ÿ × ××•×š ×××•×“'
            },
            'variable_linked_10y': { 
                name: '××©×ª× ×” ×¦××•×“×” ×›×œ 10 ×©× ×™×', 
                risk: 'medium',
                description: '×”×¨×™×‘×™×ª ××©×ª× ×” ×›×œ 10 ×©× ×™× + ×¦××•×“ ×œ××“×“.\n\nğŸŸ¡ ×¢×©×•×¨ ×™×¦×™×‘×•×ª ×‘×¨×™×‘×™×ª\nğŸ”´ ×”×§×¨×Ÿ ×’×“×œ×” ×‘××™× ×¤×œ×¦×™×”\nğŸ“Š ××ª××™× ×œ××™ ×©×”×”×›× ×¡×” ×¦××•×“×” ×œ××“×“'
            },
            'variable_10_linked': { 
                name: '××©×ª× ×” ×¦××•×“×” ×›×œ 10 ×©× ×™×', 
                risk: 'medium',
                description: '×”×¨×™×‘×™×ª ××©×ª× ×” ×›×œ 10 ×©× ×™× + ×¦××•×“ ×œ××“×“.\n\nğŸŸ¡ ×¢×©×•×¨ ×™×¦×™×‘×•×ª ×‘×¨×™×‘×™×ª\nğŸ”´ ×”×§×¨×Ÿ ×’×“×œ×” ×‘××™× ×¤×œ×¦×™×”\nğŸ“Š ××ª××™× ×œ××™ ×©×”×”×›× ×¡×” ×¦××•×“×” ×œ××“×“'
            },
        };

        const BANKS = {
            '×‘× ×§ ×”×¤×•×¢×œ×™×': '#ED1D24',      // ××“×•× ×¤×•×¢×œ×™×
            '×‘× ×§ ×œ××•××™': '#0066FB',         // ×›×—×•×œ ×œ××•××™
            '×‘× ×§ ×“×™×¡×§×•× ×˜': '#018C52',       // ×™×¨×•×§ ×“×™×¡×§×•× ×˜
            '××–×¨×—×™ ×˜×¤×—×•×ª': '#FF7820',       // ×›×ª×•× ××–×¨×—×™
            '×”×‘×™× ×œ××•××™': '#061942',         // ×›×—×•×œ ×›×”×” ×‘×™× ×œ××•××™
            '×‘× ×§ ×™×”×‘': '#20409A',           // ×›×—×•×œ ×™×”×‘
            '××¨×›× ×ª×™×œ': '#00A661',           // ×™×¨×•×§ ××¨×›× ×ª×™×œ
            '×‘× ×§ ×™×¨×•×©×œ×™×': '#CC923B',       // ×–×”×‘ ×™×¨×•×©×œ×™×
            '××©×›× ×ª× ×™×©×™×¨×”': '#8B1874',      // ×¡×’×•×œ ××©×›× ×ª× ×™×©×™×¨×”
            '××—×¨': '#6B7280'                // ××¤×•×¨ × ×™×˜×¨×œ×™
        };

        let offers = [];
        let savedComparisons = [];
        let currentView = 'comparison';
        let trackCount = 0;
        let editingOfferId = null; // Track which offer is being edited
        
        // Save offers to localStorage and session
        function saveOffers() {
            localStorage.setItem('mortgage_offers', JSON.stringify(offers));
            if (window.mortgageSession) {
                window.mortgageSession.saveOffers(offers);
            }
        }
        
        // Load offers from localStorage
        function loadOffers() {
            const saved = localStorage.getItem('mortgage_offers');
            if (saved) {
                offers = JSON.parse(saved);
                updateUI();
            }
        }
        
        // Alias for updateUI (used by file upload)
        function renderOffers() {
            updateUI();
        }
        
        // Get track name by type
        function getTrackName(type) {
            const trackNames = {
                'prime': '×¤×¨×™×™×',
                'fixed_unlinked': '×§×‘×•×¢×” ×œ× ×¦××•×“×” (×§×œ"×¦)',
                'fixed_linked': '×§×‘×•×¢×” ×¦××•×“×” (×§"×¦)',
                'variable_1_linked': '××©×ª× ×” ×›×œ ×©× ×” ×¦××•×“×”',
                'variable_2_5_linked': '××©×ª× ×” ×›×œ 2.5 ×©× ×™× ×¦××•×“×”',
                'variable_5': '××©×ª× ×” ×›×œ 5 ×©× ×™×',
                'variable_5_linked': '××©×ª× ×” ×›×œ 5 ×©× ×™× ×¦××•×“×”',
                'variable_10': '××©×ª× ×” ×›×œ 10 ×©× ×™×',
                'variable_10_linked': '××©×ª× ×” ×›×œ 10 ×©× ×™× ×¦××•×“×”',
                'variable_linked': '××©×ª× ×” ×¦××•×“×”',
                'variable_unlinked': '××©×ª× ×” ×œ× ×¦××•×“×”',
                'variable_every_5y_unlinked': '××©×ª× ×” ×›×œ 5 ×©× ×™× ×œ× ×¦××•×“×”',
                'variable_every_5y_linked': '××©×ª× ×” ×›×œ 5 ×©× ×™× ×¦××•×“×”',
                'prime_for_business': '×¤×¨×™×™× ×¢×¡×§×™',
                'eligibility': '×–×›××•×ª'
            };
            return trackNames[type] || type;
        }
        
        // Theme management
        function initTheme() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
            updateThemeIcon(savedTheme);
        }
        
        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            updateThemeIcon(newTheme);
        }
        
        function updateThemeIcon(theme) {
            const icon = document.getElementById('themeIcon');
            const button = document.getElementById('themeToggle');
            if (theme === 'dark') {
                icon.textContent = 'â˜€ï¸';
                button.style.background = '#334155';
                button.style.borderColor = '#475569';
            } else {
                icon.textContent = 'ğŸŒ™';
                button.style.background = 'white';
                button.style.borderColor = '#e5e7eb';
            }
        }
        
        // Initialize theme on page load
        initTheme();
        
        // Load offers from localStorage
        loadOffers();
        
        // Re-position tooltips on resize
        window.addEventListener('resize', function() {
            document.querySelectorAll('.tooltip-text').forEach(tooltip => {
                tooltip.style.visibility = 'hidden';
                tooltip.style.opacity = '0';
            });
        });

        // Load saved comparisons from localStorage
        function loadSavedComparisons() {
            const saved = localStorage.getItem('mortgage_comparisons');
            if (saved) {
                savedComparisons = JSON.parse(saved);
                document.getElementById('savedCount').textContent = savedComparisons.length;
            }
        }

        function formatCurrency(num) {
            return new Intl.NumberFormat('he-IL', { 
                style: 'currency', 
                currency: 'ILS', 
                maximumFractionDigits: 0 
            }).format(num);
        }

        function calculateMonthlyPayment(principal, annualRate, years) {
            const monthlyRate = annualRate / 100 / 12;
            const numPayments = years * 12;
            if (monthlyRate === 0) return principal / numPayments;
            return principal * (monthlyRate * Math.pow(1 + monthlyRate, numPayments)) / 
                   (Math.pow(1 + monthlyRate, numPayments) - 1);
        }

        function calculateTotalInterest(principal, monthlyPayment, years) {
            return (monthlyPayment * years * 12) - principal;
        }

        function calculateRiskScore(tracks) {
            if (!tracks || tracks.length === 0) return 0;
            
            let totalAmount = 0, weightedRisk = 0;
            
            tracks.forEach(track => {
                const riskValue = calculateTrackRiskScore(track.type);
                totalAmount += track.amount;
                weightedRisk += track.amount * riskValue;
            });
            
            return totalAmount > 0 ? Math.round(weightedRisk / totalAmount) : 0;
        }
        
        function calculateTrackRiskScore(trackType) {
            // Returns risk score for a single track type
            switch(trackType) {
                case 'prime': return 85;
                case 'fixed_unlinked': return 20;
                case 'fixed_linked': return 55;
                case 'variable_unlinked_18m': return 60;
                case 'variable_unlinked_2y': return 50;
                case 'variable_unlinked_3y': return 45;
                case 'variable_unlinked_5y': return 35;
                case 'variable_unlinked_10y': return 25;
                case 'variable_linked_3y': return 80;
                case 'variable_linked_5y': return 75;
                case 'variable_linked_10y': return 60;
                default: return 50;
            }
        }

        function setView(view) {
            currentView = view;
            document.getElementById('navComparison').classList.toggle('active', view === 'comparison');
            document.getElementById('navSaved').classList.toggle('active', view === 'saved');
            const guideBtn = document.getElementById('navGuide');
            if (guideBtn) guideBtn.classList.toggle('active', view === 'guide');
            
            document.getElementById('comparisonView').style.display = view === 'comparison' ? 'block' : 'none';
            document.getElementById('savedView').style.display = view === 'saved' ? 'block' : 'none';
            document.getElementById('guideView').style.display = view === 'guide' ? 'block' : 'none';
            
            if (view === 'saved') {
                renderSavedComparisons();
            }
        }

        // âœ¨ COST OPTIMIZATION: Extract text from PDF using PDF.js (10x cheaper!)
        async function extractTextFromPDF(file) {
            try {
                console.log('ğŸ“„ Attempting text extraction from PDF...');
                const arrayBuffer = await file.arrayBuffer();
                const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
                
                let fullText = '';
                const numPages = pdf.numPages;
                console.log(`ğŸ“„ PDF has ${numPages} pages`);
                
                // Extract text from all pages
                for (let i = 1; i <= numPages; i++) {
                    const page = await pdf.getPage(i);
                    const textContent = await page.getTextContent();
                    const pageText = textContent.items.map(item => item.str).join(' ');
                    fullText += `\n\n=== ×¢××•×“ ${i} ===\n${pageText}`;
                }
                
                console.log(`âœ… Text extracted: ${fullText.length} characters`);
                return fullText;
            } catch (error) {
                console.error('âŒ Error extracting text from PDF:', error);
                return null;
            }
        }

        // Get parsing prompt (reusable for both text and PDF modes)
        function getParsingPrompt() {
            return `×—×œ×¥ ××ª ×”××™×“×¢ ×”×‘× ×‘×¤×•×¨××˜ JSON ×‘×œ×‘×“, ×œ×œ× ×˜×§×¡×˜ × ×•×¡×£:

{
  "bank": "×©× ×”×‘× ×§",
  "totalAmount": ×¡×›×•×_×›×•×œ×œ_×‘××¡×¤×¨,
  "totalMonthlyPayment": ×”×—×–×¨_×—×•×“×©×™_×›×•×œ×œ_×‘××¡×¤×¨,
  "loanPurpose": "××˜×¨×ª ×”×”×œ×•×•××”",
  "tracks": [
    {
      "type": "×¡×•×’_×”××¡×œ×•×œ",
      "name": "×©× ×”××¡×œ×•×œ ×‘×¢×‘×¨×™×ª - ×§×¦×¨ ×•×‘×¨×•×¨, ×œ×œ× '×¢×œ ×‘×¡×™×¡ ××’\\"×— ×××©×œ×ª×™'",
      "amount": ×¡×›×•×_×‘××¡×¤×¨,
      "interestRate": ×¨×™×‘×™×ª_×¡×•×¤×™×ª_×‘××¡×¤×¨,
      "spread": ×ª×•×¡×¤×ª_××•_×”× ×—×”_×‘××¡×¤×¨_××•_null,
      "years": ×ª×§×•×¤×”_×‘×©× ×™×,
      "monthlyPayment": ×”×—×–×¨_×—×•×“×©×™_×©×œ_××¡×œ×•×œ
    }
  ]
}

×”×•×¨××•×ª ×¡×¤×¦×™×¤×™×•×ª ×œ××–×¨×—×™ ×˜×¤×—×•×ª:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1. ×¡×›×•× ×›×•×œ×œ: ×—×¤×© "×™×ª×¨×” ×œ×¡×™×œ×•×§ ×‘×ª×™×§" ××• "×¡×›×•× ×”×‘×™×¦×•×¢"
2. ×”×—×–×¨ ×—×•×“×©×™ ×›×•×œ×œ: ×—×¤×© "×”×”×—×–×¨ ×”×—×•×“×©×™" ×‘×˜×‘×œ×” ×”×¨××©×™×ª
3. ××˜×¨×ª ×”×œ×•×•××”: ×—×¤×© "××˜×¨×ª ×”×œ×•×•××”:" (×“×™×•×¨, ×›×œ ××˜×¨×”, ××™×—×–×•×¨ ×•×›×•')

×œ×›×œ ××¡×œ×•×œ:
â”â”â”â”â”â”â”â”â”â”
- ×¡×›×•×: ×—×¤×© "×™×ª×¨×ª ×”×§×¨×Ÿ:" (×œ× "×¡×›×•× ×—×œ×§ ×–×” ×‘×¢×ª ×”×‘×™×¦×•×¢")
- ×”×—×–×¨ ×—×•×“×©×™: ×—×¤×© "×¡×›×•× ×”×—×™×•×‘ ×”×—×•×“×©×™ ×‘×’×™×Ÿ ×—×œ×§ ×–×”:"
- ×ª×§×•×¤×”: ×—×©×‘ ×"×ª××¨×™×š ×¡×™×•× ×—×œ×§ ×–×” ×©×œ ×”×”×œ×•×•××”"

×–×™×”×•×™ ×¡×•×’ ××¡×œ×•×œ (type):
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
"×¨×™×‘×™×ª ×§×‘×•×¢×” ×¦××•×“×” ×œ××“×“" â†’ fixed_linked
"×§×‘×•×¢×” ×¦××•×“×”" â†’ fixed_linked
"×œ× ×¦××•×“, ×¨×™×‘×™×ª ×¤×¨×™×™×" â†’ prime
"×¤×¨×™×™×" â†’ prime
"×§×‘×•×¢×” ×œ× ×¦××•×“×”" â†’ fixed_unlinked

×œ××¡×œ×•×œ×™× ××©×ª× ×™× - ×—×¤×© "×ª×“×™×¨×•×ª ×©×™× ×•×™ ×”×¨×™×‘×™×ª: XX ×—×•×“×©×™×":
- 12 ×—×•×“×©×™× â†’ variable_1_linked (×× ×¦××•×“)
- 30 ×—×•×“×©×™× â†’ variable_2_5_linked (×× ×¦××•×“)
- 60 ×—×•×“×©×™× â†’ variable_5_linked (×× ×¦××•×“) ××• variable_5 (×× ×œ× ×¦××•×“)
- 120 ×—×•×“×©×™× â†’ variable_10_linked (×× ×¦××•×“) ××• variable_10 (×× ×œ× ×¦××•×“)

×× ×œ× ××¦××ª "×ª×“×™×¨×•×ª ×©×™× ×•×™ ×”×¨×™×‘×™×ª", ×”×©×ª××© ×‘×©× ×”××¡×œ×•×œ:
"××©×ª× ×” ×¦××•×“×” ×›×œ 5 ×©× ×™×" â†’ variable_5_linked
"××©×ª× ×” ×¦××•×“×” ×›×œ 3 ×©× ×™×" â†’ variable_linked_3y
"××©×ª× ×” ×›×œ 5 ×©× ×™×" â†’ variable_5
"××©×ª× ×” ×›×œ 10 ×©× ×™×" â†’ variable_10

**×—×©×•×‘:** ×”×ª×¢×œ× ××”×‘×™×˜×•×™ "×¢×œ ×‘×¡×™×¡ ××’"×— ×××©×œ×ª×™" - ×–×” ×¨×§ ×”×¡×‘×¨ ×˜×›× ×™.
"××©×ª× ×” ×¦××•×“×” ×›×œ 3 ×©× ×™× ×¢×œ ×‘×¡×™×¡ ××’"×— ×××©×œ×ª×™" = variable_linked_3y

**×©××•×ª ××¡×œ×•×œ×™× (name):**
×ª××™×“ ×”×—×–×¨ ×©× ×§×¦×¨ ×•×‘×¨×•×¨ ×œ×œ× "×¢×œ ×‘×¡×™×¡ ××’"×— ×××©×œ×ª×™":
âœ… × ×›×•×Ÿ: "××©×ª× ×” ×¦××•×“×” ×›×œ 3 ×©× ×™×"
âŒ ×œ× × ×›×•×Ÿ: "××©×ª× ×” ×¦××•×“×” ×›×œ 3 ×©× ×™× ×¢×œ ×‘×¡×™×¡ ××’"×— ×××©×œ×ª×™"

×¨×™×‘×™×ª - ×§×¨×™×˜×™ ×××•×“!
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
×œ××¡×œ×•×œ×™× ×§×‘×•×¢×™×: 
- ×§×— ××ª "×©×™×¢×•×¨ ×”×¨×™×‘×™×ª ×‘×—×œ×§ ×–×”:"
- ×–×• ×”×¨×™×‘×™×ª ×”×¡×•×¤×™×ª ×•×”×™×—×™×“×”

×œ×¤×¨×™×™× ×•××©×ª× ×” ×™×© 2 ×¢×¨×›×™×:
1. ×”×¨×™×‘×™×ª ×”×¡×•×¤×™×ª (interestRate): ×—×¤×© "×©×™×¢×•×¨ ×”×¨×™×‘×™×ª:" ×‘××•×¢×“ ×”×—×™×©×•×‘
   - ×–×• ×”×¨×™×‘×™×ª ×©×”×œ×§×•×— ××©×œ× ×”×™×•× ×‘×¤×•×¢×œ
   
2. ×”×ª×•×¡×¤×ª/×”× ×—×” (spread): ×—×¤×© "×©×™×¢×•×¨ ×”×ª×•×¡×¤×ª ×œ×¢×•×’×Ÿ:"
   - ×× ×™×© ×¡×™××Ÿ ××™× ×•×¡ (-) ×‘×¦×“ ×™××™×Ÿ â†’ ××¡×¤×¨ ×©×œ×™×œ×™
     ×“×•×’××”: "% 0.300000 - 0.300000% -" â†’ -0.3
   - ×× ×¡×™××Ÿ ×¤×œ×•×¡ (+) ×‘×¦×“ ×™××™×Ÿ â†’ ××¡×¤×¨ ×—×™×•×‘×™
     ×“×•×’××”: "% 2.900000 + 2.900000% +" â†’ 2.9

×“×•×’×××•×ª:
- ×¤×¨×™×™×: ×× "×©×™×¢×•×¨ ×”×¨×™×‘×™×ª: 5.45%" ×•"×©×™×¢×•×¨ ×”×ª×•×¡×¤×ª ×œ×¢×•×’×Ÿ: -0.3%" 
  â†’ interestRate: 5.45, spread: -0.3
  
- ××©×ª× ×”: ×× "×©×™×¢×•×¨ ×”×¨×™×‘×™×ª: 6.61%" ×•"×©×™×¢×•×¨ ×”×ª×•×¡×¤×ª ×œ×¢×•×’×Ÿ: +2.9%"
  â†’ interestRate: 6.61, spread: 2.9
  
- ×§×‘×•×¢×”: ×× "×©×™×¢×•×¨ ×”×¨×™×‘×™×ª ×‘×—×œ×§ ×–×”: 3.3%"
  â†’ interestRate: 3.3, spread: null

×—×©×•×‘: ×× ×œ× ××¦××ª ××™×“×¢ - ×”×©×ª××© ×‘-null ××• 0 ×‘×”×ª××.
×”×—×–×¨ ×¨×§ JSON, ×œ×œ× ×˜×§×¡×˜ ××§×“×™× ××• backticks.`;
        }

        // File upload handler
        async function handleFileUpload(event) {
            const files = event.target.files;
            if (!files || files.length === 0) return;

            const processingIndicator = document.getElementById('processingIndicator');
            const processingFileName = document.getElementById('processingFileName');
            
            processingIndicator.style.display = 'block';

            for (let file of files) {
                processingFileName.textContent = `××¢×‘×“ ××ª ${file.name}...`;
                
                try {
                    const startTime = performance.now();
                    
                    // Show extraction phase
                    processingFileName.textContent = `××¢×‘×“ ××ª ${file.name}...`;
                    
                    // âœ¨ NEW: Try to extract text first (cheaper & faster!)
                    let extractedText = await extractTextFromPDF(file);
                    
                    let apiContent;
                    let costEstimate = '';
                    
                    if (extractedText && extractedText.length > 100) {
                        // Success! Use text-only (10x cheaper!)
                        console.log('âœ… Using text extraction (cost-effective)');
                        console.log(`ğŸ“Š Text length: ${extractedText.length} chars (~${Math.ceil(extractedText.length / 4)} tokens)`);
                        costEstimate = '×–×•×œ (×˜×§×¡×˜ ×‘×œ×‘×“)';
                        processingFileName.textContent = `××¢×‘×“ ××ª ${file.name}...`;
                        
                        apiContent = [
                            {
                                type: "text",
                                text: `××ª×” ×× ×ª×— ××¡××›×™ ××©×›× ×ª× ×™×©×¨××œ×™×™×. ×œ×”×œ×Ÿ ×”×˜×§×¡×˜ ×©×—×•×œ×¥ ××”-PDF:\n\n${extractedText}\n\n` + getParsingPrompt()
                            }
                        ];
                    } else {
                        // Fallback: use full PDF (more expensive but works for scanned docs)
                        console.log('âš ï¸ Text extraction failed, using full PDF');
                        costEstimate = '×™×§×¨ (PDF ××œ×)';
                        processingFileName.textContent = `××¢×‘×“ ××ª ${file.name}...`;
                        
                        const base64 = await fileToBase64(file);
                        console.log(`ğŸ“Š PDF size: ${Math.round(base64.length / 1024)}KB`);
                        
                        apiContent = [
                            {
                                type: "document",
                                source: {
                                    type: "base64",
                                    media_type: "application/pdf",
                                    data: base64
                                }
                            },
                            {
                                type: "text",
                                text: `××ª×” ×× ×ª×— ××¡××›×™ ××©×›× ×ª× ×™×©×¨××œ×™×™× (×¤×™×¨×•×˜ ×™×ª×¨×•×ª ××• ××™×©×•×¨×™× ×¢×§×¨×•× ×™×™×).\n\n` + getParsingPrompt()
                            }
                        ];
                    }
                    
                    console.log(`ğŸ’° Cost estimate: ${costEstimate}`);
                    
                    // Call Claude API
                    const response = await fetch("https://api.anthropic.com/v1/messages", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                        },
                        body: JSON.stringify({
                            model: "claude-sonnet-4-20250514",
                            max_tokens: 2000,
                            messages: [
                                {
                                    role: "user",
                                    content: apiContent
                                }
                            ],
                        })
                    });

                    const data = await response.json();
                    const responseText = data.content[0]?.text || '';
                    
                    const endTime = performance.now();
                    const processingTime = ((endTime - startTime) / 1000).toFixed(2);
                    console.log(`â±ï¸ Processing time: ${processingTime}s`);
                    console.log(`ğŸ’° Method: ${costEstimate}`);
                    
                    // Extract JSON
                    const jsonMatch = responseText.match(/\{[\s\S]*\}/);
                    if (jsonMatch) {
                        const parsedData = JSON.parse(jsonMatch[0]);
                        addOfferFromParsedData(parsedData, file.name);
                        
                        console.log(`âœ… Successfully processed ${file.name} in ${processingTime}s using ${costEstimate} method`);
                    } else {
                        alert(`×œ× ×”×¦×œ×—×ª×™ ×œ×§×¨×•× ××ª ×”×§×•×‘×¥ ${file.name}. × ×¡×” ×”×–× ×” ×™×“× ×™×ª.`);
                    }
                } catch (error) {
                    console.error('Error processing file:', file.name, error);
                    alert(`×©×’×™××” ×‘×§×¨×™××ª ${file.name}. × ×¡×” ×”×–× ×” ×™×“× ×™×ª.`);
                }
            }

            processingIndicator.style.display = 'none';
            event.target.value = ''; // Reset input
        }

        // Convert file to base64
        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => {
                    const base64 = reader.result.split(',')[1];
                    resolve(base64);
                };
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }
        
        // Extract text from PDF using PDF.js
        async function extractTextFromPDF(file) {
            try {
                const arrayBuffer = await file.arrayBuffer();
                const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
                
                let fullText = '';
                const numPages = pdf.numPages;
                
                // Extract text from all pages
                for (let i = 1; i <= numPages; i++) {
                    const page = await pdf.getPage(i);
                    const textContent = await page.getTextContent();
                    const pageText = textContent.items.map(item => item.str).join(' ');
                    fullText += `\n--- ×¢××•×“ ${i} ---\n${pageText}\n`;
                }
                
                return fullText;
            } catch (error) {
                console.error('Error extracting text from PDF:', error);
                return null;
            }
        }

        // Add offer from parsed data
        function addOfferFromParsedData(parsedData, fileName) {
            const tracks = parsedData.tracks.map(track => {
                const amount = parseFloat(track.amount) || 0;
                const rate = parseFloat(track.interestRate) || 0;
                const spread = track.spread !== undefined && track.spread !== null ? parseFloat(track.spread) : null;
                const years = parseInt(track.years) || 20;
                
                // Use monthly payment from document if available, otherwise calculate
                let monthly = parseFloat(track.monthlyPayment) || 0;
                if (monthly === 0) {
                    monthly = calculateMonthlyPayment(amount, rate, years);
                }
                
                const interest = calculateTotalInterest(amount, monthly, years);
                
                return {
                    type: track.type,
                    name: track.name || getTrackName(track.type),
                    amount: amount,
                    interestRate: rate,
                    spread: spread,
                    years: years,
                    monthlyPayment: Math.round(monthly),
                    totalInterest: Math.round(interest)
                };
            });

            const totalAmount = parseFloat(parsedData.totalAmount) || tracks.reduce((sum, t) => sum + t.amount, 0);
            
            // Use total monthly payment from document if available
            let totalMonthlyPayment = parseFloat(parsedData.totalMonthlyPayment) || 0;
            if (totalMonthlyPayment === 0) {
                totalMonthlyPayment = tracks.reduce((sum, t) => sum + t.monthlyPayment, 0);
            }
            
            const totalInterest = tracks.reduce((sum, t) => sum + t.totalInterest, 0);

            const offer = {
                id: Date.now() + Math.random(),
                fileName: fileName,
                bank: parsedData.bank || '×œ× ×–×•×”×”',
                bankColor: BANKS[parsedData.bank] || '#666666',
                totalAmount: totalAmount,
                tracks: tracks,
                loanPurpose: parsedData.loanPurpose || '',
                totalMonthlyPayment: Math.round(totalMonthlyPayment),
                totalInterest: Math.round(totalInterest),
                totalCost: Math.round(totalAmount + totalInterest),
                riskScore: calculateRiskScore(tracks),
                uploadedAt: new Date().toISOString()
            };

            offers.push(offer);
            saveOffers();
            renderOffers();
        }

        function openModal(editMode = false) {
            document.getElementById('modal').classList.add('show');
            
            if (!editMode) {
                // Clear form for new entry
                editingOfferId = null;
                document.getElementById('bankSelect').value = '';
                document.getElementById('totalAmount').value = '';
                document.getElementById('tracksContainer').innerHTML = '';
                trackCount = 0;
                addTrack();
                document.querySelector('.modal-title').textContent = '×”×–× ×ª ×”×¦×¢×” ×™×“× ×™×ª';
                document.querySelector('.modal-content button[onclick="submitOffer()"]').textContent = '×”×•×¡×£ ×”×¦×¢×”';
            } else {
                // Edit mode - form will be populated by editOffer function
                document.querySelector('.modal-title').textContent = '×¢×¨×™×›×ª ×”×¦×¢×”';
                document.querySelector('.modal-content button[onclick="submitOffer()"]').textContent = '×¢×“×›×Ÿ ×”×¦×¢×”';
            }
        }

        function closeModal() {
            document.getElementById('modal').classList.remove('show');
        }

        function addTrack() {
            trackCount++;
            const trackId = `track_${trackCount}`;
            const tracksContainer = document.getElementById('tracksContainer');
            
            const trackHtml = `
                <div class="track-card" id="${trackId}">
                    <div class="track-card-header">
                        <span class="text-sm fw-500" style="color: var(--text-secondary);">××¡×œ×•×œ ${trackCount}</span>
                        ${trackCount > 1 ? `<button class="remove-track-btn" onclick="removeTrack('${trackId}')">×”×¡×¨</button>` : ''}
                    </div>
                    <div class="track-grid">
                        <select class="track-input track-type" onchange="updateYearsPlaceholder(this)">
                            <option value="prime">×¤×¨×™×™×</option>
                            <option value="fixed_unlinked">×§×‘×•×¢×” ×œ× ×¦××•×“×”</option>
                            <option value="fixed_linked">×§×‘×•×¢×” ×¦××•×“×”</option>
                            <optgroup label="××©×ª× ×” ×œ× ×¦××•×“×”">
                                <option value="variable_unlinked_18m">××©×ª× ×” ×›×œ 18 ×—×•×“×©×™×</option>
                                <option value="variable_unlinked_2y">××©×ª× ×” ×›×œ ×©× ×ª×™×™×</option>
                                <option value="variable_unlinked_3y">××©×ª× ×” ×›×œ 3 ×©× ×™×</option>
                                <option value="variable_5">××©×ª× ×” ×›×œ 5 ×©× ×™×</option>
                                <option value="variable_10">××©×ª× ×” ×›×œ 10 ×©× ×™×</option>
                            </optgroup>
                            <optgroup label="××©×ª× ×” ×¦××•×“×”">
                                <option value="variable_1_linked">××©×ª× ×” ×¦××•×“×” ×›×œ ×©× ×”</option>
                                <option value="variable_2_5_linked">××©×ª× ×” ×¦××•×“×” ×›×œ 2.5 ×©× ×™×</option>
                                <option value="variable_linked_3y">××©×ª× ×” ×¦××•×“×” ×›×œ 3 ×©× ×™×</option>
                                <option value="variable_5_linked">××©×ª× ×” ×¦××•×“×” ×›×œ 5 ×©× ×™×</option>
                                <option value="variable_10_linked">××©×ª× ×” ×¦××•×“×” ×›×œ 10 ×©× ×™×</option>
                            </optgroup>
                        </select>
                        <input type="number" class="track-input track-amount" placeholder="×¡×›×•× (â‚ª)">
                        <input type="number" step="0.5" class="track-input track-rate" placeholder="×¨×™×‘×™×ª (%)">
                        <input type="number" step="0.5" class="track-input track-years" placeholder="×©× ×™×">
                    </div>
                </div>
            `;
            
            tracksContainer.insertAdjacentHTML('beforeend', trackHtml);
        }

        function removeTrack(trackId) {
            document.getElementById(trackId).remove();
        }

        function updateYearsPlaceholder(selectElement) {
            const trackCard = selectElement.closest('.track-card');
            const yearsInput = trackCard.querySelector('.track-years');
            const selectedType = selectElement.value;
            
            const periodRequirements = {
                'variable_unlinked_18m': { 
                    placeholder: '×©× ×™× (1.5, 3, 4.5, 6, 7.5...)', 
                    title: '×›×œ 18 ×—×•×“×©×™× - ×”×–×Ÿ ×ª×§×•×¤×” ×›×š ×©××¡×¤×¨ ×”×—×•×“×©×™× ×™×ª×—×œ×§ ×‘-18' 
                },
                'variable_unlinked_2y': { 
                    placeholder: '×©× ×™× (2, 4, 6, 8, 10...)', 
                    title: '×›×œ ×©× ×ª×™×™× (24 ×—×•×“×©×™×) - ×”×–×Ÿ ×ª×§×•×¤×” ×–×•×’×™×ª' 
                },
                'variable_unlinked_3y': { 
                    placeholder: '×©× ×™× (3, 6, 9, 12, 15...)', 
                    title: '×›×œ 3 ×©× ×™× (36 ×—×•×“×©×™×) - ××¡×¤×¨ ×”×—×•×“×©×™× ×—×™×™×‘ ×œ×”×ª×—×œ×§ ×‘-36' 
                },
                'variable_linked_3y': { 
                    placeholder: '×©× ×™× (3, 6, 9, 12, 15...)', 
                    title: '×›×œ 3 ×©× ×™× (36 ×—×•×“×©×™×) - ××¡×¤×¨ ×”×—×•×“×©×™× ×—×™×™×‘ ×œ×”×ª×—×œ×§ ×‘-36' 
                },
                'variable_5': { 
                    placeholder: '×©× ×™× (5, 10, 15, 20, 25...)', 
                    title: '×›×œ 5 ×©× ×™× (60 ×—×•×“×©×™×) - ××¡×¤×¨ ×”×—×•×“×©×™× ×—×™×™×‘ ×œ×”×ª×—×œ×§ ×‘-60' 
                },
                'variable_5_linked': { 
                    placeholder: '×©× ×™× (5, 10, 15, 20, 25...)', 
                    title: '×›×œ 5 ×©× ×™× (60 ×—×•×“×©×™×) - ××¡×¤×¨ ×”×—×•×“×©×™× ×—×™×™×‘ ×œ×”×ª×—×œ×§ ×‘-60' 
                },
                'variable_10': { 
                    placeholder: '×©× ×™× (10, 20, 30...)', 
                    title: '×›×œ 10 ×©× ×™× (120 ×—×•×“×©×™×) - ××¡×¤×¨ ×”×—×•×“×©×™× ×—×™×™×‘ ×œ×”×ª×—×œ×§ ×‘-120' 
                },
                'variable_10_linked': { 
                    placeholder: '×©× ×™× (10, 20, 30...)', 
                    title: '×›×œ 10 ×©× ×™× (120 ×—×•×“×©×™×) - ××¡×¤×¨ ×”×—×•×“×©×™× ×—×™×™×‘ ×œ×”×ª×—×œ×§ ×‘-120' 
                },
                'variable_1_linked': { 
                    placeholder: '×©× ×™× (1, 2, 3, 4, 5...)', 
                    title: '×›×œ ×©× ×” (12 ×—×•×“×©×™×)' 
                },
                'variable_2_5_linked': { 
                    placeholder: '×©× ×™× (2.5, 5, 7.5, 10, 12.5...)', 
                    title: '×›×œ 2.5 ×©× ×™× (30 ×—×•×“×©×™×) - ××¡×¤×¨ ×”×—×•×“×©×™× ×—×™×™×‘ ×œ×”×ª×—×œ×§ ×‘-30' 
                },
            };
            
            if (periodRequirements[selectedType]) {
                yearsInput.placeholder = periodRequirements[selectedType].placeholder;
                yearsInput.style.borderColor = '#f59e0b';
                yearsInput.title = periodRequirements[selectedType].title;
            } else {
                yearsInput.placeholder = '×©× ×™×';
                yearsInput.style.borderColor = '#e5e7eb';
                yearsInput.title = '';
            }
        }

        function submitOffer() {
            const bank = document.getElementById('bankSelect').value;
            const totalAmount = parseFloat(document.getElementById('totalAmount').value) || 0;
            
            if (!bank) {
                alert('×× × ×‘×—×¨ ×‘× ×§');
                return;
            }

            const trackElements = document.querySelectorAll('.track-card');
            const tracks = [];
            let hasValidTrack = false;
            let validationErrors = [];

            trackElements.forEach((trackEl, index) => {
                const type = trackEl.querySelector('.track-type').value;
                const amount = parseFloat(trackEl.querySelector('.track-amount').value) || 0;
                const rate = parseFloat(trackEl.querySelector('.track-rate').value) || 0;
                const years = parseInt(trackEl.querySelector('.track-years').value) || 20;

                if (amount > 0) {
                    // Validate track period based on type - check months, not years
                    let periodError = null;
                    const totalMonths = years * 12;
                    
                    if (type === 'variable_unlinked_18m') {
                        // 18 months
                        if (totalMonths % 18 !== 0) {
                            periodError = `××¡×œ×•×œ "××©×ª× ×” ×›×œ 18 ×—×•×“×©×™×" ×“×•×¨×© ×ª×§×•×¤×” ×©××¡×¤×¨ ×”×—×•×“×©×™× ×©×œ×” ××ª×—×œ×§ ×‘-18 (×œ××©×œ: 18 ×—×•×“×©×™×/1.5 ×©× ×™×, 36 ×—×•×“×©×™×/3 ×©× ×™×, 54 ×—×•×“×©×™×/4.5 ×©× ×™×, 72 ×—×•×“×©×™×/6 ×©× ×™×). ×”×ª×§×•×¤×” ×©×”×•×–× ×”: ${years} ×©× ×™× = ${totalMonths} ×—×•×“×©×™×.`;
                        }
                    } else if (type === 'variable_unlinked_2y') {
                        // 24 months (2 years)
                        if (totalMonths % 24 !== 0) {
                            periodError = `××¡×œ×•×œ "××©×ª× ×” ×›×œ ×©× ×ª×™×™×" ×“×•×¨×© ×ª×§×•×¤×” ×©××¡×¤×¨ ×”×—×•×“×©×™× ×©×œ×” ××ª×—×œ×§ ×‘-24 (×œ××©×œ: 2, 4, 6, 8, 10 ×©× ×™×). ×”×ª×§×•×¤×” ×©×”×•×–× ×”: ${years} ×©× ×™× = ${totalMonths} ×—×•×“×©×™×.`;
                        }
                    } else if (type === 'variable_unlinked_3y' || type === 'variable_linked_3y') {
                        // 36 months (3 years)
                        if (totalMonths % 36 !== 0) {
                            periodError = `××¡×œ×•×œ "××©×ª× ×” ×›×œ 3 ×©× ×™×" ×“×•×¨×© ×ª×§×•×¤×” ×©××¡×¤×¨ ×”×—×•×“×©×™× ×©×œ×” ××ª×—×œ×§ ×‘-36 (×œ××©×œ: 3, 6, 9, 12, 15 ×©× ×™×). ×”×ª×§×•×¤×” ×©×”×•×–× ×”: ${years} ×©× ×™× = ${totalMonths} ×—×•×“×©×™×.`;
                        }
                    } else if (type === 'variable_unlinked_5y' || type === 'variable_linked_5y') {
                        // 60 months (5 years)
                        if (totalMonths % 60 !== 0) {
                            periodError = `××¡×œ×•×œ "××©×ª× ×” ×›×œ 5 ×©× ×™×" ×“×•×¨×© ×ª×§×•×¤×” ×©××¡×¤×¨ ×”×—×•×“×©×™× ×©×œ×” ××ª×—×œ×§ ×‘-60 (×œ××©×œ: 5, 10, 15, 20, 25, 30 ×©× ×™×). ×”×ª×§×•×¤×” ×©×”×•×–× ×”: ${years} ×©× ×™× = ${totalMonths} ×—×•×“×©×™×.`;
                        }
                    } else if (type === 'variable_unlinked_10y' || type === 'variable_linked_10y') {
                        // 120 months (10 years)
                        if (totalMonths % 120 !== 0) {
                            periodError = `××¡×œ×•×œ "××©×ª× ×” ×›×œ 10 ×©× ×™×" ×“×•×¨×© ×ª×§×•×¤×” ×©××¡×¤×¨ ×”×—×•×“×©×™× ×©×œ×” ××ª×—×œ×§ ×‘-120 (×œ××©×œ: 10, 20, 30 ×©× ×™×). ×”×ª×§×•×¤×” ×©×”×•×–× ×”: ${years} ×©× ×™× = ${totalMonths} ×—×•×“×©×™×.`;
                        }
                    }
                    
                    if (periodError) {
                        validationErrors.push(`××¡×œ×•×œ ${index + 1}: ${periodError}`);
                    }
                    
                    hasValidTrack = true;
                    const monthly = calculateMonthlyPayment(amount, rate, years);
                    const totalInterest = (monthly * years * 12) - amount;
                    
                    tracks.push({
                        type,
                        name: TRACK_TYPES[type]?.name || type,
                        amount,
                        interestRate: rate,
                        years,
                        monthlyPayment: Math.round(monthly),
                        totalInterest: Math.round(totalInterest)
                    });
                }
            });

            // Show validation errors
            if (validationErrors.length > 0) {
                alert('âš ï¸ ×©×’×™××•×ª ×‘×ª××”×™×œ:\n\n' + validationErrors.join('\n\n'));
                return;
            }

            if (!hasValidTrack) {
                alert('×× × ×”×–×Ÿ ×œ×¤×—×•×ª ××¡×œ×•×œ ××—×“ ×¢× ×¡×›×•×');
                return;
            }

            const sumAmount = tracks.reduce((sum, t) => sum + t.amount, 0);
            
            // Validate that total amount matches sum of tracks (if total amount was entered)
            const errorDiv = document.getElementById('amountError');
            if (totalAmount > 0 && Math.abs(totalAmount - sumAmount) > 1) {
                const difference = sumAmount - totalAmount;
                const diffText = difference > 0 ? 
                    `×™×•×ª×¨ ×‘-â‚ª${Math.abs(difference).toLocaleString('he-IL')}` : 
                    `×¤×—×•×ª ×‘-â‚ª${Math.abs(difference).toLocaleString('he-IL')}`;
                
                errorDiv.innerHTML = `
                    <strong>âš ï¸ ××™-×”×ª×××” ×‘×¡×›×•××™×!</strong><br><br>
                    ×¡×›×•× ×›×•×œ×œ ×©×”×•×–×Ÿ: â‚ª${totalAmount.toLocaleString('he-IL')}<br>
                    ×¡×›×•× ×”××¡×œ×•×œ×™×: â‚ª${sumAmount.toLocaleString('he-IL')}<br>
                    <strong>×”×¤×¨×©: ${diffText}</strong><br><br>
                    ×× × ×ª×§×Ÿ ××ª ×”×¡×›×•××™× ×œ×¤× ×™ ×”××©×š.
                `;
                errorDiv.style.display = 'block';
                
                // Scroll to error
                errorDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
                return;
            }
            
            // Clear error if exists
            errorDiv.style.display = 'none';
            const totalMonthlyPayment = tracks.reduce((sum, t) => sum + t.monthlyPayment, 0);
            const totalInterest = tracks.reduce((sum, t) => sum + t.totalInterest, 0);

            const offer = {
                id: editingOfferId || Date.now(), // Keep existing ID if editing
                bank,
                bankColor: BANKS[bank] || '#666666',
                totalAmount: totalAmount || sumAmount,
                tracks,
                totalMonthlyPayment,
                totalInterest,
                totalCost: (totalAmount || sumAmount) + totalInterest,
                riskScore: calculateRiskScore(tracks)
            };

            if (editingOfferId) {
                // Update existing offer
                const index = offers.findIndex(o => o.id === editingOfferId);
                if (index !== -1) {
                    offers[index] = offer;
                }
                editingOfferId = null;
            } else {
                // Add new offer
                offers.push(offer);
            }

            updateUI();
            closeModal();
        }

        function deleteOffer(id) {
            offers = offers.filter(o => o.id !== id);
            updateUI();
        }

        function editOffer(id) {
            const offer = offers.find(o => o.id === id);
            if (!offer) return;
            
            editingOfferId = id;
            
            // Open modal in edit mode
            openModal(true);
            
            // Populate form with offer data
            document.getElementById('bankSelect').value = offer.bank;
            document.getElementById('totalAmount').value = offer.totalAmount;
            
            // Clear and populate tracks
            document.getElementById('tracksContainer').innerHTML = '';
            trackCount = 0;
            
            offer.tracks.forEach(track => {
                addTrack();
                const trackElement = document.querySelectorAll('.track-card')[trackCount - 1];
                trackElement.querySelector('.track-type').value = track.type;
                trackElement.querySelector('.track-amount').value = track.amount;
                trackElement.querySelector('.track-rate').value = track.interestRate;
                trackElement.querySelector('.track-years').value = track.years;
            });
        }

        function updateUI() {
            if (offers.length === 0) {
                document.getElementById('emptyState').style.display = 'block';
                document.getElementById('offersSection').style.display = 'none';
                return;
            }

            document.getElementById('emptyState').style.display = 'none';
            document.getElementById('offersSection').style.display = 'block';

            // Update offers title
            document.getElementById('offersTitle').textContent = `${offers.length} ×”×¦×¢×•×ª ×œ×”×©×•×•××”`;

            // Update detail cards
            const detailCards = document.getElementById('detailCards');
            detailCards.innerHTML = '';

            offers.forEach(offer => {
                const cardHtml = `
                    <div class="detail-card">
                        <div class="detail-card-header" style="background: ${offer.bankColor};">
                            <div style="display: flex; justify-content: space-between; align-items: start;">
                                <div style="flex: 1;">
                                    <h4 class="detail-card-bank">${offer.bank}</h4>
                                    <p class="detail-card-amount">×¡×›×•×: ${formatCurrency(offer.totalAmount)}</p>
                                    <div style="margin-top: 0.5rem; display: inline-flex; align-items: center; gap: 0.5rem; background: rgba(255,255,255,0.2); padding: 0.25rem 0.75rem; border-radius: 9999px; font-size: 0.875rem;">
                                        <span>×¦×™×•×Ÿ ×¡×™×›×•×Ÿ ×›×•×œ×œ:</span>
                                        <span style="font-weight: 700;">${offer.riskScore}</span>
                                        <div style="width: 40px; height: 6px; background: rgba(255,255,255,0.3); border-radius: 9999px; overflow: hidden;">
                                            <div style="width: ${offer.riskScore}%; height: 100%; background: ${offer.riskScore < 40 ? '#22c55e' : offer.riskScore < 60 ? '#eab308' : '#ef4444'}; border-radius: 9999px;"></div>
                                        </div>
                                    </div>
                                </div>
                                <button onclick="editOffer(${offer.id})" style="background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3); color: white; padding: 0.5rem 1rem; border-radius: 0.5rem; cursor: pointer; font-size: 0.875rem; font-weight: 500;">
                                    âœï¸ ×¢×¨×•×š
                                </button>
                            </div>
                        </div>
                        <div class="detail-card-body">
                            ${offer.tracks.map(track => {
                                return `
                                    <div class="track-detail">
                                        <div class="track-detail-header">
                                            <span class="track-name">
                                                ${track.name}
                                                <span class="tooltip-icon">
                                                    ?
                                                    <span class="tooltip-text">${TRACK_TYPES[track.type]?.description || '××¡×œ×•×œ ××©×›× ×ª× - ×¤× ×” ×œ×™×•×¢×¥ ××©×›× ×ª××•×ª ×œ××™×“×¢ ××¤×•×¨×˜ ×¢×œ ××¡×œ×•×œ ×–×”.'}</span>
                                                </span>
                                            </span>
                                        </div>
                                        <div class="track-stats">
                                            <div>
                                                <span class="track-stat-label">×¡×›×•×: </span>
                                                <span class="track-stat-value">${formatCurrency(track.amount)}</span>
                                            </div>
                                            <div>
                                                <span class="track-stat-label">×¨×™×‘×™×ª: </span>
                                                <span class="track-stat-value">${track.interestRate}%${track.spread !== null && track.spread !== undefined ? 
                                                    ` (${track.type === 'prime' ? '×¤×¨×™×™×' : '×¢×•×’×Ÿ'} ${track.spread > 0 ? '+' : ''}${track.spread}%)` : ''}</span>
                                            </div>
                                            <div>
                                                <span class="track-stat-label">×ª×§×•×¤×”: </span>
                                                <span class="track-stat-value">${track.years} ×©× ×™×</span>
                                            </div>
                                            <div>
                                                <span class="track-stat-label">×”×—×–×¨: </span>
                                                <span class="track-stat-value">${formatCurrency(track.monthlyPayment)}</span>
                                            </div>
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                            
                            <div style="display: flex; gap: 0.75rem; margin-top: 1.5rem;">
                                <button onclick="showAmortizationSchedule(${offer.id})" style="flex: 1; padding: 0.75rem; background: #10b981; color: white; border: none; border-radius: 0.75rem; font-weight: 600; cursor: pointer; transition: all 0.3s; display: flex; align-items: center; justify-content: center; gap: 0.5rem;">
                                    <span style="font-size: 1.25rem;">ğŸ“‹</span>
                                    <span>×œ×•×— ×¡×™×œ×•×§×™×Ÿ</span>
                                </button>
                                <button onclick="deleteOffer(${offer.id})" style="padding: 0.75rem 1rem; background: #ef4444; color: white; border: none; border-radius: 0.75rem; font-weight: 600; cursor: pointer; transition: all 0.3s;">
                                    ğŸ—‘ï¸
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                detailCards.insertAdjacentHTML('beforeend', cardHtml);
            });
        }

        function saveComparison() {
            if (offers.length === 0) return;
            
            const comparison = {
                id: Date.now(),
                savedAt: new Date().toISOString(),
                offers: offers
            };
            
            savedComparisons.unshift(comparison);
            localStorage.setItem('mortgage_comparisons', JSON.stringify(savedComparisons));
            document.getElementById('savedCount').textContent = savedComparisons.length;
            alert('×”×”×©×•×•××” × ×©××¨×” ×‘×”×¦×œ×—×”!');
        }

        function renderSavedComparisons() {
            const savedList = document.getElementById('savedList');
            
            if (savedComparisons.length === 0) {
                savedList.innerHTML = `
                    <div class="card empty-state">
                        <div class="empty-icon">ğŸ“‹</div>
                        <p class="empty-text">××™×Ÿ ×”×©×•×•××•×ª ×©××•×¨×•×ª</p>
                        <button class="btn btn-primary" style="margin-top: 1rem;" onclick="setView('comparison')">
                            ×¦×•×¨ ×”×©×•×•××” ×—×“×©×”
                        </button>
                    </div>
                `;
                return;
            }

            savedList.innerHTML = savedComparisons.map(comp => `
                <div class="card" style="padding: 1.5rem;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div style="font-size: 1.125rem; font-weight: 600; color: var(--text-primary);">
                                ${comp.offers.length} ×”×¦×¢×•×ª
                            </div>
                            <div class="text-sm" style="color: var(--text-secondary); margin-top: 0.25rem;">
                                ${new Date(comp.savedAt).toLocaleDateString('he-IL')} â€¢ 
                                ${comp.offers.map(o => o.bank).join(', ')}
                            </div>
                        </div>
                        <div style="display: flex; gap: 0.5rem;">
                            <button class="btn btn-secondary" onclick="loadComparison(${comp.id})">
                                ×˜×¢×Ÿ
                            </button>
                            <button class="btn btn-danger" onclick="deleteComparison(${comp.id})">
                                ××—×§
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function loadComparison(id) {
            const comparison = savedComparisons.find(c => c.id === id);
            if (comparison) {
                offers = comparison.offers;
                setView('comparison');
                updateUI();
            }
        }

        function deleteComparison(id) {
            savedComparisons = savedComparisons.filter(c => c.id !== id);
            localStorage.setItem('mortgage_comparisons', JSON.stringify(savedComparisons));
            document.getElementById('savedCount').textContent = savedComparisons.length;
            renderSavedComparisons();
        }

        // Initialize
        loadSavedComparisons();
        updateUI();
        
        // Amortization Schedule Function
        function showAmortizationSchedule(offerId) {
            const offer = offers.find(o => o.id === offerId);
            if (!offer) return;
            
            document.getElementById('scheduleBank').textContent = offer.bank;
            document.getElementById('scheduleModal').style.display = 'block';
            document.body.style.overflow = 'hidden';
            
            renderAmortizationSchedule(offer);
        }
        
        function closeScheduleModal() {
            document.getElementById('scheduleModal').style.display = 'none';
            document.body.style.overflow = 'auto';
        }
        
        function renderAmortizationSchedule(offer) {
            const content = document.getElementById('scheduleContent');
            let html = '';
            
            offer.tracks.forEach((track, trackIndex) => {
                html += `
                    <div style="margin-bottom: 2rem;">
                        <h3 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 1rem; color: var(--text-primary);">${track.name} - ${formatCurrency(track.amount)}</h3>
                        <div style="overflow-x: auto; border-radius: 0.75rem; border: 1px solid var(--border-color);">
                            <table style="width: 100%; border-collapse: collapse;">
                                <thead style="background: var(--bg-primary);">
                                    <tr>
                                        <th style="padding: 0.75rem; text-align: center; border-bottom: 1px solid var(--border-color); font-weight: 600;">×—×•×“×©</th>
                                        <th style="padding: 0.75rem; text-align: center; border-bottom: 1px solid var(--border-color); font-weight: 600;">×ª×©×œ×•×</th>
                                        <th style="padding: 0.75rem; text-align: center; border-bottom: 1px solid var(--border-color); font-weight: 600;">×§×¨×Ÿ</th>
                                        <th style="padding: 0.75rem; text-align: center; border-bottom: 1px solid var(--border-color); font-weight: 600;">×¨×™×‘×™×ª</th>
                                        <th style="padding: 0.75rem; text-align: center; border-bottom: 1px solid var(--border-color); font-weight: 600;">×™×ª×¨×”</th>
                                    </tr>
                                </thead>
                                <tbody>
                `;
                
                let balance = track.amount;
                const monthlyRate = track.interestRate / 100 / 12;
                const numPayments = track.years * 12;
                const monthlyPayment = track.monthlyPayment;
                
                // Show first 12 months, then yearly summary
                for (let month = 1; month <= numPayments; month++) {
                    const interestPayment = balance * monthlyRate;
                    const principalPayment = monthlyPayment - interestPayment;
                    balance = balance - principalPayment;
                    
                    if (month <= 12 || month % 12 === 0) {
                        html += `
                            <tr style="border-bottom: 1px solid var(--border-color);">
                                <td style="padding: 0.75rem; text-align: center;">${month}</td>
                                <td style="padding: 0.75rem; text-align: center; font-weight: 600;">${formatCurrency(monthlyPayment)}</td>
                                <td style="padding: 0.75rem; text-align: center; color: #3b82f6;">${formatCurrency(principalPayment)}</td>
                                <td style="padding: 0.75rem; text-align: center; color: #ef4444;">${formatCurrency(interestPayment)}</td>
                                <td style="padding: 0.75rem; text-align: center; font-weight: 600;">${formatCurrency(Math.max(0, balance))}</td>
                            </tr>
                        `;
                    }
                }
                
                html += `
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
            });
            
            content.innerHTML = html;
        }
    </script>
    
    <!-- Amortization Schedule Modal -->
    <div id="scheduleModal" onclick="closeScheduleModal()" style="display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.7); z-index: 9999; padding: 1rem; overflow-y: auto;">
        <div onclick="event.stopPropagation()" style="max-width: 1000px; margin: 2rem auto; background: var(--bg-card); border-radius: 1.5rem; box-shadow: 0 20px 60px rgba(0,0,0,0.3);">
            <div style="padding: 2rem; border-bottom: 1px solid var(--border-color);">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <h2 style="font-size: 1.75rem; font-weight: 700; color: var(--text-primary);">ğŸ“‹ ×œ×•×— ×¡×™×œ×•×§×™×Ÿ</h2>
                        <div id="scheduleBank" style="margin-top: 0.5rem; font-size: 1.125rem; color: var(--text-secondary);"></div>
                    </div>
                    <button onclick="closeScheduleModal()" style="width: 40px; height: 40px; border-radius: 50%; border: none; background: var(--bg-primary); color: var(--text-primary); cursor: pointer; font-size: 1.5rem; display: flex; align-items: center; justify-content: center; transition: all 0.3s;">
                        âœ•
                    </button>
                </div>
            </div>
            
            <div id="scheduleContent" style="padding: 2rem;">
            </div>
        </div>
    </div>
</body>
</html>
